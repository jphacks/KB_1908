var Obniz=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=21)}([function(e,t,i){const r=i(57);let s={};e.exports=class e{constructor(){this._hw={hw:void 0,firmware:void 0},this.COMMAND_FUNC_ID_ERROR=255,this.ioNotUsed=255}static get schema(){return r}static get CommandClasses(){return s}static addCommandClass(e,t){s[e]=t}static framed(e,t,i){let r,s=0;if(i&&(s=i.length),s<=63)r=0;else if(s<=16383)r=1;else{if(!(s<=1073741823))throw new Error("too big payload");r=2}let n=0==r?0:1==r?1:3,a=3+n,o=new Uint8Array(a+s),h=0;for(o[h++]=127&e,o[h++]=t,o[h++]=r<<6|s>>8*n;n>0;)n--,o[h++]=s>>8*n;return 0==s?o:(o.set(i,a),o)}static dequeueOne(e){if(!e||0==e.byteLength)return null;if(e.byteLength<3)throw new Error("something wrong. buf less than 3");if(128&e[0])throw new Error("reserved bit 1");let t=127&e[0],i=e[1],r=e[2]>>6&3,s=0==r?0:1==r?1:3;if(4==r)throw new Error("invalid length");let n=(63&e[2])<<8*s,a=3,o=s;for(;o>0;)o--,n+=e[a]<<8*o,a++;return{module:t,func:i,payload:e.slice(3+s,3+s+n),next:e.slice(3+s+n)}}static compress(t,i){let r=null;function s(t,i,s){let n=e.framed(t,i,s);if(r){let e=new Uint8Array(r.length+n.length);e.set(r,0),e.set(n,r.length),r=e}else r=n}for(let e=0;e<t.length;e++){const r=t[e];r.parsed=s,r.parseFromJson(i)}return r}setHw(e){this._hw=e}sendCommand(e,t){this.parsed&&this.parsed(this.module,e,t)}parseFromJson(e){}notifyFromBinary(e,t,i){if(t===this.COMMAND_FUNC_ID_ERROR){e.debug||(e.debug={});let t={module:this.module,_args:[...i]};3==i.byteLength?(t.err0=i[0],t.err1=i[1],t.function=i[2],t.message=`Error module=${this.module} func=${t.function} err0=${t.err0} returned=${t.err1}`):t.message=`Error module=${this.module} with + ${t._args}`,e.debug.error=t}}envelopWarning(e,t,i){e[t]||(e[t]={}),e[t].warning=i}envelopError(e,t,i){e[t]||(e[t]={}),e[t].error=i}isValidIO(e){return"number"==typeof e&&0<=e&&e<=11}getSchema(e){return r.getSchema(e)}validateCommandSchema(e,t,i,r){let s={valid:0,invalid:0,results:[],invalidButLike:[]};for(let n of e){let e=this.validate(n.uri,t);if(s.results.push(e),e.valid)s.valid++,n.onValid&&n.onValid.bind(this)(this.filter(n.uri,t),r);else{s.invalid++;let t=this.onlyTypeErrorMessage(e,i);t&&s.invalidButLike.push({uri:n.uri,message:t})}}return s}validate(e,t){let i=this.getSchema(e);return r.validateMultiple(t,i)}onlyTypeErrorMessage(e,t){if(e.valid)return!0;if(e.missing&&e.missing.length>0)return!1;let i=[r.errorCodes.ANY_OF_MISSING,r.errorCodes.ONE_OF_MISSING,r.errorCodes.ONE_OF_MULTIPLE,r.errorCodes.NOT_PASSED,r.errorCodes.OBJECT_REQUIRED,r.errorCodes.OBJECT_ADDITIONAL_PROPERTIES,r.errorCodes.CIRCULAR_REFERENCE,r.errorCodes.FORMAT_CUSTOM,r.errorCodes.KEYWORD_CUSTOM,r.errorCodes.UNKNOWN_PROPERTY],s=[];for(let n of e.errors){if(n.code===r.errorCodes.INVALID_TYPE){if("object"===n.params.type||"object"===n.params.expected)return!1}else if(i.includes(n.code))return!1;let e=t+n.dataPath.replace(/\//g,".");s.push(`[${e}]${n.message}`)}return s.join(";")}filter(e,t){let i=this.getSchema(e);return this._filterSchema(i,t)}_filterSchema(e,t){if(e.$ref){let i=r.getSchema(e.$ref);return this._filterSchema(i,t)}if(void 0===t)return e.default;if("string"===e.type||"integer"===e.type||"boolean"===e.type||"number"===e.type||"null"===e.type||"pass_all"===e.filter)return t;if("array"===e.type){let i=[];for(let r in t)i[r]=this._filterSchema(e.items,t[r]);return i}if("object"===e.type){let i={};for(let r in e.properties)i[r]=this._filterSchema(e.properties[r],t[r]);for(let r in e.patternProperties){let s=new RegExp(r);for(let n of Object.keys(t))s.test(n)&&(i[n]=this._filterSchema(e.patternProperties[r],t[n]))}return i}throw Error("unknown json schema type")}get WSCommandNotFoundError(){return n}};class n extends Error{}},function(e,t,i){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=i(28),s=i(29),n=i(30);function a(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,i){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return c(this,e,t,i)}function c(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=l(e,t);return e}(e,t,i,r):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!h.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|m(t,i),s=(e=o(e,r)).write(t,i);s!==r&&(e=e.slice(0,s));return e}(e,t,i):function(e,t){if(h.isBuffer(t)){var i=0|p(t.length);return 0===(e=o(e,i)).length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?o(e,0):l(e,t);if("Buffer"===t.type&&n(t.data))return l(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(d(t),e=o(e,t<0?0:0|p(t)),!h.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function l(e,t){var i=t.length<0?0:0|p(t.length);e=o(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function m(e,t){if(h.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return N(e).length;default:if(r)return L(e).length;t=(""+t).toLowerCase(),r=!0}}function f(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,i);case"utf8":case"utf-8":return O(this,t,i);case"ascii":return P(this,t,i);case"latin1":case"binary":return E(this,t,i);case"base64":return A(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function y(e,t,i,r,s){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof t&&(t=h.from(t,r)),h.isBuffer(t))return 0===t.length?-1:_(e,t,i,r,s);if("number"==typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):_(e,[t],i,r,s);throw new TypeError("val must be string, number or Buffer")}function _(e,t,i,r,s){var n,a=1,o=e.length,h=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,o/=2,h/=2,i/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(s){var d=-1;for(n=i;n<o;n++)if(c(e,n)===c(t,-1===d?0:n-d)){if(-1===d&&(d=n),n-d+1===h)return d*a}else-1!==d&&(n-=n-d),d=-1}else for(i+h>o&&(i=o-h),n=i;n>=0;n--){for(var u=!0,l=0;l<h;l++)if(c(e,n+l)!==c(t,l)){u=!1;break}if(u)return n}return-1}function w(e,t,i,r){i=Number(i)||0;var s=e.length-i;r?(r=Number(r))>s&&(r=s):r=s;var n=t.length;if(n%2!=0)throw new TypeError("Invalid hex string");r>n/2&&(r=n/2);for(var a=0;a<r;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[i+a]=o}return a}function v(e,t,i,r){return W(L(t,e.length-i),e,i,r)}function b(e,t,i,r){return W(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function C(e,t,i,r){return b(e,t,i,r)}function x(e,t,i,r){return W(N(t),e,i,r)}function S(e,t,i,r){return W(function(e,t){for(var i,r,s,n=[],a=0;a<e.length&&!((t-=2)<0);++a)i=e.charCodeAt(a),r=i>>8,s=i%256,n.push(s),n.push(r);return n}(t,e.length-i),e,i,r)}function A(e,t,i){return 0===t&&i===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,i))}function O(e,t,i){i=Math.min(e.length,i);for(var r=[],s=t;s<i;){var n,a,o,h,c=e[s],d=null,u=c>239?4:c>223?3:c>191?2:1;if(s+u<=i)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(n=e[s+1]))&&(h=(31&c)<<6|63&n)>127&&(d=h);break;case 3:n=e[s+1],a=e[s+2],128==(192&n)&&128==(192&a)&&(h=(15&c)<<12|(63&n)<<6|63&a)>2047&&(h<55296||h>57343)&&(d=h);break;case 4:n=e[s+1],a=e[s+2],o=e[s+3],128==(192&n)&&128==(192&a)&&128==(192&o)&&(h=(15&c)<<18|(63&n)<<12|(63&a)<<6|63&o)>65535&&h<1114112&&(d=h)}null===d?(d=65533,u=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),s+=u}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var i="",r=0;for(;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=I));return i}(r)}t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,i){return c(null,e,t,i)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,i){return function(e,t,i,r){return d(t),t<=0?o(e,t):void 0!==i?"string"==typeof r?o(e,t).fill(i,r):o(e,t).fill(i):o(e,t)}(null,e,t,i)},h.allocUnsafe=function(e){return u(null,e)},h.allocUnsafeSlow=function(e){return u(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,s=0,n=Math.min(i,r);s<n;++s)if(e[s]!==t[s]){i=e[s],r=t[s];break}return i<r?-1:r<i?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!n(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=h.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){var a=e[i];if(!h.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,s),s+=a.length}return r},h.byteLength=m,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):f.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,i,r,s){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),t<0||i>e.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&t>=i)return 0;if(r>=s)return-1;if(t>=i)return 1;if(this===e)return 0;for(var n=(s>>>=0)-(r>>>=0),a=(i>>>=0)-(t>>>=0),o=Math.min(n,a),c=this.slice(r,s),d=e.slice(t,i),u=0;u<o;++u)if(c[u]!==d[u]){n=c[u],a=d[u];break}return n<a?-1:a<n?1:0},h.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},h.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},h.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},h.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var s=this.length-t;if((void 0===i||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var n=!1;;)switch(r){case"hex":return w(this,e,t,i);case"utf8":case"utf-8":return v(this,e,t,i);case"ascii":return b(this,e,t,i);case"latin1":case"binary":return C(this,e,t,i);case"base64":return x(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,i);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),n=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function P(e,t,i){var r="";i=Math.min(e.length,i);for(var s=t;s<i;++s)r+=String.fromCharCode(127&e[s]);return r}function E(e,t,i){var r="";i=Math.min(e.length,i);for(var s=t;s<i;++s)r+=String.fromCharCode(e[s]);return r}function k(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var s="",n=t;n<i;++n)s+=F(e[n]);return s}function q(e,t,i){for(var r=e.slice(t,i),s="",n=0;n<r.length;n+=2)s+=String.fromCharCode(r[n]+256*r[n+1]);return s}function T(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,i,r,s,n){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<n)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function D(e,t,i,r){t<0&&(t=65535+t+1);for(var s=0,n=Math.min(e.length-i,2);s<n;++s)e[i+s]=(t&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function j(e,t,i,r){t<0&&(t=4294967295+t+1);for(var s=0,n=Math.min(e.length-i,4);s<n;++s)e[i+s]=t>>>8*(r?s:3-s)&255}function z(e,t,i,r,s,n){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function $(e,t,i,r,n){return n||z(e,0,i,4),s.write(e,t,i,r,23,4),i+4}function B(e,t,i,r,n){return n||z(e,0,i,8),s.write(e,t,i,r,52,8),i+8}h.prototype.slice=function(e,t){var i,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=h.prototype;else{var s=t-e;i=new h(s,void 0);for(var n=0;n<s;++n)i[n]=this[n+e]}return i},h.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||T(e,t,this.length);for(var r=this[e],s=1,n=0;++n<t&&(s*=256);)r+=this[e+n]*s;return r},h.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||T(e,t,this.length);for(var r=this[e+--t],s=1;t>0&&(s*=256);)r+=this[e+--t]*s;return r},h.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||T(e,t,this.length);for(var r=this[e],s=1,n=0;++n<t&&(s*=256);)r+=this[e+n]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*t)),r},h.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||T(e,t,this.length);for(var r=t,s=1,n=this[e+--r];r>0&&(s*=256);)n+=this[e+--r]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},h.prototype.readInt8=function(e,t){return t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),s.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),s.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),s.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),s.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||R(this,e,t,i,Math.pow(2,8*i)-1,0);var s=1,n=0;for(this[t]=255&e;++n<i&&(s*=256);)this[t+n]=e/s&255;return t+i},h.prototype.writeUIntBE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||R(this,e,t,i,Math.pow(2,8*i)-1,0);var s=i-1,n=1;for(this[t+s]=255&e;--s>=0&&(n*=256);)this[t+s]=e/n&255;return t+i},h.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):j(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var s=Math.pow(2,8*i-1);R(this,e,t,i,s-1,-s)}var n=0,a=1,o=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},h.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var s=Math.pow(2,8*i-1);R(this,e,t,i,s-1,-s)}var n=i-1,a=1,o=0;for(this[t+n]=255&e;--n>=0&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},h.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):j(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,i){return $(this,e,t,!0,i)},h.prototype.writeFloatBE=function(e,t,i){return $(this,e,t,!1,i)},h.prototype.writeDoubleLE=function(e,t,i){return B(this,e,t,!0,i)},h.prototype.writeDoubleBE=function(e,t,i){return B(this,e,t,!1,i)},h.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var s,n=r-i;if(this===e&&i<t&&t<r)for(s=n-1;s>=0;--s)e[s+t]=this[s+i];else if(n<1e3||!h.TYPED_ARRAY_SUPPORT)for(s=0;s<n;++s)e[s+t]=this[s+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+n),t);return n},h.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!h.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var n;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(n=t;n<i;++n)this[n]=e;else{var a=h.isBuffer(e)?e:L(new h(e,r).toString()),o=a.length;for(n=0;n<i-t;++n)this[n+t]=a[n%o]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function L(e,t){var i;t=t||1/0;for(var r=e.length,s=null,n=[],a=0;a<r;++a){if((i=e.charCodeAt(a))>55295&&i<57344){if(!s){if(i>56319){(t-=3)>-1&&n.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&n.push(239,191,189);continue}s=i;continue}if(i<56320){(t-=3)>-1&&n.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(t-=3)>-1&&n.push(239,191,189);if(s=null,i<128){if((t-=1)<0)break;n.push(i)}else if(i<2048){if((t-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function N(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,i,r){for(var s=0;s<r&&!(s+i>=t.length||s>=e.length);++s)t[s+i]=e[s];return s}}).call(this,i(27))},function(e,t){e.exports={uuidFilter:function(e){return e.toLowerCase().replace(/[^0-9abcdef]/g,"")}}},function(e,t,i){(function(t){e.exports=class{constructor(e){this.obniz=e}createCanvasContext(e,t){if(!this.obniz.isNode){let i=document.createElement("canvas");return i.width=e,i.height=t,i.style["-webkit-font-smoothing"]="none",document.getElementsByTagName("body")[0].appendChild(i),i.getContext("2d")}try{const{createCanvas:e}=i(11);return e(this.width,this.height)}catch(e){throw new Error("obniz.js require node-canvas to draw rich contents. see more detail on docs")}}static _keyFilter(e,t){let i={};return"object"!=typeof e?i:i=Object.keys(e).filter(e=>t.includes(e)).reduce((t,i)=>(t[i]=e[i],t),{})}static _requiredKeys(e,t){if("object"!=typeof e)return t[0];for(let i in t)if(!(t[i]in e))return t[i];return null}static dataArray2string(e){let r=null;try{const s=i(31).StringDecoder;s&&(r=new s("utf8").write(t.from(e)))}catch(e){}return r}static string2dataArray(e){return[...t.from(e)]}}}).call(this,i(1).Buffer)},function(e,t){e.exports=class{constructor(){this.keys=["vcc","gnd","output"],this.requiredKeys=["output"],this.drive="5v"}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,this.drive),this.ad=e.getAD(this.params.output),this.ad.start(function(e){this.temp=this.calc(e),this.onchange(this.temp)}.bind(this))}async getWait(){let e=await this.ad.getWait();return this.temp=this.calc(e),this.temp}onchange(e){}calc(e){return 0}}},function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty,s="~";function n(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new a(i,r||e,n),h=s?s+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],o]:e._events[h].push(o):(e._events[h]=o,e._eventsCount++),e}function h(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),c.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},c.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},c.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,r,n,a){var o=s?s+e:e;if(!this._events[o])return!1;var h,c,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,r),!0;case 5:return d.fn.call(d.context,t,i,r,n),!0;case 6:return d.fn.call(d.context,t,i,r,n,a),!0}for(c=1,h=new Array(u-1);c<u;c++)h[c-1]=arguments[c];d.fn.apply(d.context,h)}else{var l,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,r);break;default:if(!h)for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];d[c].fn.apply(d[c].context,h)}}return!0},c.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},c.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},c.prototype.removeListener=function(e,t,i,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return h(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||h(this,n);else{for(var o=0,c=[],d=a.length;o<d;o++)(a[o].fn!==t||r&&!a[o].once||i&&a[o].context!==i)&&c.push(a[o]);c.length?this._events[n]=1===c.length?c[0]:c:h(this,n)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&h(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=s,c.EventEmitter=c,e.exports=c},function(e,t,i){(function(i){var r;t=e.exports=K,r="object"==typeof i&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var s=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],o=t.src=[],h=0,c=h++;o[c]="0|[1-9]\\d*";var d=h++;o[d]="[0-9]+";var u=h++;o[u]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var l=h++;o[l]="("+o[c]+")\\.("+o[c]+")\\.("+o[c]+")";var p=h++;o[p]="("+o[d]+")\\.("+o[d]+")\\.("+o[d]+")";var m=h++;o[m]="(?:"+o[c]+"|"+o[u]+")";var f=h++;o[f]="(?:"+o[d]+"|"+o[u]+")";var g=h++;o[g]="(?:-("+o[m]+"(?:\\."+o[m]+")*))";var y=h++;o[y]="(?:-?("+o[f]+"(?:\\."+o[f]+")*))";var _=h++;o[_]="[0-9A-Za-z-]+";var w=h++;o[w]="(?:\\+("+o[_]+"(?:\\."+o[_]+")*))";var v=h++,b="v?"+o[l]+o[g]+"?"+o[w]+"?";o[v]="^"+b+"$";var C="[v=\\s]*"+o[p]+o[y]+"?"+o[w]+"?",x=h++;o[x]="^"+C+"$";var S=h++;o[S]="((?:<|>)?=?)";var A=h++;o[A]=o[d]+"|x|X|\\*";var O=h++;o[O]=o[c]+"|x|X|\\*";var I=h++;o[I]="[v=\\s]*("+o[O]+")(?:\\.("+o[O]+")(?:\\.("+o[O]+")(?:"+o[g]+")?"+o[w]+"?)?)?";var P=h++;o[P]="[v=\\s]*("+o[A]+")(?:\\.("+o[A]+")(?:\\.("+o[A]+")(?:"+o[y]+")?"+o[w]+"?)?)?";var E=h++;o[E]="^"+o[S]+"\\s*"+o[I]+"$";var k=h++;o[k]="^"+o[S]+"\\s*"+o[P]+"$";var q=h++;o[q]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var T=h++;o[T]="(?:~>?)";var R=h++;o[R]="(\\s*)"+o[T]+"\\s+",a[R]=new RegExp(o[R],"g");var D=h++;o[D]="^"+o[T]+o[I]+"$";var j=h++;o[j]="^"+o[T]+o[P]+"$";var z=h++;o[z]="(?:\\^)";var $=h++;o[$]="(\\s*)"+o[z]+"\\s+",a[$]=new RegExp(o[$],"g");var B=h++;o[B]="^"+o[z]+o[I]+"$";var M=h++;o[M]="^"+o[z]+o[P]+"$";var F=h++;o[F]="^"+o[S]+"\\s*("+C+")$|^$";var L=h++;o[L]="^"+o[S]+"\\s*("+b+")$|^$";var N=h++;o[N]="(\\s*)"+o[S]+"\\s*("+C+"|"+o[I]+")",a[N]=new RegExp(o[N],"g");var W=h++;o[W]="^\\s*("+o[I]+")\\s+-\\s+("+o[I]+")\\s*$";var V=h++;o[V]="^\\s*("+o[P]+")\\s+-\\s+("+o[P]+")\\s*$";var G=h++;o[G]="(<|>)?=?\\s*\\*";for(var U=0;U<35;U++)r(U,o[U]),a[U]||(a[U]=new RegExp(o[U]));function H(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof K)return e;if("string"!=typeof e)return null;if(e.length>s)return null;if(!(t.loose?a[x]:a[v]).test(e))return null;try{return new K(e,t)}catch(e){return null}}function K(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof K){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>s)throw new TypeError("version is longer than "+s+" characters");if(!(this instanceof K))return new K(e,t);r("SemVer",e,t),this.options=t,this.loose=!!t.loose;var i=e.trim().match(t.loose?a[x]:a[v]);if(!i)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<n)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}t.parse=H,t.valid=function(e,t){var i=H(e,t);return i?i.version:null},t.clean=function(e,t){var i=H(e.trim().replace(/^[=v]+/,""),t);return i?i.version:null},t.SemVer=K,K.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},K.prototype.toString=function(){return this.version},K.prototype.compare=function(e){return r("SemVer.compare",this.version,this.options,e),e instanceof K||(e=new K(e,this.options)),this.compareMain(e)||this.comparePre(e)},K.prototype.compareMain=function(e){return e instanceof K||(e=new K(e,this.options)),J(this.major,e.major)||J(this.minor,e.minor)||J(this.patch,e.patch)},K.prototype.comparePre=function(e){if(e instanceof K||(e=new K(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var i=this.prerelease[t],s=e.prerelease[t];if(r("prerelease compare",t,i,s),void 0===i&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===i)return-1;if(i!==s)return J(i,s)}while(++t)},K.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var i=this.prerelease.length;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);-1===i&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,i,r){"string"==typeof i&&(r=i,i=void 0);try{return new K(e,i).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var i=H(e),r=H(t),s="";if(i.prerelease.length||r.prerelease.length){s="pre";var n="prerelease"}for(var a in i)if(("major"===a||"minor"===a||"patch"===a)&&i[a]!==r[a])return s+a;return n},t.compareIdentifiers=J;var Y=/^[0-9]+$/;function J(e,t){var i=Y.test(e),r=Y.test(t);return i&&r&&(e=+e,t=+t),e===t?0:i&&!r?-1:r&&!i?1:e<t?-1:1}function X(e,t,i){return new K(e,i).compare(new K(t,i))}function Q(e,t,i){return X(e,t,i)>0}function Z(e,t,i){return X(e,t,i)<0}function ee(e,t,i){return 0===X(e,t,i)}function te(e,t,i){return 0!==X(e,t,i)}function ie(e,t,i){return X(e,t,i)>=0}function re(e,t,i){return X(e,t,i)<=0}function se(e,t,i,r){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e===i;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e!==i;case"":case"=":case"==":return ee(e,i,r);case"!=":return te(e,i,r);case">":return Q(e,i,r);case">=":return ie(e,i,r);case"<":return Z(e,i,r);case"<=":return re(e,i,r);default:throw new TypeError("Invalid operator: "+t)}}function ne(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof ne){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof ne))return new ne(e,t);r("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ae?this.value="":this.value=this.operator+this.semver.version,r("comp",this)}t.rcompareIdentifiers=function(e,t){return J(t,e)},t.major=function(e,t){return new K(e,t).major},t.minor=function(e,t){return new K(e,t).minor},t.patch=function(e,t){return new K(e,t).patch},t.compare=X,t.compareLoose=function(e,t){return X(e,t,!0)},t.rcompare=function(e,t,i){return X(t,e,i)},t.sort=function(e,i){return e.sort((function(e,r){return t.compare(e,r,i)}))},t.rsort=function(e,i){return e.sort((function(e,r){return t.rcompare(e,r,i)}))},t.gt=Q,t.lt=Z,t.eq=ee,t.neq=te,t.gte=ie,t.lte=re,t.cmp=se,t.Comparator=ne;var ae={};function oe(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof oe)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new oe(e.raw,t);if(e instanceof ne)return new oe(e.value,t);if(!(this instanceof oe))return new oe(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function he(e){return!e||"x"===e.toLowerCase()||"*"===e}function ce(e,t,i,r,s,n,a,o,h,c,d,u,l){return((t=he(i)?"":he(r)?">="+i+".0.0":he(s)?">="+i+"."+r+".0":">="+t)+" "+(o=he(h)?"":he(c)?"<"+(+h+1)+".0.0":he(d)?"<"+h+"."+(+c+1)+".0":u?"<="+h+"."+c+"."+d+"-"+u:"<="+o)).trim()}function de(e,t,i){for(var s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(s=0;s<e.length;s++)if(r(e[s].semver),e[s].semver!==ae&&e[s].semver.prerelease.length>0){var n=e[s].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}function ue(e,t,i){try{t=new oe(t,i)}catch(e){return!1}return t.test(e)}function le(e,t,i,r){var s,n,a,o,h;switch(e=new K(e,r),t=new oe(t,r),i){case">":s=Q,n=re,a=Z,o=">",h=">=";break;case"<":s=Z,n=ie,a=Q,o="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ue(e,t,r))return!1;for(var c=0;c<t.set.length;++c){var d=t.set[c],u=null,l=null;if(d.forEach((function(e){e.semver===ae&&(e=new ne(">=0.0.0")),u=u||e,l=l||e,s(e.semver,u.semver,r)?u=e:a(e.semver,l.semver,r)&&(l=e)})),u.operator===o||u.operator===h)return!1;if((!l.operator||l.operator===o)&&n(e,l.semver))return!1;if(l.operator===h&&a(e,l.semver))return!1}return!0}ne.prototype.parse=function(e){var t=this.options.loose?a[F]:a[L],i=e.match(t);if(!i)throw new TypeError("Invalid comparator: "+e);this.operator=i[1],"="===this.operator&&(this.operator=""),i[2]?this.semver=new K(i[2],this.options.loose):this.semver=ae},ne.prototype.toString=function(){return this.value},ne.prototype.test=function(e){return r("Comparator.test",e,this.options.loose),this.semver===ae||("string"==typeof e&&(e=new K(e,this.options)),se(e,this.operator,this.semver,this.options))},ne.prototype.intersects=function(e,t){if(!(e instanceof ne))throw new TypeError("a Comparator is required");var i;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return i=new oe(e.value,t),ue(this.value,i,t);if(""===e.operator)return i=new oe(this.value,t),ue(e.semver,i,t);var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),s=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),n=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=se(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),h=se(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||s||n&&a||o||h},t.Range=oe,oe.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},oe.prototype.toString=function(){return this.range},oe.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var i=t?a[V]:a[W];e=e.replace(i,ce),r("hyphen replace",e),e=e.replace(a[N],"$1$2$3"),r("comparator trim",e,a[N]),e=(e=(e=e.replace(a[R],"$1~")).replace(a[$],"$1^")).split(/\s+/).join(" ");var s=t?a[F]:a[L],n=e.split(" ").map((function(e){return function(e,t){return r("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){r("caret",e,t);var i=t.loose?a[M]:a[B];return e.replace(i,(function(t,i,s,n,a){var o;return r("caret",e,t,i,s,n,a),he(i)?o="":he(s)?o=">="+i+".0.0 <"+(+i+1)+".0.0":he(n)?o="0"===i?">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":">="+i+"."+s+".0 <"+(+i+1)+".0.0":a?(r("replaceCaret pr",a),o="0"===i?"0"===s?">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+s+"."+(+n+1):">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+(+s+1)+".0":">="+i+"."+s+"."+n+"-"+a+" <"+(+i+1)+".0.0"):(r("no pr"),o="0"===i?"0"===s?">="+i+"."+s+"."+n+" <"+i+"."+s+"."+(+n+1):">="+i+"."+s+"."+n+" <"+i+"."+(+s+1)+".0":">="+i+"."+s+"."+n+" <"+(+i+1)+".0.0"),r("caret return",o),o}))}(e,t)})).join(" ")}(e,t),r("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var i=t.loose?a[j]:a[D];return e.replace(i,(function(t,i,s,n,a){var o;return r("tilde",e,t,i,s,n,a),he(i)?o="":he(s)?o=">="+i+".0.0 <"+(+i+1)+".0.0":he(n)?o=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":a?(r("replaceTilde pr",a),o=">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+(+s+1)+".0"):o=">="+i+"."+s+"."+n+" <"+i+"."+(+s+1)+".0",r("tilde return",o),o}))}(e,t)})).join(" ")}(e,t),r("tildes",e),e=function(e,t){return r("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var i=t.loose?a[k]:a[E];return e.replace(i,(function(t,i,s,n,a,o){r("xRange",e,t,i,s,n,a,o);var h=he(s),c=h||he(n),d=c||he(a);return"="===i&&d&&(i=""),h?t=">"===i||"<"===i?"<0.0.0":"*":i&&d?(c&&(n=0),a=0,">"===i?(i=">=",c?(s=+s+1,n=0,a=0):(n=+n+1,a=0)):"<="===i&&(i="<",c?s=+s+1:n=+n+1),t=i+s+"."+n+"."+a):c?t=">="+s+".0.0 <"+(+s+1)+".0.0":d&&(t=">="+s+"."+n+".0 <"+s+"."+(+n+1)+".0"),r("xRange return",t),t}))}(e,t)})).join(" ")}(e,t),r("xrange",e),e=function(e,t){return r("replaceStars",e,t),e.trim().replace(a[G],"")}(e,t),r("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(n=n.filter((function(e){return!!e.match(s)}))),n=n.map((function(e){return new ne(e,this.options)}),this)},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Range is required");return this.set.some((function(i){return i.every((function(i){return e.set.some((function(e){return e.every((function(e){return i.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new oe(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},oe.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new K(e,this.options));for(var t=0;t<this.set.length;t++)if(de(this.set[t],e,this.options))return!0;return!1},t.satisfies=ue,t.maxSatisfying=function(e,t,i){var r=null,s=null;try{var n=new oe(t,i)}catch(e){return null}return e.forEach((function(e){n.test(e)&&(r&&-1!==s.compare(e)||(s=new K(r=e,i)))})),r},t.minSatisfying=function(e,t,i){var r=null,s=null;try{var n=new oe(t,i)}catch(e){return null}return e.forEach((function(e){n.test(e)&&(r&&1!==s.compare(e)||(s=new K(r=e,i)))})),r},t.minVersion=function(e,t){e=new oe(e,t);var i=new K("0.0.0");if(e.test(i))return i;if(i=new K("0.0.0-0"),e.test(i))return i;i=null;for(var r=0;r<e.set.length;++r){e.set[r].forEach((function(e){var t=new K(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!Q(i,t)||(i=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(i&&e.test(i))return i;return null},t.validRange=function(e,t){try{return new oe(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,i){return le(e,t,"<",i)},t.gtr=function(e,t,i){return le(e,t,">",i)},t.outside=le,t.prerelease=function(e,t){var i=H(e,t);return i&&i.prerelease.length?i.prerelease:null},t.intersects=function(e,t,i){return e=new oe(e,i),t=new oe(t,i),e.intersects(t)},t.coerce=function(e){if(e instanceof K)return e;if("string"!=typeof e)return null;var t=e.match(a[q]);if(null==t)return null;return H(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,i(41))},function(e,t,i){const r=i(3),s=i(5),n=i(2);e.exports=class{constructor(e){if(this.uuid=n.uuidFilter(e.uuid),this.parent=null,this.children=[],this.isRemote=!1,this.discoverdOnRemote=!1,this.data=e.data||null,!this.data&&e.text&&(this.data=r.string2dataArray(e.text)),!this.data&&e.value&&(this.data=[e.value]),e[this.childrenName])for(let t of e[this.childrenName])this.addChild(t);this.setFunctions(),this.emitter=new s}setFunctions(){let e=this.childrenName;if(e){let t=(e=e.charAt(0).toUpperCase()+e.slice(1)).slice(0,-1),i="add"+t;this[i]=this.addChild,this[i="get"+t]=this.getChild}let t=this.parentName;t&&Object.defineProperty(this,t,{get(){return this.parent},set(e){this.parent=e}})}get childrenClass(){return Object}get childrenName(){return null}get parentName(){return null}addChild(e){if(!(e instanceof this.childrenClass)){e=new(0,this.childrenClass)(e)}return e.parent=this,this.children.push(e),e}getChild(e){return e=n.uuidFilter(e),this.children.filter((function(t){return n.uuidFilter(t.uuid)===e})).shift()}toJSON(){let e={uuid:n.uuidFilter(this.uuid)};if(this.children.length>0){e[this.childrenName]=this.children}return this.data&&(e.data=this.data),e}read(){}write(){}writeNumber(e,t){this.write([e],t)}writeText(e,t){this.write(r.string2dataArray(e),t)}readWait(){return new Promise(e=>{this.emitter.once("onread",t=>{"success"===t.result?e(t.data):e(void 0)}),this.read()})}writeWait(e,t){return new Promise(i=>{this.emitter.once("onwrite",e=>{i("success"===e.result)}),this.write(e,t)})}writeTextWait(e){return new Promise(t=>{this.emitter.once("onwrite",e=>{t("success"===e.result)}),this.writeText(e)})}writeNumberWait(e){return new Promise(t=>{this.emitter.once("onwrite",e=>{t("success"===e.result)}),this.writeNumber(e)})}readFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",()=>{e()})})}writeFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",t=>{e(t.data)})})}onwrite(){}onread(){}onwritefromremote(){}onreadfromremote(){}onerror(e){console.error(e.message)}notifyFromServer(e,t){switch(this.emitter.emit(e,t),e){case"onerror":this.onerror(t);break;case"onwrite":this.onwrite(t.result);break;case"onread":this.onread(t.data);break;case"onwritefromremote":this.onwritefromremote(t.address,t.data);break;case"onreadfromremote":this.onreadfromremote(t.address)}}}},function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=8},function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=9},function(e,t){e.exports=class{constructor(){this.keys=["gnd","sda","scl","i2c","vcc"],this.requiredKeys=[],this.i2cinfo=this.i2cInfo(),this.address=this.i2cinfo.address}i2cInfo(){throw new Error("abstruct class")}wired(e){this.obniz=e,e.setVccGnd(null,this.params.gnd,this.i2cinfo.voltage),this.params.clock=this.i2cinfo.clock,this.params.pull=this.i2cinfo.voltage,this.params.mode="master",this.i2c=this.obniz.getI2CWithConfig(this.params)}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}async readWait(e,t){return this.i2c.write(this.address,[e]),await this.i2c.readWait(this.address,t)}async readUint16Wait(e,t){return this.i2c.write(this.address,[e]),await this.i2c.readWait(this.address,t)}write(e,t){Array.isArray(t)||(t=[t]),this.i2c.write(this.address,[e,...t])}}},function(e,t){e.exports=void 0},function(e,t,i){const r=i(7);e.exports=class extends r{constructor(e){super(e),this.isRemote=!1,this.discoverdOnRemote=!1}get wsChildUuidName(){let e=this.childrenName;return e?e.slice(0,-1)+"_uuid":null}getChild(e){let t=super.getChild(e);return t||(t=this.addChild({uuid:e})),t}discoverChildren(){}discoverChildrenWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{let t=this.children.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverChildren()})}ondiscover(){}ondiscoverfinished(){}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"discover":{let e=this.getChild(t[this.wsChildUuidName]);e.discoverdOnRemote=!0,e.properties=t.properties||[],this.ondiscover(e);break}case"discoverfinished":{let e=this.children.filter(e=>e.discoverdOnRemote);this.ondiscoverfinished(e);break}}}}},function(e,t,i){const r=i(7),s=i(14),n=i(2);e.exports=class extends r{constructor(e){super(e),this.addCharacteristic=this.addChild,this.getCharacteristic=this.getChild}get parentName(){return"peripheral"}get childrenName(){return"characteristics"}get childrenClass(){return s}get advData(){return{flags:["general_discoverable_mode","br_edr_not_supported"],serviceUuids:[this.uuid]}}end(){this.peripheral.Obniz.send({ble:{peripheral:{stop_service:{service_uuid:n.uuidFilter(this.uuid)}}}}),this.peripheral.removeService(this.uuid)}notify(e,t){}}},function(e,t,i){const r=i(15),s=i(7),n=i(2);e.exports=class extends s{constructor(e){super(e),this.addDescriptor=this.addChild,this.getDescriptor=this.getChild,this.properties=e.properties||[],Array.isArray(this.properties)||(this.properties=[this.properties]),this.permissions=e.permissions||[],Array.isArray(this.permissions)||(this.permissions=[this.permissions])}get parentName(){return"service"}get childrenClass(){return r}get childrenName(){return"descriptors"}toJSON(){let e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),this.permissions.length>0&&(e.permissions=this.permissions),e}addProperty(e){this.properties.includes(e)||this.properties.push(e)}removeProperty(e){this.properties=this.properties.filter(t=>t!==e)}addPermission(e){this.permissions.includes(e)||this.permissions.push(e)}removePermission(e){this.permissions=this.permissions.filter(t=>t!==e)}write(e){this.service.peripheral.Obniz.send({ble:{peripheral:{write_characteristic:{service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid),data:e}}}})}read(){this.service.peripheral.Obniz.send({ble:{peripheral:{read_characteristic:{service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}}})}notify(){this.service.peripheral.Obniz.send({ble:{peripheral:{notify_characteristic:{service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}}})}}},function(e,t,i){const r=i(7),s=i(2);e.exports=class extends r{constructor(e){super(e),this.permissions=e.permissions||[],Array.isArray(this.permissions)||(this.permissions=[this.permissions])}get parentName(){return"characteristic"}addPermission(e){this.permissions.includes(e)||this.permissions.push(e)}removePermission(e){this.permissions=this.permissions.filter(t=>t!==e)}toJSON(){let e=super.toJSON();return this.permissions.length>0&&(e.permissions=this.permissions),e}write(e){this.characteristic.service.peripheral.Obniz.send({ble:{peripheral:{write_descriptor:{service_uuid:s.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.uuidFilter(this.characteristic.uuid),descriptor_uuid:this.uuid,data:e}}}})}read(){this.characteristic.service.peripheral.Obniz.send({ble:{peripheral:{read_descriptor:{service_uuid:s.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.uuidFilter(this.characteristic.uuid),descriptor_uuid:this.uuid}}}})}}},function(e,t){e.exports={}},function(e,t,i){const r=i(0),s=1,n=2,a=3,o=4,h=240,c={0:"unknown error",1:"heavy output. output voltage is too low when driving high",2:"heavy output. output voltage is too high when driving low",3:"output voltage is too low when driving high. io state has changed output to input",4:"output voltage is too high when driving low. io state has changed output to input"},d={1:"io.input",2:"io.output",3:"pwm",4:"uart",5:"i2c",6:"spi",7:"LogicAnalyzer",8:"Measure"};e.exports=class extends r{constructor(){super(),this.module=2,this._CommandOutput=0,this._CommandInputStream=1,this._CommandInputOnece=2,this._CommandOutputType=3,this._CommandPullResisterType=4,this._CommandEnd=5}output(e,t){let i=new Uint8Array([t,e]);this.sendCommand(this._CommandOutput,i)}outputDetail(e,t){let i=new Uint8Array([t,e.value]);this.sendCommand(this._CommandOutput,i)}input(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandInputOnece,i)}inputDetail(e,t){let i=new Uint8Array([t]);this.sendCommand(e.stream?this._CommandInputStream:this._CommandInputOnece,i)}outputType(e,t){let i=new Uint8Array(2);if(i[0]=t,"push-pull5v"===e.output_type)i[1]=0;else if("push-pull3v"===e.output_type)i[1]=2;else{if("open-drain"!==e.output_type)return"io unknown outputtype: "+e.output_type;i[1]=3}this.sendCommand(this._CommandOutputType,i)}pullType(e,t){let i=new Uint8Array(2);if(i[0]=t,"float"===e.pull_type)i[1]=0;else if("pull-up3v"===e.pull_type)i[1]=1;else if("pull-down"===e.pull_type)i[1]=2;else{if("pull-up5v"!==e.pull_type)return"io unknown pull_type: "+e.pull_type;i[1]=3}this.sendCommand(this._CommandPullResisterType,i)}deinit(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandEnd,i)}parseFromJson(e){for(let t=0;t<40;t++){let i=e["io"+t];if(void 0===i)continue;let r=[{uri:"/request/io/input",onValid:this.input},{uri:"/request/io/input_detail",onValid:this.inputDetail},{uri:"/request/io/output",onValid:this.output},{uri:"/request/io/output_detail",onValid:this.outputDetail},{uri:"/request/io/output_type",onValid:this.outputType},{uri:"/request/io/pull_type",onValid:this.pullType},{uri:"/request/io/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"io"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[io${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandInputStream||t===this._CommandInputOnece)for(let t=0;t<i.byteLength;t+=2)e["io"+i[t]]=i[t+1]>0;else if(t===this.COMMAND_FUNC_ID_ERROR&&i.byteLength>=4){const t=i[1],r=i[3];if(t===s||t===n)this.envelopWarning(e,`io${r}`,{message:c[t]});else if(t===a||t===o)this.envelopError(e,`io${r}`,{message:c[t]});else if(t===h&&i.byteLength>=6){const t=i[4],s=i[5];this.envelopWarning(e,"debug",{message:`io${r} binded "${d[t]}" was stopped. "${d[s]}" have started using this io.`})}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=3,this.ModuleNum=6,this.resetInternalStatus(),this._CommandInit=0,this._CommandDeinit=1,this._CommandSetFreq=2,this._CommandSetDuty=3,this._CommandAMModulate=4}resetInternalStatus(){this.pwms=[];for(let e=0;e<this.ModuleNum;e++)this.pwms.push({})}init(e,t){let i=new Uint8Array(2);i[0]=t,i[1]=e.io,this.pwms[t].io=e.io,this.sendCommand(this._CommandInit,i)}deinit(e,t){let i=new Uint8Array(1);i[0]=t,this.pwms[t]={},this.sendCommand(this._CommandDeinit,i)}freq(e,t){let i=new Uint8Array(5);i[0]=t,i[1]=e.freq>>24,i[2]=e.freq>>16,i[3]=e.freq>>8,i[4]=e.freq,this.pwms[t].freq=e.freq,this.sendCommand(this._CommandSetFreq,i)}pulse(e,t){let i=new Uint8Array(5),r=1e3*e.pulse;i[0]=t,i[1]=r>>24,i[2]=r>>16,i[3]=r>>8,i[4]=r,this.pwms[t].pulseUSec=r,this.sendCommand(this._CommandSetDuty,i)}amModulate(e,t){const i=e.modulate.data.length,r=parseInt((i+7)/8);let s=new Uint8Array(5+r),n=1e3*e.modulate.symbol_length;s[0]=t,s[1]=n>>24,s[2]=n>>16,s[3]=n>>8,s[4]=n;let a=0;for(let t=0;t<r;t++){s[5+t]=0;for(let i=0;i<8;i++)e.modulate.data[a++]&&(s[5+t]|=128>>>i)}this.sendCommand(this._CommandAMModulate,s)}parseFromJson(e){for(let t=0;t<this.ModuleNum;t++){let i=e["pwm"+t];if(void 0===i)continue;let r=[{uri:"/request/pwm/init",onValid:this.init},{uri:"/request/pwm/freq",onValid:this.freq},{uri:"/request/pwm/pulse",onValid:this.pulse},{uri:"/request/pwm/modulate",onValid:this.amModulate},{uri:"/request/pwm/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"pwm"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[pwm${t}]unknown command`)}}}},function(e){e.exports=JSON.parse('{"name":"obniz","version":"2.4.0","description":"obniz sdk for javascript","main":"index.js","types":"obniz.d.ts","engines":{"node":">=7.6.0"},"engineStrict":true,"scripts":{"test":"npm run tstest && nyc --reporter=text --reporter=html mocha $NODE_DEBUG_OPTION  ./test/index.js -b 1","buildAndtest":"npm run build && npm test","tstest":"tsc --project ./test","realtest":"mocha $NODE_DEBUG_OPTION ./realtest/index.js","realtest-debug":"DEBUG=1 mocha $NODE_DEBUG_OPTION -b ./realtest/index.js","realtest-esp32":"mocha $NODE_DEBUG_OPTION ./realtest_esp32/index.js","local":"gulp --gulpfile ./_tools/server.js --cwd .","build":"npm run lint && gulp --gulpfile ./_tools/server.js --cwd . build","version":"npm run build && git add obniz.js && git add obniz.min.js","lint":"eslint --fix . --rulesdir eslint/rule","precommit":"lint-staged && npm run build && git add obniz.js && git add obniz.min.js"},"lint-staged":{"*.js":["eslint --rulesdir eslint/rule --fix ","git add"]},"keywords":["obniz"],"repository":"obniz/obniz","author":"yukisato <yuki@yuki-sato.com>","homepage":"https://obniz.io/","license":"SEE LICENSE IN LICENSE.txt","devDependencies":{"chai":"^4.2.0","chai-like":"^1.1.1","child_process":"^1.0.2","concat-with-sourcemaps":"^1.1.0","ejs":"^2.6.2","eslint":"^5.16.0","eslint-config-prettier":"^3.6.0","eslint-plugin-jasmine":"^2.10.1","eslint-plugin-prettier":"^2.7.0","express":"^4.17.1","get-port":"^4.0.0","glob":"^7.1.3","gulp":"^4.0.2","gulp-concat":"^2.6.1","gulp-ejs":"^3.2.0","gulp-filter":"^5.1.0","gulp-notify":"^3.2.0","gulp-plumber":"^1.2.0","gulp-rename":"^1.4.0","gulp-sort":"^2.0.0","gulp-util":"^3.0.8","gulp-yaml":"^2.0.2","husky":"^0.14.3","json-loader":"^0.5.7","lint-staged":"^9.4.1","mocha":"^5.2.0","mocha-chrome":"^1.1.0","mocha-directory":"^2.3.0","mocha-sinon":"^2.1.0","natives":"^1.1.6","ncp":"^2.0.0","node-notifier":"^5.3.0","nyc":"^14.1.1","path":"^0.12.7","prettier":"^1.14.3","sinon":"^7.5.0","text-encoding":"^0.7.0","through2":"^2.0.3","typescript":"^3.6.4","uglifyjs-webpack-plugin":"^1.3.0","vinyl":"^2.2.0","webpack":"^4.34.0","webpack-cli":"^3.3.4","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","yaml-loader":"^0.5.0"},"dependencies":{"eventemitter3":"^3.1.2","js-yaml":"^3.13.1","node-dir":"^0.1.17","node-fetch":"^2.3.0","semver":"^5.7.0","tv4":"^1.3.0","ws":"^6.1.4"},"bugs":{"url":"https://forum.obniz.io"},"private":false,"browser":{"ws":"./obniz/libs/webpackReplace/ws.js","canvas":"./obniz/libs/webpackReplace/canvas.js","./obniz/libs/webpackReplace/require-context.js":"./obniz/libs/webpackReplace/require-context-browser.js"}}')},function(e,t){let i;i="undefined"!=typeof WebSocket?WebSocket:"undefined"!=typeof MozWebSocket?MozWebSocket:window.WebSocket||window.MozWebSocket,e.exports=i},function(e,t,i){(function(t){const r=i(22),s=i(236),n=i(3),a="undefined"==typeof window;class o extends r{constructor(e,t){super(e,t),this.util=new n(this)}repeat(e,t){if(this.looper)return this.looper=e,void(this.repeatInterval=t||this.repeatInterval||100);this.looper=e,this.repeatInterval=t||100,this.onConnectCalled&&this.loop()}async loop(){if("function"==typeof this.looper&&this.onConnectCalled){let e=this.looper();e instanceof Promise&&await e,setTimeout(this.loop.bind(this),this.repeatInterval||100)}}_callOnConnect(){super._callOnConnect(),this.loop()}message(e,t){let i=[];"string"==typeof e?i.push(e):i=e,this.send({message:{to:i,data:t}})}notifyToModule(e){if(super.notifyToModule(e),"object"==typeof e.message&&this.onmessage&&this.onmessage(e.message.data,e.message.from),"object"==typeof e.debug){if(e.debug.warning){let t="Warning: "+e.debug.warning.message;this.warning({alert:"warning",message:t})}if(e.debug.error){let t="Error: "+e.debug.error.message;this.error({alert:"error",message:t})}this.ondebug&&this.ondebug(e.debug)}}warning(e){if(this.isNode)console.error(e);else{if(e&&"object"==typeof e&&e.alert)return this.showAlertUI(e),void console.log(e.message);h(new Error(e)),console.log(`Warning: ${e}`)}}error(e){this.isNode?console.error(e):(e&&"object"==typeof e&&e.alert&&(this.showAlertUI(e),e=e.message),h(new Error(e)),console.error(new Error(e)))}static get api(){return s}}e.exports=o;try{if(!a){function h(e){window.parent&&window.parent.logger&&window.parent.logger.onObnizError(e)}window&&window.parent&&window.parent.userAppLoaded&&window.parent.userAppLoaded(window)}}catch(e){e instanceof DOMException||console.error(e)}i(9).context=i(16),i(9).context&&i(9).context.setBaseDir&&i(9).context.setBaseDir(t);let c=i(238);for(let e of c.keys()){const t=c(e);t.info&&o.PartsRegistrate(t)}}).call(this,"/")},function(e,t,i){const r=i(23);e.exports=class extends r{constructor(e,t){super(e,t)}isValidObnizId(e){if("string"!=typeof e||e.length<8)return null;e=e.replace("-","");let t=parseInt(e);return isNaN(t)&&(t=null),null!=t}wsconnect(e){if(this.showOffLine(),this.isValidObnizId(this.id))super.wsconnect(e);else if(this.isNode)this.error("invalid obniz id");else{let t=function(e){let t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let r=i[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}("obniz-last-used")||"";this.prompt(t,function(t){this.id=t,this.wsconnect(e)}.bind(this))}}showAlertUI(e){if(this.isNode||!document.getElementById(this.options.debug_dom_id))return;let t=`\n    <div style="background-color:${"warning"===e.alert?"#ffee35":"#ff7b34"}">${e.message}</div>`;document.getElementById(this.options.debug_dom_id).insertAdjacentHTML("beforeend",t)}getDebugDoms(){if(this.isNode)return;let e=document.querySelector("#loader"),t=document.querySelector("#"+this.options.debug_dom_id),i=document.querySelector("#"+this.options.debug_dom_id+" #online-status");return t&&!i&&((i=document.createElement("div")).id="online-status",i.style.color="#FFF",i.style.padding="5px",i.style.textAlign="center",t.insertBefore(i,t.firstChild)),{loaderDom:e,debugDom:t,statusDom:i}}_callOnConnect(){this.updateOnlineUI(),super._callOnConnect()}close(){super.close(),this.updateOnlineUI()}_disconnectLocal(){super._disconnectLocal(),this.updateOnlineUI()}updateOnlineUI(){if(this.isNode)return;const e=this.socket&&1===this.socket.readyState,t=this.socket_local&&1===this.socket_local.readyState;e&&t?this.showOnLine(!0):e?this.showOnLine(!1):this.showOffLine()}showOnLine(e){if(this.isNode)return;const t=this.getDebugDoms();t.loaderDom&&(t.loaderDom.style.display="none"),t.statusDom&&(t.statusDom.style.backgroundColor=e?"#0cd362":"#31965d",t.statusDom.style.color="#FFF",t.statusDom.innerHTML=(this.id?"online : "+this.id:"online")+(e?" via local_connect":" via internet"))}showOffLine(){if(this.isNode)return;const e=this.getDebugDoms();e.loaderDom&&(e.loaderDom.style.display="block"),e.statusDom&&(e.statusDom.style.backgroundColor="#d9534f",e.statusDom.style.color="#FFF",e.statusDom.innerHTML=this.id?"offline : "+this.id:"offline")}}},function(e,t,i){const r=i(24);e.exports=class extends r{constructor(e,t){super(e,t)}wait(e){return e<0?e=0:e>6e4&&(e=6e4),this.send({system:{wait:e}}),new Promise(t=>setTimeout(t,e))}reset(){this.send({system:{reset:!0}}),this._resetComponents()}reboot(){this.send({system:{reboot:!0}})}selfCheck(){this.send({system:{self_check:!0}})}keepWorkingAtOffline(e){this.send({system:{keep_working_at_offline:e}})}resetOnDisconnect(e){this.send({ws:{reset_obniz_on_ws_disconnection:e}})}pingWait(e,t,i){e=e||(new Date).getTime();let r=Math.floor(e/Math.pow(2,32)),s=e-r*Math.pow(2,32);t=t||Math.floor(Math.random()*Math.pow(2,4));let n=[];n.push(r>>>24&255),n.push(r>>>16&255),n.push(r>>>8&255),n.push(r>>>0&255),n.push(s>>>24&255),n.push(s>>>16&255),n.push(s>>>8&255),n.push(s>>>0&255),n.push(t>>>24&255),n.push(t>>>16&255),n.push(t>>>8&255),n.push(t>>>0&255);let a={system:{ping:{key:n}}};return this.send(a,{local_connect:!i}),new Promise(e=>{let t=i=>{for(let e=0;e<n.length;e++)if(n[e]!==i.pong.key[e])return;this.removePongObserver(t);let r=(i.pong.key[0]<<24>>>0)+(i.pong.key[1]<<16>>>0)+(i.pong.key[2]<<8>>>0)+(i.pong.key[3]<<0>>>0),s=(i.pong.key[4]<<24>>>0)+(i.pong.key[5]<<16>>>0)+(i.pong.key[6]<<8>>>0)+(i.pong.key[7]<<0>>>0),a=r*Math.pow(2,32)+s,o=(new Date).getTime(),h=`ping ${o-a}ms (js --[${i.pong.pingServerTime-a}ms]--\x3e server --[${i.pong.obnizTime-i.pong.pingServerTime}ms]--\x3e obniz --[${i.pong.pongServerTime-i.pong.obnizTime}ms]--\x3e server --[${o-i.pong.pongServerTime}ms]--\x3e js)`;this.print_debug(h),e(h)};this.addPongObserver(t)})}}},function(e,t,i){const r=i(25),s=i(42),n=i(43),a=i(44),o=i(45),h=i(46),c=i(47),d=i(48),u=i(49),l=i(50),p=i(51),m=i(52),f=i(53),g=i(54),y=i(232);e.exports=class extends g{constructor(e,t){super(e,t),this.pongObservers=[],this._allComponentKeys=[]}close(){super.close(),this.options.reset_obniz_on_ws_disconnection&&this._resetComponents()}_callOnConnect(){this._prepareComponents(),super._callOnConnect()}_prepareComponents(){if(0!==this._allComponentKeys.length)return;const e=y.getDefinitionFor(this.hw);if(!e)throw new Error(`unkown hw ${this.hw}`);const t=e.peripherals,i=e.embeds,g=e.protocol,_={io:u,logicAnalyzer:a,measure:o},w={io:d,ad:h,uart:m,spi:p,i2c:c,pwm:l},v={display:s,switch:n,ble:r},b={tcp:f};for(const e in _){const t=_[e];this[e]=new t(this),this._allComponentKeys.push(e)}if(t)for(const e in w)if(t[e]){const i=t[e].units,r=w[e];for(let t in i)this[e+(t=parseInt(t))]=new r(this,t),this._allComponentKeys.push(e+t)}if(i)for(const e in v)if(i[e]){const t=v[e];this[e]=new t(this),this._allComponentKeys.push(e)}if(g)for(const e in b)if(g[e]){const t=g[e].units,i=b[e];for(let r in t)this[e+(r=parseInt(r))]=new i(this,r),this._allComponentKeys.push(e+r)}}_resetComponents(){this.print_debug("components state resets");for(const e of this._allComponentKeys)this[e]._reset()}notifyToModule(e){super.notifyToModule(e);for(const t of this._allComponentKeys)"logicAnalyzer"!==t?e.hasOwnProperty(t)&&this[t].notified(e[t]):e.hasOwnProperty("logic_analyzer")&&this.logicAnalyzer.notified(e.logic_analyzer)}handleSystemCommand(e){if(super.handleSystemCommand(e),e.pong)for(let t of this.pongObservers)t(e)}addPongObserver(e){e&&this.pongObservers.push(e)}removePongObserver(e){if(this.pongObservers.includes(e)){let t=this.pongObservers.indexOf(e);this.pongObservers.splice(t,1)}}isValidIO(e){return"number"==typeof e&&null!=this["io"+e]}setVccGnd(e,t,i){this.isValidIO(e)&&(i&&this.getIO(e).drive(i),this.getIO(e).output(!0)),this.isValidIO(t)&&(i&&this.getIO(t).drive(i),this.getIO(t).output(!1))}getIO(e){if(!this.isValidIO(e))throw new Error("io "+e+" is not valid io");return this["io"+e]}getAD(e){if(!this.isValidIO(e))throw new Error("ad "+e+" is not valid io");return this["ad"+e]}_getFreePeripheralUnit(e){for(const t of this._allComponentKeys)if(0===t.indexOf(e)){const e=this[t];if("object"==typeof e&&!e.isUsed())return e.used=!0,e}throw new Error(`No More ${e} Available.`)}getFreePwm(){return this._getFreePeripheralUnit("pwm")}getFreeI2C(){return this._getFreePeripheralUnit("i2c")}getI2CWithConfig(e){if("object"!=typeof e)throw new Error("getI2CWithConfig need config arg");if(e.i2c)return e.i2c;let t=this.getFreeI2C();return t.start(e),t}getFreeSpi(){return this._getFreePeripheralUnit("spi")}getSpiWithConfig(e){if("object"!=typeof e)throw new Error("getSpiWithConfig need config arg");if(e.spi)return e.spi;let t=this.getFreeSpi();return t.start(e),t}getFreeUart(){return this._getFreePeripheralUnit("uart")}getFreeTcp(){return this._getFreePeripheralUnit("tcp")}}},function(e,t,i){const r=i(26),s=i(13),n=i(14),a=i(15),o=i(33),h=i(37),c=i(39),d=i(40);e.exports=class{constructor(e){this.Obniz=e,this.remotePeripherals=[],this.service=s,this.characteristic=n,this.descriptor=a,this.peripheral=new r(e),this.scanTarget=null,this.advertisement=new h(e),this.scan=new c(e),this.security=new d(e),this._reset()}_reset(){}findPeripheral(e){for(let t in this.remotePeripherals)if(this.remotePeripherals[t].address===e)return this.remotePeripherals[t];return null}notified(e){if(e.scan_result){let t=this.findPeripheral(e.scan_result.address);t||(t=new o(this.Obniz,e.scan_result.address),this.remotePeripherals.push(t)),t.discoverdOnRemote=!0,t.setParams(e.scan_result),this.scan.notifyFromServer("onfind",t)}e.scan_result_finish&&this.scan.notifyFromServer("onfinish");let t=function(e,t,i){let r=null;if(void 0===e)return;let s=this.findPeripheral(e.address);s&&("peripheral"===i?r=s:"service"===i?r=s.findService(e):"characteristic"===i?r=s.findCharacteristic(e):"descriptor"===i&&(r=s.findDescriptor(e)),r&&t(e,r))}.bind(this);const i={status_update:{name:"statusupdate",obj:"peripheral"},get_service_result:{name:"discover",obj:"peripheral"},get_service_result_finish:{name:"discoverfinished",obj:"peripheral"},get_characteristic_result:{name:"discover",obj:"service"},get_characteristic_result_finish:{name:"discoverfinished",obj:"service"},write_characteristic_result:{name:"onwrite",obj:"characteristic"},read_characteristic_result:{name:"onread",obj:"characteristic"},register_notify_characteristic_result:{name:"onregisternotify",obj:"characteristic"},unregister_notify_characteristic_result:{name:"onunregisternotify",obj:"characteristic"},nofity_characteristic:{name:"onnotify",obj:"characteristic"},get_descriptor_result:{name:"discover",obj:"characteristic"},get_descriptor_result_finish:{name:"discoverfinished",obj:"characteristic"},write_descriptor_result:{name:"onwrite",obj:"descriptor"},read_descriptor_result:{name:"onread",obj:"descriptor"}};for(let r in i)t(e[r],function(e,t){t.notifyFromServer(i[r].name,e)}.bind(this),i[r].obj);let r=function(e,t,i){let r=null;void 0!==e&&("peripheral"===i?r=this.peripheral:"service"===i?r=this.peripheral.getService(e):"characteristic"===i?r=this.peripheral.findCharacteristic(e):"descriptor"===i&&(r=this.peripheral.findDescriptor(e)),r&&t(e,r))}.bind(this);if(e.peripheral){r(e.peripheral.connection_status,function(e){this.peripheral.onconnectionupdates(e)}.bind(this),"peripheral");const t={read_characteristic_result:{name:"onread",obj:"characteristic"},write_characteristic_result:{name:"onwrite",obj:"characteristic"},notify_read_characteristic:{name:"onreadfromremote",obj:"characteristic"},notify_write_characteristic:{name:"onwritefromremote",obj:"characteristic"},read_descriptor_result:{name:"onread",obj:"descriptor"},write_descriptor_result:{name:"onwrite",obj:"descriptor"},notify_read_descriptor:{name:"onreadfromremote",obj:"descriptor"},notify_write_descriptor:{name:"onwritefromremote",obj:"descriptor"}};for(let i in t)r(e.peripheral[i],function(e,r){r.notifyFromServer(t[i].name,e)}.bind(this),t[i].obj)}if(e.error){let t,i,r=e.error,s=!1;(t=r.address?this.findPeripheral(r.address):this.peripheral)&&(r.service_uuid&&r.characteristic_uuid&&r.descriptor_uuid?i=t.findDescriptor(r):r.service_uuid&&r.characteristic_uuid?i=t.findCharacteristic(r):r.service_uuid&&(i=t.findService(r)),i?(i.notifyFromServer("onerror",r),s=!0):(t.onerror(r),s=!0)),[35,36,37,38,39].includes(r.function_code)&&(this.security.onerror(r),s=!0),s||this.Obniz.error(`ble ${r.message} service=${r.service_uuid} characteristic_uuid=${r.characteristic_uuid} descriptor_uuid=${r.descriptor_uuid}`)}}static _dataArray2uuidHex(e,t){let i=[];for(let t=0;t<e.length;t++)i.push(("00"+e[t].toString(16).toLowerCase()).slice(-2));t&&(i=i.reverse());let r=i.join("");return i.length>=16&&(r=r.slice(0,8)+"-"+r.slice(8,12)+"-"+r.slice(12,16)+"-"+r.slice(16,20)+"-"+r.slice(20)),r}}},function(e,t,i){const r=i(13),s=i(2);e.exports=class{constructor(e){this.Obniz=e,this.services=[]}addService(e){e instanceof r||(e=new r(e)),this.services.push(e),e.peripheral=this,this.Obniz.send({ble:{peripheral:{services:[e]}}})}setJson(e){if(e.services)for(let t of e.services)this.addService(t)}getService(e){return e=s.uuidFilter(e),this.services.filter((function(t){return s.uuidFilter(t.uuid)===e})).shift()}removeService(e){this.services=this.services.filter((function(t){return s.uuidFilter(t.uuid)!==e}))}stopAllService(){this.Obniz.send({ble:{peripheral:null}}),this.services=[]}toJSON(){return{services:this.services}}findCharacteristic(e){let t=s.uuidFilter(e.service_uuid),i=s.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){let t=s.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}end(){this.Obniz.send({ble:{peripheral:null}})}onconnectionupdates(){}onerror(){}}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";t.byteLength=function(e){var t=c(e),i=t[0],r=t[1];return 3*(i+r)/4-r},t.toByteArray=function(e){var t,i,r=c(e),a=r[0],o=r[1],h=new n(function(e,t,i){return 3*(t+i)/4-i}(0,a,o)),d=0,u=o>0?a-4:a;for(i=0;i<u;i+=4)t=s[e.charCodeAt(i)]<<18|s[e.charCodeAt(i+1)]<<12|s[e.charCodeAt(i+2)]<<6|s[e.charCodeAt(i+3)],h[d++]=t>>16&255,h[d++]=t>>8&255,h[d++]=255&t;2===o&&(t=s[e.charCodeAt(i)]<<2|s[e.charCodeAt(i+1)]>>4,h[d++]=255&t);1===o&&(t=s[e.charCodeAt(i)]<<10|s[e.charCodeAt(i+1)]<<4|s[e.charCodeAt(i+2)]>>2,h[d++]=t>>8&255,h[d++]=255&t);return h},t.fromByteArray=function(e){for(var t,i=e.length,s=i%3,n=[],a=0,o=i-s;a<o;a+=16383)n.push(d(e,a,a+16383>o?o:a+16383));1===s?(t=e[i-1],n.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[i-2]<<8)+e[i-1],n.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return n.join("")};for(var r=[],s=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=a.length;o<h;++o)r[o]=a[o],s[a.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function d(e,t,i){for(var s,n,a=[],o=t;o<i;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(r[(n=s)>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return a.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,s){var n,a,o=8*s-r-1,h=(1<<o)-1,c=h>>1,d=-7,u=i?s-1:0,l=i?-1:1,p=e[t+u];for(u+=l,n=p&(1<<-d)-1,p>>=-d,d+=o;d>0;n=256*n+e[t+u],u+=l,d-=8);for(a=n&(1<<-d)-1,n>>=-d,d+=r;d>0;a=256*a+e[t+u],u+=l,d-=8);if(0===n)n=1-c;else{if(n===h)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),n-=c}return(p?-1:1)*a*Math.pow(2,n-r)},t.write=function(e,t,i,r,s,n){var a,o,h,c=8*n-s-1,d=(1<<c)-1,u=d>>1,l=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:n-1,m=r?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),(t+=a+u>=1?l/h:l*Math.pow(2,1-u))*h>=2&&(a++,h/=2),a+u>=d?(o=0,a=d):a+u>=1?(o=(t*h-1)*Math.pow(2,s),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,s),a=0));s>=8;e[i+p]=255&o,p+=m,o/=256,s-=8);for(a=a<<s|o,c+=s;c>0;e[i+p]=255&a,p+=m,a/=256,c-=8);e[i+p-m]|=128*f}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";var r=i(32).Buffer,s=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===s||!s(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=h,this.end=c,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=d,this.end=u,t=3;break;default:return this.write=l,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function o(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(i);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(i+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(i+2)}}(this,e,t);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function h(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function d(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function l(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=n,n.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},n.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},n.prototype.text=function(e,t){var i=function(e,t,i){var r=t.length-1;if(r<i)return 0;var s=a(t[r]);if(s>=0)return s>0&&(e.lastNeed=s-1),s;if(--r<i)return 0;if((s=a(t[r]))>=0)return s>0&&(e.lastNeed=s-2),s;if(--r<i)return 0;if((s=a(t[r]))>=0)return s>0&&(2===s?s=0:e.lastNeed=s-3),s;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var r=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},n.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,i){var r=i(1),s=r.Buffer;function n(e,t){for(var i in e)t[i]=e[i]}function a(e,t,i){return s(e,t,i)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=r:(n(r,t),t.Buffer=a),n(s,a),a.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,i)},a.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"==typeof i?r.fill(t,i):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,i){const r=i(34),s=i(5),n=i(2);e.exports=class{constructor(e,t){this.Obniz=e,this.address=t,this.connected=!1,this.device_type=null,this.address_type=null,this.ble_event_type=null,this.rssi=null,this.adv_data=null,this.scan_resp=null,this.keys=["device_type","address_type","ble_event_type","rssi","adv_data","scan_resp"],this.services=[],this.emitter=new s}toString(){return JSON.stringify({address:this.address,addressType:this.address_type,advertisement:this.adv_data,scanResponse:this.scan_resp,rssi:this.rssi})}setParams(e){this.advertise_data_rows=null;for(let t in e)e.hasOwnProperty(t)&&this.keys.includes(t)&&(this[t]=e[t]);this.analyseAdvertisement()}analyseAdvertisement(){if(!this.advertise_data_rows){if(this.advertise_data_rows=[],this.adv_data)for(let e=0;e<this.adv_data.length;e++){let t=this.adv_data[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.adv_data[e+r+1];this.advertise_data_rows.push(i),e+=t}if(this.scan_resp)for(let e=0;e<this.scan_resp.length;e++){let t=this.scan_resp[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.scan_resp[e+r+1];this.advertise_data_rows.push(i),e+=t}this.setLocalName(),this.setIBeacon()}}searchTypeVal(e){this.analyseAdvertisement();for(let t=0;t<this.advertise_data_rows.length;t++)if(this.advertise_data_rows[t][0]===e){let e=[].concat(this.advertise_data_rows[t]);return e.shift(),e}}setLocalName(){let e=this.searchTypeVal(9);e||(e=this.searchTypeVal(8)),this.localName=e?String.fromCharCode.apply(null,e):null}setIBeacon(){let e=this.searchTypeVal(255);if(!e||76!==e[0]||0!==e[1]||2!==e[2]||21!==e[3]||25!==e.length)return void(this.iBeacon=null);let t=e.slice(4,20),i="";for(let e=0;e<t.length;e++)i+=("00"+t[e].toString(16)).slice(-2),3!==e&&5!==e&&7!==e&&9!==e||(i+="-");let r=(e[20]<<8)+e[21],s=(e[22]<<8)+e[23],n=e[24];this.iBeacon={uuid:i,major:r,minor:s,power:n,rssi:this.rssi}}_addServiceUuids(e,t,i){if(!t)return;let r=i/4;for(let i=0;i<t.length;i+=r){let s=t.slice(i,i+r);e.push(this.Obniz.ble.constructor._dataArray2uuidHex(s,!0))}}advertisementServiceUuids(){let e=[];return this._addServiceUuids(e,this.searchTypeVal(2),16),this._addServiceUuids(e,this.searchTypeVal(3),16),this._addServiceUuids(e,this.searchTypeVal(4),32),this._addServiceUuids(e,this.searchTypeVal(5),32),this._addServiceUuids(e,this.searchTypeVal(6),64),this._addServiceUuids(e,this.searchTypeVal(7),64),e}connect(){let e={ble:{connect:{address:this.address}}};this.Obniz.send(e)}connectWait(){return new Promise(e=>{this.emitter.once("statusupdate",t=>{e("connected"===t.status)}),this.connect()})}disconnect(){let e={ble:{disconnect:{address:this.address}}};this.Obniz.send(e)}disconnectWait(){return new Promise(e=>{this.emitter.once("statusupdate",t=>{e("disconnected"===t.status)}),this.disconnect()})}getService(e){e=n.uuidFilter(e);for(let t in this.services)if(this.services[t].uuid===e)return this.services[t];let t=new r({uuid:e});return t.parent=this,this.services.push(t),t}findService(e){let t=n.uuidFilter(e.service_uuid);return this.getService(t)}findCharacteristic(e){let t=n.uuidFilter(e.service_uuid),i=n.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){let t=n.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}discoverAllServices(){let e={ble:{get_services:{address:this.address}}};this.Obniz.send(e)}discoverAllServicesWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{let t=this.services.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverAllServices()})}onconnect(){}ondisconnect(){}ondiscoverservice(){}ondiscoverservicefinished(){}ondiscover(){}ondiscoverfinished(){}notifyFromServer(e,t){switch(this.emitter.emit(e,t),e){case"statusupdate":"connected"===t.status&&(this.connected=!0,this.onconnect()),"disconnected"===t.status&&(this.connected=!1,this.ondisconnect());break;case"discover":{let e=this.getService(t.service_uuid);e.discoverdOnRemote=!0,this.ondiscoverservice(e);break}case"discoverfinished":{let e=this.services.filter(e=>e.discoverdOnRemote);this.ondiscoverservicefinished(e);break}}}onerror(){}}},function(e,t,i){const r=i(35),s=i(12),n=i(2);e.exports=class extends s{constructor(e){super(e)}get parentName(){return"peripheral"}get childrenClass(){return r}get childrenName(){return"characteristics"}addCharacteristic(e){return this.addChild(e)}getCharacteristic(e){return this.getChild(e)}discoverAllCharacteristics(){return this.discoverChildren()}discoverAllCharacteristicsWait(){return this.discoverChildrenWait()}discoverChildren(){const e={ble:{get_characteristics:{address:this.peripheral.address,service_uuid:n.uuidFilter(this.uuid)}}};this.parent.Obniz.send(e)}ondiscover(e){this.ondiscovercharacteristic(e)}ondiscoverfinished(e){this.ondiscovercharacteristicfinished(e)}ondiscovercharacteristic(){}ondiscovercharacteristicfinished(){}}},function(e,t,i){const r=i(36),s=i(12),n=i(2);e.exports=class extends s{constructor(e){super(e),this.properties=e.properties||[],Array.isArray(this.properties)||(this.properties=[this.properties])}get parentName(){return"service"}get childrenClass(){return r}get childrenName(){return"descriptors"}addDescriptor(e){return this.addChild(e)}getDescriptor(e){let t=this.getChild(e);if(t)return t;let i=new r(this.Obniz,this,e);return this.addChild(i),i}registerNotify(e){this.onnotify=e;const t={ble:{register_notify_characteristic:{address:this.service.peripheral.address,service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(t)}unregisterNotify(){this.onnotify=function(){};const e={ble:{unregister_notify_characteristic:{address:this.service.peripheral.address,service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}read(){const e={ble:{read_characteristic:{address:this.service.peripheral.address,service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}write(e,t){void 0===t&&(t=!0);const i={ble:{write_characteristic:{address:this.service.peripheral.address,service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid),data:e,needResponse:t}}};this.service.peripheral.Obniz.send(i)}discoverChildren(){const e={ble:{get_descriptors:{address:this.service.peripheral.address,service_uuid:n.uuidFilter(this.service.uuid),characteristic_uuid:n.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}discoverAllDescriptors(){return this.discoverChildren()}discoverAllDescriptorsWait(){return this.discoverChildrenWait()}toJSON(){let e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),e}canBroadcast(){return this.properties.includes("broadcast")}canNotify(){return this.properties.includes("notify")}canRead(){return this.properties.includes("read")}canWrite(){return this.properties.includes("write")}canWriteWithoutResponse(){return this.properties.includes("write_without_response")}canIndicate(){return this.properties.includes("indicate")}ondiscover(e){this.ondiscoverdescriptor(e)}ondiscoverfinished(e){this.ondiscoverdescriptorfinished(e)}ondiscoverdescriptor(){}ondiscoverdescriptorfinished(){}onregisternofity(){}onunregisternofity(){}onnotify(){}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"onregisternofity":this.onregisternofity();break;case"onunregisternofity":this.onunregisternofity();break;case"onnotify":this.onnotify(t.data||void 0)}}}},function(e,t,i){const r=i(12),s=i(2);e.exports=class extends r{constructor(e){super(e)}get parentName(){return"characteristic"}read(){const e={ble:{read_descriptor:{address:this.characteristic.service.peripheral.address,service_uuid:s.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.uuidFilter(this.characteristic.uuid),descriptor_uuid:s.uuidFilter(this.uuid)}}};this.characteristic.service.peripheral.Obniz.send(e)}write(e,t){void 0===t&&(t=!0);const i={ble:{write_descriptor:{address:this.characteristic.service.peripheral.address,service_uuid:s.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.uuidFilter(this.characteristic.uuid),descriptor_uuid:s.uuidFilter(this.uuid),data:e,needResponse:t}}};this.characteristic.service.peripheral.Obniz.send(i)}}},function(e,t,i){const r=i(38);e.exports=class{constructor(e){this.Obniz=e,this.adv_data=[],this.scan_resp=[]}start(){let e={ble:{}};e.ble.advertisement={adv_data:this.adv_data},this.scan_resp.length>0&&(e.ble.advertisement.scan_resp=this.scan_resp),this.Obniz.send(e)}end(){let e={ble:{}};e.ble.advertisement=null,this.Obniz.send(e)}setAdvDataRaw(e){this.adv_data=e}setAdvData(e){let t=this.advDataBulider(e);this.setAdvDataRaw(t.build())}advDataBulider(e){return new r(this.Obniz,e)}scanRespDataBuilder(e){return new r(this.Obniz,e)}setScanRespDataRaw(e){this.scan_resp=e}setScanRespData(e){this.setScanRespDataRaw(this.scanRespDataBuilder(e).build())}}},function(e,t,i){const r=i(2);e.exports=class{constructor(e,t){if(this.Obniz=e,this.rows={},t&&(t.localName&&this.setCompleteLocalName(t.localName),t.manufacturerData&&t.manufacturerData.companyCode&&t.manufacturerData.data&&this.setManufacturerSpecificData(t.manufacturerData.companyCode,t.manufacturerData.data),t.serviceUuids))for(let e of t.serviceUuids)this.setUuid(e);"function"==typeof this.extendEvalJson&&this.extendEvalJson(t)}setRow(e,t){this.rows[e]=t}getRow(e){return this.rows[e]||[]}build(){let e=[];for(let t in this.rows)0!==this.rows[t].length&&(e.push(this.rows[t].length+1),e.push(parseInt(t)),Array.prototype.push.apply(e,this.rows[t]));return e.length>31&&this.Obniz.error("Too large data. Advertise/ScanResponse data are must be less than 32 byte."),e}setStringData(e,t){let i=[];for(let e=0;e<t.length;e++)i.push(t.charCodeAt(e));this.setRow(e,i)}setShortenedLocalName(e){this.setStringData(8,e)}setCompleteLocalName(e){this.setStringData(9,e)}setManufacturerSpecificData(e,t){let i=[];i.push(255&e),i.push(e>>8&255),Array.prototype.push.apply(i,t),this.setRow(255,i)}setUuid(e){let t=this.convertUuid(e),i={16:6,4:4,2:2}[t.length];this.setRow(i,t)}convertUuid(e){let t=r.uuidFilter(e);32!==t.length&&8!==t.length&&4!==t.length&&this.Obniz.error("BLE uuid must be 16/32/128 bit . (example: c28f0ad5-a7fd-48be-9fd0-eae9ffd3a8bb for 128bit)");let i=[];for(let e=t.length;e>1;e-=2)i.push(parseInt(t[e-2]+t[e-1],16));return i}setIbeaconData(e,t,i,r){let s=[];s.push(2,21);let n=this.convertUuid(e);Array.prototype.push.apply(s,n),s.push(t>>8&255),s.push(t>>0&255),s.push(i>>8&255),s.push(i>>0&255),s.push(r>>0&255),this.setManufacturerSpecificData(76,s)}extendEvalJson(e){e&&e.flags&&(e.flags.includes("limited_discoverable_mode")&&this.setLeLimitedDiscoverableModeFlag(),e.flags.includes("general_discoverable_mode")&&this.setLeGeneralDiscoverableModeFlag(),e.flags.includes("br_edr_not_supported")&&this.setBrEdrNotSupportedFlag(),e.flags.includes("le_br_edr_controller")&&this.setLeBrEdrControllerFlag(),e.flags.includes("le_br_edr_host")&&this.setLeBrEdrHostFlag())}setFlags(e){let t=this.getRow(1);t[0]=(t[0]||0)|e,this.setRow(1,t)}setLeLimitedDiscoverableModeFlag(){this.setFlags(1)}setLeGeneralDiscoverableModeFlag(){this.setFlags(2)}setBrEdrNotSupportedFlag(){this.setFlags(4)}setLeBrEdrControllerFlag(){this.setFlags(8)}setLeBrEdrHostFlag(){this.setFlags(16)}}},function(e,t,i){const r=i(5),s=i(2);e.exports=class{constructor(e){this.scanTarget=null,this.Obniz=e,this.emitter=new r,this.scanedPeripherals=[]}start(e,t){let i={ble:{}};i.ble.scan={duration:t&&t.duration?t.duration:30},this.scanTarget=e,this.scanTarget&&this.scanTarget.uuids&&Array.isArray(this.scanTarget.uuids)&&(this.scanTarget.uuids=this.scanTarget.uuids.map(e=>s.uuidFilter(e))),this.scanedPeripherals=[],this.Obniz.send(i)}startOneWait(e,t){let i=0;return new Promise(r=>{this.emitter.once("onfind",e=>{0===i&&(i=1,this.end(),r(e))}),this.emitter.once("onfinish",()=>{0===i&&(i=1,r(null))}),this.start(e,t)})}startAllWait(e,t){return new Promise(i=>{this.emitter.once("onfinish",()=>{i(this.scanedPeripherals)}),this.start(e,t)})}end(){let e={ble:{}};e.ble.scan=null,this.Obniz.send(e)}isTarget(e){if(this.scanTarget&&this.scanTarget.localName&&e.localName!==this.scanTarget.localName)return!1;if(this.scanTarget&&this.scanTarget.uuids){let t=e.advertisementServiceUuids().map(e=>s.uuidFilter(e));for(let e of this.scanTarget.uuids)if(!t.includes(e))return!1}return!0}onfinish(){}onfind(){}notifyFromServer(e,t){switch(e){case"onfind":this.isTarget(t)&&(this.scanedPeripherals.push(t),this.emitter.emit(e,t),this.onfind(t));break;case"onfinish":this.emitter.emit(e,this.scanedPeripherals),this.onfinish(this.scanedPeripherals)}}}},function(e,t,i){const r=i(5),s=i(6);e.exports=class{constructor(e){this.Obniz=e,this.emitter=new r}setModeLevel(e,t){let i=void 0,r=void 0,s=void 0;if(1==e&&(1==t?(i=[],s=0,r=["LTK","IRK"]):2==t&&(i=["bonding"],s=2,r=["LTK","IRK"])),void 0===i||void 0===s||void 0===r){let i=`BLE security mode${e}, level${t} is not available.`;throw this.Obniz.error(i),new Error(i)}this.setAuth(i),this.setIndicateSecurityLevel(s),this.setEnableKeyTypes(r)}checkIntroducedFirmware(e,t){if(s.lt(this.Obniz.firmware_ver,e)){let i=`${t} is available obniz firmware ${e}.( your obniz version is ${this.Obniz.firmware_ver})`;throw this.Obniz.error(i),new Error(i)}}setAuth(e){if(this.checkIntroducedFirmware("1.1.0","setAuth"),Array.isArray(e)||(e=[e]),e.map(e=>e.toLowerCase()).filter(e=>["mitm","secure_connection","bonding"].includes(e)).length!==e.length)throw new Error("unknown auth type");this.Obniz.send({ble:{security:{auth:e}}})}setIndicateSecurityLevel(e){if(this.checkIntroducedFirmware("1.1.0","setIndicateSecurityLevel"),"number"!=typeof e)throw new Error("unknown secrity level : "+e);this.Obniz.send({ble:{security:{indicate_security_level:e}}})}setEnableKeyTypes(e){this.checkIntroducedFirmware("1.1.0","setEnableKeyTypes"),Array.isArray(e)||(e=[e]);let t=e.map(e=>e.toLowerCase()).filter(e=>["ltk","csrk","irk"].includes(e));if(t.length!==e.length)throw new Error("unknown key type");this.Obniz.send({ble:{security:{key:{type:t}}}})}setKeyMaxSize(e){if(this.checkIntroducedFirmware("1.1.0","setKeyMaxSize"),"number"!=typeof e)throw new Error("please provide key size in number");this.Obniz.send({ble:{security:{key:{max_size:e}}}})}clearBondingDevicesList(){this.Obniz.send({ble:{security:{devices:{clear:!0}}}})}onerror(){}notifyFromServer(e,t){switch(e){case"onerror":this.onerror(t)}}}},function(e,t){var i,r,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var h,c=[],d=!1,u=-1;function l(){d&&h&&(d=!1,h.length?c=h.concat(c):u=-1,c.length&&p())}function p(){if(!d){var e=o(l);d=!0;for(var t=c.length;t;){for(h=c,c=[];++u<t;)h&&h[u].run();u=-1,t=c.length}h=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||d||o(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,i){e.exports=class{constructor(e){this.Obniz=e,this.width=128,this.height=64,this._canvas=null,this._reset()}_reset(){this._pos={x:0,y:0},this.autoFlush=!0}warnCanvasAvailability(){throw this.Obniz.isNode?new Error("obniz.js require node-canvas to draw rich contents. see more detail on docs"):new Error("obniz.js cant create canvas element to body")}_preparedCanvas(){if(this._canvas)return this._canvas;if(this.Obniz.isNode)try{const{createCanvas:e}=i(11);this._canvas=e(this.width,this.height)}catch(e){return null}else{const e="obnizcanvas-"+this.Obniz.id;let t=document.getElementById(e);if(!t){(t=document.createElement("canvas")).setAttribute("id",e),t.style.visibility="hidden",t.width=this.width,t.height=this.height,t.style["-webkit-font-smoothing"]="none",document.getElementsByTagName("body")[0].appendChild(t)}this._canvas=t}const e=this._canvas.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,this.width,this.height),e.fillStyle="#FFF",e.strokeStyle="#FFF",this._pos.x=0,this._pos.y=0,this.fontSize=16,e.font=`${this.fontSize}px Arial`,this._canvas}_ctx(){const e=this._preparedCanvas();if(e)return e.getContext("2d")}font(e,t){const i=this._ctx();"number"!=typeof t&&(t=16),"string"!=typeof e&&(e="Arial"),this.fontSize=t,i.font="0"+t+"px "+e}clear(){const e=this._ctx();if(this._pos.x=0,this._pos.y=0,e)e.fillStyle="#000",e.fillRect(0,0,this.width,this.height),e.fillStyle="#FFF",e.strokeStyle="#FFF",this.draw(e);else{let e={display:{clear:!0}};this.Obniz.send(e)}}pos(e,t){return this._ctx(),"number"==typeof e&&(this._pos.x=e),"number"==typeof t&&(this._pos.y=t),this._pos}print(e){const t=this._ctx();if(t)t.fillText(e,this._pos.x,this._pos.y+this.fontSize),this.draw(t),this._pos.y+=this.fontSize;else{let t={};t.display={text:""+e},this.Obniz.send(t)}}line(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.moveTo(e,t),s.lineTo(i,r),s.stroke(),this.draw(s)):this.warnCanvasAvailability()}rect(e,t,i,r,s){const n=this._ctx();n?(s?n.fillRect(e,t,i,r):n.strokeRect(e,t,i,r),this.draw(n)):this.warnCanvasAvailability()}circle(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.arc(e,t,i,0,2*Math.PI),r?s.fill():s.stroke(),this.draw(s)):this.warnCanvasAvailability()}qr(e,t){let i={};i.display={qr:{text:e}},t&&(i.display.qr.correction=t),this.Obniz.send(i)}raw(e){let t={};t.display={raw:e},this.Obniz.send(t)}setPinName(e,t,i){let r={display:{}};r.display.pin_assign={},r.display.pin_assign[e]={module_name:t,pin_name:i},this.Obniz.send(r)}setPinNames(e,t){let i={display:{}};i.display.pin_assign={};let r=!0;for(let s in t)r=!1,i.display.pin_assign[s]={module_name:e,pin_name:t[s]};r||this.Obniz.send(i)}_draw(e){const t=this.width/8;let i=new Array(64*t);const r=e.getImageData(0,0,this.width,this.height).data;for(let e=0;e<r.length;e+=4){let s=.34*r[e]+.5*r[e+1]+.16*r[e+2],n=parseInt(e/4),a=parseInt(n/this.width),o=parseInt((n-a*this.width)/8),h=parseInt(n-a*this.width)%8;0==h&&(i[a*t+o]=0),s>127&&(i[a*t+o]|=128>>h)}this.raw(i)}draw(e){this.autoFlush&&this._draw(e)}drawing(e){this.autoFlush=1==e;const t=this._ctx();t&&this.draw(t)}}},function(e,t){e.exports=class{constructor(e){this.Obniz=e,this._reset()}_reset(){this.observers=[],this.onChangeForStateWait=function(){}}addObserver(e){e&&this.observers.push(e)}getWait(){let e=this;return new Promise((function(t,i){let r={switch:"get"};e.Obniz.send(r),e.addObserver(t)}))}stateWait(e){let t=this;return new Promise((function(i,r){t.onChangeForStateWait=function(r){e==r&&(t.onChangeForStateWait=function(){},i())}}))}notified(e){this.state=e.state,this.onchange&&this.onchange(this.state),this.onChangeForStateWait(this.state);const t=this.observers.shift();t&&t(this.state)}}},function(e,t,i){const r=i(3);e.exports=class{constructor(e){this.obniz=e,this._reset()}_reset(){this.onmeasured=void 0}start(e){let t=r._requiredKeys(e,["io","interval","duration"]);if(t)throw new Error("LogicAnalyzer start param '"+t+"' required, but not found ");this.params=r._keyFilter(e,["io","interval","duration","triggerValue","triggerValueSamples"]);let i={};i.logic_analyzer={io:[this.params.io],interval:this.params.interval,duration:this.params.duration},this.params.triggerValueSamples>0&&(i.logic_analyzer.trigger={value:!!this.params.triggerValue,samples:this.params.triggerValueSamples}),this.obniz.send(i)}end(){let e={logic_analyzer:null};this.obniz.send(e)}notified(e){this.onmeasured?this.onmeasured(e.data):(this.measured||(this.measured=[]),this.measured.push(e.data))}}},function(e,t,i){const r=i(3);e.exports=class{constructor(e){this.obniz=e,this._reset()}_reset(){this.observers=[]}echo(e){let t=r._requiredKeys(e,["io_pulse","pulse","pulse_width","io_echo","measure_edges"]);if(t)throw new Error("Measure start param '"+t+"' required, but not found ");this.params=r._keyFilter(e,["io_pulse","pulse","pulse_width","io_echo","measure_edges","timeout","callback"]);let i={};i.io_pulse=this.params.io_pulse,i.pulse=this.params.pulse,i.pulse_width=this.params.pulse_width,i.io_echo=this.params.io_echo,i.measure_edges=this.params.measure_edges,"number"==typeof this.params.timeout&&(i.timeout=this.params.timeout),this.obniz.send({measure:{echo:i}}),this.params.callback&&this.observers.push(this.params.callback)}notified(e){let t=this.observers.shift();t&&t(e.echo)}}},function(e,t){e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.value=0,this.observers=[]}addObserver(e){e&&this.observers.push(e)}start(e){this.onchange=e;let t={};return t["ad"+this.id]={stream:!0},this.Obniz.send(t),this.value}getWait(){let e=this;return new Promise((function(t,i){e.addObserver(t);let r={};r["ad"+e.id]={stream:!1},e.Obniz.send(r)}))}end(){this.onchange=null;let e={};e["ad"+this.id]=null,this.Obniz.send(e)}notified(e){this.value=e,this.onchange&&this.onchange(e);let t=this.observers.shift();t&&t(e)}}},function(e,t,i){const r=i(3);e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset(),this.onerror=void 0}_reset(){this.observers=[],this.state={},this.used=!1,this.onwritten=void 0}addObserver(e){e&&this.observers.push(e)}start(e){let t=r._requiredKeys(e,["mode","sda","scl"]);if(t)throw new Error("I2C start param '"+t+"' required, but not found ");this.state=r._keyFilter(e,["mode","sda","scl","pull","gnd"]);let i=["sda","scl","gnd"];for(let e of i)if(this.state[e]&&!this.Obniz.isValidIO(this.state[e]))throw new Error("i2c start param '"+e+"' are to be valid io no");let s=this.state.mode,n="number"==typeof e.clock?parseInt(e.clock):null,a="number"==typeof e.slave_address?parseInt(e.slave_address):null,o="number"==typeof e.slave_address_length?parseInt(e.slave_address_length):null;if("master"!==s&&"slave"!==s)throw new Error("i2c: invalid mode "+s);if("master"===s){if(null===n)throw new Error("i2c: please specify clock when master mode");if(n<=0||n>1e6)throw new Error("i2c: invalid clock "+n);if("5v"===e.pull&&n>4e5)throw new Error("i2c: please use under 400khz when internal 5v internal pull-up");if("3v"===e.pull&&n>1e5)throw new Error("i2c: please use under 100khz when internal 3v internal pull-up")}else{if(null===a)throw new Error("i2c: please specify slave_address");if(a<0||a>127)throw new Error("i2c: invalid slave_address");if(a<0||a>127)throw new Error("i2c: invalid slave_address");if(null!==o&&7!==o)throw new Error("i2c: invalid slave_address_length. please specify 7")}if(this.Obniz.getIO(this.state.sda).drive("open-drain"),this.Obniz.getIO(this.state.scl).drive("open-drain"),this.state.pull?(this.Obniz.getIO(this.state.sda).pull(this.state.pull),this.Obniz.getIO(this.state.scl).pull(this.state.pull)):(this.Obniz.getIO(this.state.sda).pull(null),this.Obniz.getIO(this.state.scl).pull(null)),void 0!==this.state.gnd){this.Obniz.getIO(this.state.gnd).output(!1);let e={};e[this.state.gnd]="gnd",this.Obniz.display.setPinNames("i2c"+this.id,e)}let h=r._keyFilter(this.state,["mode","sda","scl"]);"master"===s?h.clock=n:(h.slave_address=a,o&&(h.slave_address_length=o));let c={};c["i2c"+this.id]=h,this.used=!0,this.Obniz.send(c)}write(e,t){if(!this.used)throw new Error(`i2c${this.id} is not started`);if(e=parseInt(e),isNaN(e))throw new Error("i2c: please specify address");if(e<0||e>127)throw new Error("i2c: invalid address");if(!t)throw new Error("i2c: please provide data");if(t.length>1024)throw new Error("i2c: data should be under 1024 bytes");let i={};i["i2c"+this.id]={address:e,data:t},this.Obniz.send(i)}readWait(e,t){if(!this.used)throw new Error(`i2c${this.id} is not started`);if(e=parseInt(e),isNaN(e))throw new Error("i2c: please specify address");if(e<0||e>127)throw new Error("i2c: invalid address");if(t=parseInt(t),isNaN(t)||t<0)throw new Error("i2c: invalid length to read");if(t>1024)throw new Error("i2c: data length should be under 1024 bytes");let i=this;return new Promise((function(r,s){i.addObserver(r);let n={};n["i2c"+i.id]={address:e,read:t},i.Obniz.send(n)}))}notified(e){if(e&&"object"==typeof e){if(e.data)if("slave"===e.mode&&"function"==typeof this.onwritten)this.onwritten(e.data,e.address);else{let t=this.observers.shift();t&&t(e.data)}if(e.warning&&this.Obniz.warning({alert:"warning",message:`i2c${this.id}: ${e.warning.message}`}),e.error){const t=`i2c${this.id}: ${e.error.message}`;"function"==typeof this.onerror?this.onerror(new Error(t)):this.Obniz.error({alert:"error",message:t})}}}isUsed(){return this.used}end(){this.state={};let e={};e["i2c"+this.id]=null,this.Obniz.send(e),this.used=!1}}},function(e,t){e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.value=0,this.observers=[]}addObserver(e){e&&this.observers.push(e)}output(e){e=1==e;let t={};t["io"+this.id]=e,this.value=e,this.Obniz.send(t)}drive(e){if("string"!=typeof e)throw new Error("please specify drive methods in string");let t="";switch(e){case"5v":t="push-pull5v";break;case"3v":t="push-pull3v";break;case"open-drain":t="open-drain";break;default:throw new Error("unknown drive method")}let i={};i["io"+this.id]={output_type:t},this.Obniz.send(i)}pull(e){if("string"!=typeof e&&null!==e)throw new Error("please specify pull methods in string");let t="";switch(e){case"5v":case"pull-up5v":t="pull-up5v";break;case"3v":case"pull-up3v":t="pull-up3v";break;case"0v":case"pull-down":t="pull-down";break;case null:case"float":t="float";break;default:throw new Error("unknown pull_type method")}let i={};i["io"+this.id]={pull_type:t},this.Obniz.send(i)}input(e){this.onchange=e;let t={};return t["io"+this.id]={direction:"input",stream:!0},this.Obniz.send(t),this.value}inputWait(){let e=this;return new Promise((function(t,i){e.addObserver(t);let r={};r["io"+e.id]={direction:"input",stream:!1},e.Obniz.send(r)}))}end(){let e={};e["io"+this.id]=null,this.Obniz.send(e)}notified(e){if("boolean"==typeof e){this.value=e;let t=this.observers.shift();t&&t(e),"function"==typeof this.onchange&&this.onchange(e)}else e&&"object"==typeof e&&(e.warning&&this.Obniz.warning({alert:"warning",message:`io${this.id}: ${e.warning.message}`}),e.error&&this.Obniz.error({alert:"error",message:`io${this.id}: ${e.error.message}`}))}}},function(e,t,i){const r=i(6);e.exports=class{constructor(e,t){this.Obniz=e,this.observers=[],this._reset()}_reset(){for(let e=0;e<this.observers.length;e++)this.observers[e].reject();this.observers=[],this._animationIdentifier=0}addObserver(e,t,i){e&&t&&i&&this.observers.push({name:e,resolve:t,reject:i})}animation(e,t,i,s){if(("number"==typeof s||"registrate"==t)&&r.lt(this.Obniz.firmware_ver,"2.0.0"))throw new Error("Please update obniz firmware >= 2.0.0");let n={};n.io={animation:{name:e,status:t}},"number"==typeof s&&(n.io.animation.repeat=s),i||(i=[]);let a=[];for(let e=0;e<i.length;e++){let t=i[e],r=t.duration,s=t.state;this.Obniz.sendPool=[],s(e);let n=this.Obniz.sendPool;this.Obniz.sendPool=null,a.push({duration:r,state:n})}"loop"!==t&&"registrate"!==t||(n.io.animation.states=a),this.Obniz.send(n)}repeatWait(e,t){if(r.lt(this.Obniz.firmware_ver,"2.0.0"))throw new Error("Please update obniz firmware >= 2.0.0");if("number"!=typeof t||t<1)throw new Error("please specify repeat count > 0");if(parseInt(t)!==t)throw new Error("please provide integer number like 1, 2, 3,,,");return new Promise((i,r)=>{const s="_repeatwait"+Date.now()+this._animationIdentifier;++this._animationIdentifier>1e3&&(this._animationIdentifier=0),this.animation(s,"loop",e,t),this.addObserver(s,i,r)})}notified(e){if("finish"==e.animation.status)for(let t=this.observers.length-1;t>=0;t--)e.animation.name===this.observers[t].name&&(this.observers[t].resolve(),this.observers.splice(t,1))}}},function(e,t,i){const r=i(3);e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.state={},this.used=!1}sendWS(e){let t={};t["pwm"+this.id]=e,this.Obniz.send(t)}start(e){const t=r._requiredKeys(e,["io"]);if(t)throw new Error("pwm start param '"+t+"' required, but not found ");this.params=r._keyFilter(e,["io","drive","pull"]);const i=this.params.io,s=this.Obniz.getIO(i);s.drive(this.params.drive||"5v"),s.pull(this.params.pull||null),this.state={io:i,freq:1e3},this.sendWS({io:i}),this.used=!0}freq(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);if("number"!=typeof(e*=1))throw new Error("please provide freq in number");this.state.freq=e,this.sendWS({freq:e}),"number"==typeof this.state.duty&&this.duty(this.state.duty)}pulse(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);this.state.pulse=e,delete this.state.duty,this.sendWS({pulse:e})}duty(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);if(e*=1,"number"!=typeof this.state.freq||this.state.freq<=0)throw new Error("please provide freq first.");if("number"!=typeof e)throw new Error("please provide duty in number");e<0&&(e=0),e>100&&(e=100);const t=1/this.state.freq*1e3*e*.01;this.state.duty=e,this.sendWS({pulse:t})}isUsed(){return this.used}end(){this.state={},this.sendWS(null),this.used=!1}modulate(e,t,i){if(!this.used)throw new Error(`pwm${this.id} is not started`);this.sendWS({modulate:{type:e,symbol_length:t,data:i}})}}},function(e,t,i){const r=i(3),s=i(6);e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.observers=[],this.used=!1}addObserver(e){e&&this.observers.push(e)}start(e){let t=r._requiredKeys(e,["mode","frequency"]);if(t)throw new Error("spi start param '"+t+"' required, but not found ");this.params=r._keyFilter(e,["mode","clk","mosi","miso","frequency","drive","pull","gnd"]);let i={},s=["clk","mosi","miso","gnd"];for(let e of s)if(this.params[e]&&!this.Obniz.isValidIO(this.params[e]))throw new Error("spi start param '"+e+"' are to be valid io no");if(i["spi"+this.id]={mode:this.params.mode,clock:this.params.frequency},void 0!==this.params.clk&&(i["spi"+this.id].clk=this.params.clk),void 0!==this.params.mosi&&(i["spi"+this.id].mosi=this.params.mosi),void 0!==this.params.miso&&(i["spi"+this.id].miso=this.params.miso),this.params.drive?(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).drive(this.params.drive),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).drive(this.params.drive),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).drive(this.params.drive)):(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).drive("5v"),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).drive("5v"),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).drive("5v")),this.params.pull?(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).pull(this.params.pull),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).pull(this.params.pull),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).pull(this.params.pull)):(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).pull(null),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).pull(null),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).pull(null)),void 0!==this.params.gnd){this.Obniz.getIO(this.params.gnd).output(!1);let e={};e[this.params.gnd]="gnd",this.Obniz.display.setPinNames("spi"+this.id,e)}this.used=!0,this.Obniz.send(i)}writeWait(e){if(!this.used)throw new Error(`spi${this.id} is not started`);if(s.lte(this.Obniz.firmware_ver,"1.0.2")&&e.length>32)throw new Error(`with your obniz ${this.Obniz.firmware_ver}. spi max length=32byte but yours ${e.length}. Please update obniz firmware`);let t=this;return new Promise((function(i,r){t.addObserver(i);let s={};s["spi"+t.id]={data:e,read:!0},t.Obniz.send(s)}))}write(e){if(!this.used)throw new Error(`spi${this.id} is not started`);if(s.lte(this.Obniz.firmware_ver,"1.0.2")&&e.length>32)throw new Error(`with your obniz ${this.Obniz.firmware_ver}. spi max length=32byte but yours ${e.length}. Please update obniz firmware`);let t={};t["spi"+this.id]={data:e,read:!1},this.Obniz.send(t)}notified(e){let t=this.observers.shift();t&&t(e.data)}isUsed(){return this.used}end(e){let t={};t["spi"+this.id]=null,this.params=null,this.Obniz.send(t),e||(this.used=!1)}}},function(e,t,i){(function(t){const r=i(3),s="undefined"==typeof window;e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.received=new Uint8Array([]),this.used=!1}start(e){let t=r._requiredKeys(e,["tx","rx"]);if(t)throw new Error("uart start param '"+t+"' required, but not found ");this.params=r._keyFilter(e,["tx","rx","baud","stop","bits","parity","flowcontrol","rts","cts","drive","pull","gnd"]);let i=["rx","tx","rts","cts","gnd"];for(let e of i)if(this.params[e]&&!this.Obniz.isValidIO(this.params[e]))throw new Error("uart start param '"+e+"' are to be valid io no");if(this.params.hasOwnProperty("drive")?(this.Obniz.getIO(this.params.rx).drive(this.params.drive),this.Obniz.getIO(this.params.tx).drive(this.params.drive)):(this.Obniz.getIO(this.params.rx).drive("5v"),this.Obniz.getIO(this.params.tx).drive("5v")),this.params.hasOwnProperty("pull")?(this.Obniz.getIO(this.params.rx).pull(this.params.pull),this.Obniz.getIO(this.params.tx).pull(this.params.pull)):(this.Obniz.getIO(this.params.rx).pull(null),this.Obniz.getIO(this.params.tx).pull(null)),this.params.hasOwnProperty("gnd")){this.Obniz.getIO(this.params.gnd).output(!1);let e={};e[this.params.gnd]="gnd",this.Obniz.display.setPinNames("uart"+this.id,e)}let s={},n=r._keyFilter(this.params,["tx","rx","baud","stop","bits","parity","flowcontrol","rts","cts"]);s["uart"+this.id]=n,this.Obniz.send(s),this.received=[],this.used=!0}send(e){if(!this.used)throw new Error(`uart${this.id} is not started`);let i=null;if(void 0===e)return;if("number"==typeof e&&(e=[e]),s&&e instanceof t)i=[...e];else if(e.constructor===Array)i=e;else if("string"==typeof e){i=[...t.from(e)]}let r={};r["uart"+this.id]={},r["uart"+this.id].data=i,this.Obniz.send(r)}isDataExists(){return this.received&&this.received.length>0}readBytes(){let e=[];if(this.isDataExists())for(let t=0;t<this.received.length;t++)e.push(this.received[t]);return this.received=[],e}readByte(){let e=[];return this.isDataExists()?e.unshift():null}readText(){let e=null;if(this.isDataExists()){let t=this.readBytes();e=this.tryConvertString(t)}return this.received=[],e}tryConvertString(e){return r.dataArray2string(e)}notified(e){if(this.onreceive){let t=this.tryConvertString(e.data);this.onreceive(e.data,t)}else this.received||(this.received=[]),this.received.push.apply(this.received,e.data)}isUsed(){return this.used}end(){let e={};e["uart"+this.id]=null,this.params=null,this.Obniz.send(e),this.used=!1}}}).call(this,i(1).Buffer)},function(e,t,i){(function(t){const r="undefined"==typeof window,s=i(6);e.exports=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.connectObservers=[],this.readObservers=[],this.used=!1}_addConnectObserver(e){e&&this.connectObservers.push(e)}_addReadObserver(e){e&&this.readObservers.push(e)}connectWait(e,t){if(s.lt(this.Obniz.firmware_ver,"2.1.0"))throw new Error("Please update obniz firmware >= 2.1.0");if(e<0||e>65535)throw new Error(`tcp${this.id} is invalid port`);if(t.length>30)throw new Error(`tcp${this.id} is domain length over`);return this.connectObservers=[],this.used=!0,new Promise((i,r)=>{this._addConnectObserver(i);let s={};s["tcp"+this.id]={connect:{port:e,domain:t}},this.Obniz.send(s)})}close(){let e={};e["tcp"+this.id]={disconnect:!0},this.Obniz.send(e)}write(e){if(!this.used)throw new Error(`tcp${this.id} is not started`);if(void 0===e)return;"number"==typeof e&&(e=[e]);let i=null;if(r&&e instanceof t)i=[...e];else if(e.constructor===Array)i=e;else if("string"==typeof e){i=[...t.from(e)]}let s={};s["tcp"+this.id]={write:{data:i}},this.Obniz.send(s)}readWait(){return new Promise((e,t)=>{this._addReadObserver(e)})}end(){this.close()}notified(e){if(e.connection)this.onconnection&&this.onconnection(e.connection.connected),e.connection.connected||this._reset();else if(e.read){this.onreceive&&this.onreceive(e.read.data);let t=this.readObservers.shift();t&&t(e.read.data)}else if(e.connect){0!==e.connect.code&&this.onerror&&this.onerror(e.connect);let t=this.connectObservers.shift();t&&t(e.connect.code)}}isUsed(){return this.used}}}).call(this,i(1).Buffer)},function(e,t,i){const r=i(55),s=i(3);let n={};e.exports=class e extends r{constructor(e,t){super(e,t)}static _parts(){return n}static PartsRegistrate(e,t){e&&"function"==typeof e.info&&"string"==typeof e.info().name?n[e.info().name]=e:"string"==typeof e&&"object"==typeof t&&(n[e]=t)}static Parts(e){if(!n[e])throw new Error(`unknown parts [${e}]`);return new n[e]}wired(t){let i=e.Parts(t);if(!i)throw new Error("No such a parts ["+t+"] found");let r=Array.from(arguments);if(r.shift(),r.unshift(this),i.keys){if(i.requiredKeys){let e=s._requiredKeys(r[1],i.requiredKeys);if(e)throw new Error(t+" wired param '"+e+"' required, but not found ")}i.params=s._keyFilter(r[1],i.keys)}if(i.obniz=this,i.wired.apply(i,r),i.keys||i.ioKeys){let e=i.ioKeys||i.keys,s=i.displayName||t,n={};for(let t in e){let s=e[t],a=r[1][s];this.isValidIO(a)&&(i.displayIoNames&&i.displayIoNames[s]&&(s=i.displayIoNames[s]),n[a]=s)}this.display.setPinNames(s,n)}return i}}},function(e,t,i){const r=i(56),s=i(5),n="undefined"==typeof window;e.exports=class{constructor(e,t){if(this.isNode=n,this.id=e,this.socket=null,this.socket_local=null,this.debugprint=!1,this.debugprintBinary=!1,this.debugs=[],this.onConnectCalled=!1,this.hw=void 0,this.firmware_ver=void 0,this.connectionState="closed",this.bufferdAmoundWarnBytes=1e7,this.emitter=new s,this._connectionRetryCount=0,t||(t={}),this.options={binary:!1!==t.binary,local_connect:!1!==t.local_connect,debug_dom_id:t.debug_dom_id||"obniz-debug",auto_connect:!1!==t.auto_connect,access_token:t.access_token||null,obniz_server:t.obniz_server||"wss://obniz.io",reset_obniz_on_ws_disconnection:!1!==t.reset_obniz_on_ws_disconnection},this.options.binary){this.wscommand=this.constructor.WSCommand;let e=this.constructor.WSCommand.CommandClasses;this.wscommands=[];for(let t in e)this.wscommands.push(new e[t]({hw:{firmware:void 0,model:"obniz_board"},delegate:void 0}))}this.options.auto_connect&&this.wsconnect()}prompt(e,t){let i=prompt("Please enter obniz id",e);i&&t(i)}static get version(){return i(19).version}wsOnOpen(){this.print_debug("ws connected"),this._connectionRetryCount=0,"function"==typeof this.onopen&&this.onopen(this)}wsOnMessage(e){let t;if("string"==typeof e?t=JSON.parse(e):this.wscommands&&(this.debugprintBinary&&console.log("Obniz: binalized: "+new Uint8Array(e).toString()),t=this.binary2Json(e)),Array.isArray(t))for(let e in t)this.notifyToModule(t[e])}wsOnClose(e){this.print_debug("closed"),this.close(),this.emitter.emit("closed"),"function"==typeof this.onclose&&1==this.onConnectCalled&&this.onclose(this),this.onConnectCalled=!1,this._reconnect()}connectWait(e){let t=(e=e||{}).timeout||null;return new Promise((e,i)=>{this.onConnectCalled?e(!0):(this.emitter.once("connected",()=>{e(!0)}),this.options.auto_connect||this.emitter.once("closed",()=>{e(!1)}),t&&setTimeout(()=>{e(!1)},1e3*t),this.connect())})}_reconnect(){this._connectionRetryCount++;let e=1e3;if(this._connectionRetryCount>15){e=1e3*(this._connectionRetryCount-15);const t=n?6e4:1e4;e>t&&(e=t)}this.options.auto_connect&&setTimeout(()=>{this.wsconnect()},e)}wsOnError(e){}wsOnUnexpectedResponse(e,t){t&&404==t.statusCode?this.print_debug("obniz not online"):this.print_debug(t.statusCode),this.clearSocket(this.socket),delete this.socket,this._reconnect()}wsconnect(e){let t=this.options.obniz_server;e&&(t=""+e),this.socket&&this.socket.readyState<=1&&this.close();let r,s=t+"/obniz/"+this.id+"/ws/1",n=[];if(this.constructor.version&&n.push("obnizjs="+this.constructor.version),this.options.access_token&&n.push("access_token="+this.options.access_token),this.wscommand&&n.push("accept_binary=true"),n.length>0&&(s+="?"+n.join("&")),this.print_debug("connecting to "+s),this.isNode){(r=new(i(20))(s)).on("open",this.wsOnOpen.bind(this)),r.on("message",this.wsOnMessage.bind(this)),r.on("close",this.wsOnClose.bind(this)),r.on("error",this.wsOnError.bind(this)),r.on("unexpected-response",this.wsOnUnexpectedResponse.bind(this))}else(r=new WebSocket(s)).binaryType="arraybuffer",r.onopen=this.wsOnOpen.bind(this),r.onmessage=function(e){this.wsOnMessage(e.data)}.bind(this),r.onclose=this.wsOnClose.bind(this),r.onerror=this.wsOnError.bind(this);this.socket=r,this.connectionState="connecting"}_connectLocal(e){const t="ws://"+e;let r;if(this.print_debug("local connect to "+t),this.isNode){(r=new(i(20))(t)).on("open",()=>{this.print_debug("connected to "+t),this._callOnConnect()}),r.on("message",e=>{this.print_debug("recvd via local"),this.wsOnMessage(e)}),r.on("close",e=>{console.log("local websocket closed"),this._disconnectLocal()}),r.on("error",e=>{console.error("local websocket error.",e),this._disconnectLocal()}),r.on("unexpected-response",e=>{console.log("local websocket closed"),this._disconnectLocal()})}else(r=new WebSocket(t)).binaryType="arraybuffer",r.onopen=()=>{this.print_debug("connected to "+t),this._callOnConnect()},r.onmessage=e=>{this.print_debug("recvd via local"),this.wsOnMessage(e.data)},r.onclose=e=>{console.log("local websocket closed"),this._disconnectLocal()},r.onerror=e=>{console.log("local websocket error.",e),this._disconnectLocal()};this.socket_local=r}_disconnectLocal(){this.socket_local&&(this.socket.readyState<=1&&this.socket_local.close(),this.clearSocket(this.socket_local),delete this.socket_local),this._waitForLocalConnectReadyTimer&&(clearTimeout(this._waitForLocalConnectReadyTimer),this._waitForLocalConnectReadyTimer=null,this._callOnConnect())}clearSocket(e){if(e)if(this._sendQueueTimer&&(delete this._sendQueue,clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null),this.isNode){let t=["open","message","close","error","unexpected-response"];for(let i=0;i<t.length;i++)e.removeAllListeners(t[i])}else e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null}connect(){this.socket&&this.socket.readyState<=1||this.wsconnect()}close(){this._drainQueued(),this._disconnectLocal(),this.socket&&(this.socket.readyState<=1&&(this.connectionState="closing",this.socket.close(1e3,"close")),this.clearSocket(this.socket),delete this.socket),this.connectionState="closed"}_callOnConnect(){let e=!0;if(this._waitForLocalConnectReadyTimer?(clearTimeout(this._waitForLocalConnectReadyTimer),this._waitForLocalConnectReadyTimer=null):this.socket_local&&1===this.socket_local.readyState&&(e=!1),this.emitter.emit("connected"),e){if(this.connectionState="connected","function"==typeof this.onconnect){const e=this.onconnect(this);e instanceof Promise&&e.catch(e=>{console.error(e)})}this.onConnectCalled=!0}}print_debug(e){this.debugprint&&console.log("Obniz: "+e)}send(e,t){try{if(!e||"object"!=typeof e)return void console.log("obnizjs. didnt send ",e);if(Array.isArray(e)){for(let t=0;t<e.length;t++)this.send(e[t]);return}if(this.sendPool)return void this.sendPool.push(e);let i=JSON.stringify([e]);if(this.debugprint&&this.print_debug("send: "+i),this.wscommand&&("object"!=typeof t||!1!==t.local_connect)){let e;try{(e=this.wscommand.compress(this.wscommands,JSON.parse(i)[0]))&&(i=e,this.debugprintBinary&&console.log("Obniz: binalized: "+new Uint8Array(e).toString()))}catch(e){throw this.error("------ errored json -------"),this.error(i),e}}"string"==typeof i?(this._drainQueued(),this._sendRouted(i)):this._sendQueue?this._sendQueue.push(i):(this._sendQueue=[i],this._sendQueueTimer=setTimeout(this._drainQueued.bind(this),0))}catch(e){console.log(e)}}_sendRouted(e){return this.socket_local&&1===this.socket_local.readyState&&"string"!=typeof e?(this.print_debug("send via local"),this.socket_local.send(e),void(this.socket_local.bufferedAmount>this.bufferdAmoundWarnBytes&&this.warning("over "+this.socket_local.bufferedAmount+" bytes queued"))):this.socket&&1===this.socket.readyState?(this.socket.send(e),void(this.socket.bufferedAmount>this.bufferdAmoundWarnBytes&&this.warning("over "+this.socket.bufferedAmount+" bytes queued"))):void 0}_drainQueued(){if(!this._sendQueue)return;let e=0;for(let t=0;t<this._sendQueue.length;t++)e+=this._sendQueue[t].length;let t=0,i=new Uint8Array(e);for(let e=0;e<this._sendQueue.length;e++)i.set(this._sendQueue[e],t),t+=this._sendQueue[e].length;this._sendRouted(i),delete this._sendQueue,clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null}notifyToModule(e){this.debugprint&&this.print_debug(JSON.stringify(e)),e.ws?this.handleWSCommand(e.ws):e.system&&this.handleSystemCommand(e.system)}_canConnectToInsecure(){return!!this.isNode||"https:"!=location.protocol}handleWSCommand(e){if(e.ready){if(this.firmware_ver=e.obniz.firmware,this.hw=e.obniz.hw,this.hw||(this.hw="obnizb1"),this.wscommands)for(let e=0;e<this.wscommands.length;e++){this.wscommands[e].setHw({hw:this.hw,firmware:this.firmware_ver})}this.options.reset_obniz_on_ws_disconnection&&this.resetOnDisconnect(!0),e.local_connect&&e.local_connect.ip&&this.wscommand&&this.options.local_connect&&this._canConnectToInsecure()?(this._connectLocal(e.local_connect.ip),this._waitForLocalConnectReadyTimer=setTimeout(()=>{this._callOnConnect()},3e3)):this._callOnConnect()}if(e.redirect){let t=e.redirect;this.print_debug("WS connection changed to "+t),this.socket.close(1e3,"close"),this.clearSocket(this.socket),delete this.socket,this.wsconnect(t)}}handleSystemCommand(e){}static get WSCommand(){return r}binary2Json(e){let t=new Uint8Array(e),i=[];for(;null!==t;){const e=r.dequeueOne(t);if(!e)break;let s={};for(let t=0;t<this.wscommands.length;t++){const i=this.wscommands[t];if(i.module===e.module){i.notifyFromBinary(s,e.func,e.payload);break}}i.push(s),t=e.next}return i}warning(e){console.log("warning:"+e)}error(e){console.error("error:"+e)}}},function(e,t,i){const r=i(0);r.addCommandClass("WSCommand_System",i(218)),r.addCommandClass("WSCommand_Directive",i(219)),r.addCommandClass("WSCommand_IO",i(17)),r.addCommandClass("WSCommand_PWM",i(18)),r.addCommandClass("WSCommand_UART",i(220)),r.addCommandClass("WSCommand_AD",i(221)),r.addCommandClass("WSCommand_SPI",i(222)),r.addCommandClass("WSCommand_I2C",i(223)),r.addCommandClass("WSCommand_LogicAnalyzer",i(224)),r.addCommandClass("WSCommand_Display",i(225)),r.addCommandClass("WSCommand_Switch",i(227)),r.addCommandClass("WSCommand_Ble",i(228)),r.addCommandClass("WSCommand_Measurement",i(230)),r.addCommandClass("WSCommand_Tcp",i(231)),e.exports=r},function(e,t,i){(function(t){const r=i(58);r.defineError("UNIQUE_KEYS",10001,"{uniqueKeys} are must be unique value."),r.defineKeyword("uniqueKeys",(function(e,t,i){if(!Array.isArray(t))return null;let s=[];for(let i of t)null!==e[i]&&void 0!==e[i]&&s.push(e[i]);return s.filter((function(e,t,i){return i.indexOf(e)!==i.lastIndexOf(e)})).length>0?{code:r.errorCodes.UNIQUE_KEYS,message:{uniqueKeys:t.join(",")}}:null}));let s=[];i(8).context=i(16),i(8).context&&i(8).context.setBaseDir&&i(8).context.setBaseDir(t);let n=i(59);for(let e of n.keys()){let t=n(e);s.push(t)}s.map(r.addSchema),e.exports=r}).call(this,"/")},function(e,t,i){var r,s,n;s=[],void 0===(n="function"==typeof(r=function(){var e,t,i,r;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=(i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var n=[];for(var a in s)e.call(s,a)&&n.push(a);if(t)for(var o=0;o<r;o++)e.call(s,i[o])&&n.push(i[o]);return n})),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var s=r>=0?r:Math.max(i-Math.abs(r),0);s<i;s++)if(s in t&&t[s]===e)return s;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var s={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};function a(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,(function(e){return"%"+e.substring(3)}))}function o(e){var t="";s[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var i="",r="",o=!0,h=!1,c=!1;"+"===t?o=!1:"."===t?(r=".",i="."):"/"===t?(r="/",i="/"):"#"===t?(r="#",o=!1):";"===t?(r=";",i=";",h=!0,c=!0):"?"===t?(r="?",i="&",h=!0):"&"===t&&(r="&",i="&",h=!0);for(var d=[],u=e.split(","),l=[],p={},m=0;m<u.length;m++){var f=u[m],g=null;if(-1!==f.indexOf(":")){var y=f.split(":");f=y[0],g=parseInt(y[1],10)}for(var _={};n[f.charAt(f.length-1)];)_[f.charAt(f.length-1)]=!0,f=f.substring(0,f.length-1);var w={truncate:g,name:f,suffices:_};l.push(w),p[f]=w,d.push(f)}var v=function(e){for(var t="",s=0,n=0;n<l.length;n++){var d=l[n],u=e(d.name);if(null==u||Array.isArray(u)&&0===u.length||"object"==typeof u&&0===Object.keys(u).length)s++;else if(t+=n===s?r:i||",",Array.isArray(u)){h&&(t+=d.name+"=");for(var p=0;p<u.length;p++)p>0&&(t+=d.suffices["*"]&&i||",",d.suffices["*"]&&h&&(t+=d.name+"=")),t+=o?encodeURIComponent(u[p]).replace(/!/g,"%21"):a(u[p])}else if("object"==typeof u){h&&!d.suffices["*"]&&(t+=d.name+"=");var m=!0;for(var f in u)m||(t+=d.suffices["*"]&&i||","),m=!1,t+=o?encodeURIComponent(f).replace(/!/g,"%21"):a(f),t+=d.suffices["*"]?"=":",",t+=o?encodeURIComponent(u[f]).replace(/!/g,"%21"):a(u[f])}else h&&(t+=d.name,c&&""===u||(t+="=")),null!=d.truncate&&(u=u.substring(0,d.truncate)),t+=o?encodeURIComponent(u).replace(/!/g,"%21"):a(u)}return t};return v.varNames=d,{prefix:r,substitution:v}}function h(e){if(!(this instanceof h))return new h(e);for(var t=e.split("{"),i=[t.shift()],r=[],s=[],n=[];t.length>0;){var a=t.shift(),c=a.split("}")[0],d=a.substring(c.length+1),u=o(c);s.push(u.substitution),r.push(u.prefix),i.push(d),n=n.concat(u.substitution.varNames)}this.fill=function(e){for(var t=i[0],r=0;r<s.length;r++)t+=(0,s[r])(e),t+=i[r+1];return t},this.varNames=n,this.template=e}h.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill((function(t){return e[t]}))}};var c=function(e,t,i,r,s){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,r&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),s&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=i||y("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var n in e.definedKeywords)this.definedKeywords[n]=e.definedKeywords[n].slice(0)};function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!d(e[i],t[i]))return!1}else{var r;for(r in e)if(void 0===t[r]&&void 0!==e[r])return!1;for(r in t)if(void 0===e[r]&&void 0!==t[r])return!1;for(r in e)if(!d(e[r],t[r]))return!1}return!0}return!1}c.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},c.prototype.createError=function(e,t,i,r,s,n,a){var o=new C(e,t,i,r,s);return o.message=this.errorReporter(o,n,a),o},c.prototype.returnError=function(e){return e},c.prototype.collectError=function(e){return e&&this.errors.push(e),null},c.prototype.prefixErrors=function(e,t,i){for(var r=e;r<this.errors.length;r++)this.errors[r]=this.errors[r].prefixWith(t,i);return this},c.prototype.banUnknownProperties=function(e,t){for(var i in this.unknownPropertyPaths){var r=this.createError(_.UNKNOWN_PROPERTY,{path:i},i,"",null,e,t),s=this.handleError(r);if(s)return s}return null},c.prototype.addFormat=function(e,t){if("object"==typeof e){for(var i in e)this.addFormat(i,e[i]);return this}this.formatValidators[e]=t},c.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){if((t=t||{})[e.$ref])return this.createError(_.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},c.prototype.getSchema=function(e,t){var i;if(void 0!==this.schemas[e])return i=this.schemas[e],this.resolveRefs(i,t);var r=e,s="";if(-1!==e.indexOf("#")&&(s=e.substring(e.indexOf("#")+1),r=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[r]){i=this.schemas[r];var n=decodeURIComponent(s);if(""===n)return this.resolveRefs(i,t);if("/"!==n.charAt(0))return;for(var a=n.split("/").slice(1),o=0;o<a.length;o++){var h=a[o].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===i[h]){i=void 0;break}i=i[h]}if(void 0!==i)return this.resolveRefs(i,t)}void 0===this.missing[r]&&(this.missing.push(r),this.missing[r]=r,this.missingMap[r]=r)},c.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var i=0;i<e.length;i++)this.searchSchemas(e[i],t);else if(e&&"object"==typeof e)for(var r in"string"==typeof e.id&&function(e,t){if(t.substring(0,e.length)===e){var i=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===i.charAt(0)||"?"===i.charAt(0))return!0}return!1}(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)if("enum"!==r)if("object"==typeof e[r])this.searchSchemas(e[r],t);else if("$ref"===r){var s=f(e[r]);s&&void 0===this.schemas[s]&&void 0===this.missingMap[s]&&(this.missingMap[s]=s)}},c.prototype.addSchema=function(e,t){if("string"!=typeof e||void 0===t){if("object"!=typeof e||"string"!=typeof e.id)return;e=(t=e).id}e===f(e)+"#"&&(e=f(e)),this.schemas[e]=t,delete this.missingMap[e],g(t,e),this.searchSchemas(t,e)},c.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},c.prototype.getSchemaUris=function(e){var t=[];for(var i in this.schemas)e&&!e.test(i)||t.push(i);return t},c.prototype.getMissingUris=function(e){var t=[];for(var i in this.missingMap)e&&!e.test(i)||t.push(i);return t},c.prototype.dropSchemas=function(){this.schemas={},this.reset()},c.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},c.prototype.validateAll=function(e,t,i,r,s){var n;if(!(t=this.resolveRefs(t)))return null;if(t instanceof C)return this.errors.push(t),t;var a,o=this.errors.length,h=null,c=null;if(this.checkRecursive&&e&&"object"==typeof e){if(n=!this.scanned.length,e[this.validatedSchemasKey]){var d=e[this.validatedSchemasKey].indexOf(t);if(-1!==d)return this.errors=this.errors.concat(e[this.validationErrorsKey][d]),null}if(Object.isFrozen(e)&&-1!==(a=this.scannedFrozen.indexOf(e))){var u=this.scannedFrozenSchemas[a].indexOf(t);if(-1!==u)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[a][u]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===a&&(a=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),h=this.scannedFrozenSchemas[a].length,this.scannedFrozenSchemas[a][h]=t,this.scannedFrozenValidationErrors[a][h]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}c=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][c]=t,e[this.validationErrorsKey][c]=[]}}var l=this.errors.length,p=this.validateBasic(e,t,s)||this.validateNumeric(e,t,s)||this.validateString(e,t,s)||this.validateArray(e,t,s)||this.validateObject(e,t,s)||this.validateCombinations(e,t,s)||this.validateHypermedia(e,t,s)||this.validateFormat(e,t,s)||this.validateDefinedKeywords(e,t,s)||null;if(n){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(p||l!==this.errors.length)for(;i&&i.length||r&&r.length;){var m=i&&i.length?""+i.pop():null,f=r&&r.length?""+r.pop():null;p&&(p=p.prefixWith(m,f)),this.prefixErrors(l,m,f)}return null!==h?this.scannedFrozenValidationErrors[a][h]=this.errors.slice(o):null!==c&&(e[this.validationErrorsKey][c]=this.errors.slice(o)),this.handleError(p)},c.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var i=this.formatValidators[t.format].call(null,e,t);return"string"==typeof i||"number"==typeof i?this.createError(_.FORMAT_CUSTOM,{message:i},"","/format",null,e,t):i&&"object"==typeof i?this.createError(_.FORMAT_CUSTOM,{message:i.message||"?"},i.dataPath||"",i.schemaPath||"/format",null,e,t):null},c.prototype.validateDefinedKeywords=function(e,t,i){for(var r in this.definedKeywords)if(void 0!==t[r])for(var s=this.definedKeywords[r],n=0;n<s.length;n++){var a=(0,s[n])(e,t[r],t,i);if("string"==typeof a||"number"==typeof a)return this.createError(_.KEYWORD_CUSTOM,{key:r,message:a},"","",null,e,t).prefixWith(null,r);if(a&&"object"==typeof a){var o=a.code;if("string"==typeof o){if(!_[o])throw new Error("Undefined error code (use defineError): "+o);o=_[o]}else"number"!=typeof o&&(o=_.KEYWORD_CUSTOM);var h="object"==typeof a.message?a.message:{key:r,message:a.message||"?"},c=a.schemaPath||"/"+r.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(o,h,a.dataPath||null,c,null,e,t)}}return null},c.prototype.validateBasic=function(e,t,i){var r;return(r=this.validateType(e,t,i))?r.prefixWith(null,"type"):(r=this.validateEnum(e,t,i))?r.prefixWith(null,"type"):null},c.prototype.validateType=function(e,t){if(void 0===t.type)return null;var i=typeof e;null===e?i="null":Array.isArray(e)&&(i="array");var r=t.type;Array.isArray(r)||(r=[r]);for(var s=0;s<r.length;s++){var n=r[s];if(n===i||"integer"===n&&"number"===i&&e%1==0)return null}return this.createError(_.INVALID_TYPE,{type:i,expected:r.join("/")},"","",null,e,t)},c.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var i=0;i<t.enum.length;i++)if(d(e,t.enum[i]))return null;return this.createError(_.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},c.prototype.validateNumeric=function(e,t,i){return this.validateMultipleOf(e,t,i)||this.validateMinMax(e,t,i)||this.validateNaN(e,t,i)||null};var u=Math.pow(2,-51),l=1-u;function p(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function m(e,t){return t=p(t||""),e=p(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+(i=t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname,r=[],i.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,(function(e){"/.."===e?r.pop():r.push(e)})),r.join("").replace(/^\//,"/"===i.charAt(0)?"/":""))+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null;var i,r}function f(e){return e.split("#")[0]}function g(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=m(t,e.id),e.id=t),Array.isArray(e))for(var i=0;i<e.length;i++)g(e[i],t);else for(var r in"string"==typeof e.$ref&&(e.$ref=m(t,e.$ref)),e)"enum"!==r&&g(e[r],t)}function y(e){var t=x[e=e||"en"];return function(e){var i=t[e.code]||b[e.code];if("string"!=typeof i)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var r=e.params;return i.replace(/\{([^{}]*)\}/g,(function(e,t){var i=r[t];return"string"==typeof i||"number"==typeof i?i:e}))}}c.prototype.validateMultipleOf=function(e,t){var i=t.multipleOf||t.divisibleBy;if(void 0===i)return null;if("number"==typeof e){var r=e/i%1;if(r>=u&&r<l)return this.createError(_.NUMBER_MULTIPLE_OF,{value:e,multipleOf:i},"","",null,e,t)}return null},c.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(_.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(_.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(_.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(_.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},c.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:!0===isNaN(e)||e===1/0||e===-1/0?this.createError(_.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},c.prototype.validateString=function(e,t,i){return this.validateStringLength(e,t,i)||this.validateStringPattern(e,t,i)||null},c.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(_.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(_.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},c.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var i;if(t.pattern instanceof RegExp)i=t.pattern;else{var r,s="",n=t.pattern.match(/^\/(.+)\/([img]*)$/);n?(r=n[1],s=n[2]):r=t.pattern,i=new RegExp(r,s)}return i.test(e)?null:this.createError(_.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},c.prototype.validateArray=function(e,t,i){return Array.isArray(e)&&(this.validateArrayLength(e,t,i)||this.validateArrayUniqueItems(e,t,i)||this.validateArrayItems(e,t,i))||null},c.prototype.validateArrayLength=function(e,t){var i;return void 0!==t.minItems&&e.length<t.minItems&&(i=this.createError(_.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(i))?i:void 0!==t.maxItems&&e.length>t.maxItems&&(i=this.createError(_.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(i))?i:null},c.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var i=0;i<e.length;i++)for(var r=i+1;r<e.length;r++)if(d(e[i],e[r])){var s=this.createError(_.ARRAY_UNIQUE,{match1:i,match2:r},"","/uniqueItems",null,e,t);if(this.handleError(s))return s}return null},c.prototype.validateArrayItems=function(e,t,i){if(void 0===t.items)return null;var r,s;if(Array.isArray(t.items)){for(s=0;s<e.length;s++)if(s<t.items.length){if(r=this.validateAll(e[s],t.items[s],[s],["items",s],i+"/"+s))return r}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(r=this.createError(_.ARRAY_ADDITIONAL_ITEMS,{},"/"+s,"/additionalItems",null,e,t),this.handleError(r)))return r}else if(r=this.validateAll(e[s],t.additionalItems,[s],["additionalItems"],i+"/"+s))return r}else for(s=0;s<e.length;s++)if(r=this.validateAll(e[s],t.items,[s],["items"],i+"/"+s))return r;return null},c.prototype.validateObject=function(e,t,i){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,i)||this.validateObjectRequiredProperties(e,t,i)||this.validateObjectProperties(e,t,i)||this.validateObjectDependencies(e,t,i)||null},c.prototype.validateObjectMinMaxProperties=function(e,t){var i,r=Object.keys(e);return void 0!==t.minProperties&&r.length<t.minProperties&&(i=this.createError(_.OBJECT_PROPERTIES_MINIMUM,{propertyCount:r.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(i))?i:void 0!==t.maxProperties&&r.length>t.maxProperties&&(i=this.createError(_.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:r.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(i))?i:null},c.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var i=0;i<t.required.length;i++){var r=t.required[i];if(void 0===e[r]){var s=this.createError(_.OBJECT_REQUIRED,{key:r},"","/required/"+i,null,e,t);if(this.handleError(s))return s}}return null},c.prototype.validateObjectProperties=function(e,t,i){var r;for(var s in e){var n=i+"/"+s.replace(/~/g,"~0").replace(/\//g,"~1"),a=!1;if(void 0!==t.properties&&void 0!==t.properties[s]&&(a=!0,r=this.validateAll(e[s],t.properties[s],[s],["properties",s],n)))return r;if(void 0!==t.patternProperties)for(var o in t.patternProperties)if(new RegExp(o).test(s)&&(a=!0,r=this.validateAll(e[s],t.patternProperties[o],[s],["patternProperties",o],n)))return r;if(a)this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(r=this.createError(_.OBJECT_ADDITIONAL_PROPERTIES,{key:s},"","/additionalProperties",null,e,t).prefixWith(s,null),this.handleError(r)))return r}else if(r=this.validateAll(e[s],t.additionalProperties,[s],["additionalProperties"],n))return r}else this.trackUnknownProperties&&!this.knownPropertyPaths[n]&&(this.unknownPropertyPaths[n]=!0)}return null},c.prototype.validateObjectDependencies=function(e,t,i){var r;if(void 0!==t.dependencies)for(var s in t.dependencies)if(void 0!==e[s]){var n=t.dependencies[s];if("string"==typeof n){if(void 0===e[n]&&(r=this.createError(_.OBJECT_DEPENDENCY_KEY,{key:s,missing:n},"","",null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(r)))return r}else if(Array.isArray(n))for(var a=0;a<n.length;a++){var o=n[a];if(void 0===e[o]&&(r=this.createError(_.OBJECT_DEPENDENCY_KEY,{key:s,missing:o},"","/"+a,null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(r)))return r}else if(r=this.validateAll(e,n,[],["dependencies",s],i))return r}return null},c.prototype.validateCombinations=function(e,t,i){return this.validateAllOf(e,t,i)||this.validateAnyOf(e,t,i)||this.validateOneOf(e,t,i)||this.validateNot(e,t,i)||null},c.prototype.validateAllOf=function(e,t,i){if(void 0===t.allOf)return null;for(var r,s=0;s<t.allOf.length;s++){var n=t.allOf[s];if(r=this.validateAll(e,n,[],["allOf",s],i))return r}return null},c.prototype.validateAnyOf=function(e,t,i){if(void 0===t.anyOf)return null;var r,s,n=[],a=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var o=!0,h=0;h<t.anyOf.length;h++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.anyOf[h],d=this.errors.length,u=this.validateAll(e,c,[],["anyOf",h],i);if(null===u&&d===this.errors.length){if(this.errors=this.errors.slice(0,a),this.trackUnknownProperties){for(var l in this.knownPropertyPaths)s[l]=!0,delete r[l];for(var p in this.unknownPropertyPaths)s[p]||(r[p]=!0);o=!1;continue}return null}u&&n.push(u.prefixWith(null,""+h).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),o?(n=n.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(_.ANY_OF_MISSING,{},"","/anyOf",n,e,t)):void 0},c.prototype.validateOneOf=function(e,t,i){if(void 0===t.oneOf)return null;var r,s,n=null,a=[],o=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var h=0;h<t.oneOf.length;h++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.oneOf[h],d=this.errors.length,u=this.validateAll(e,c,[],["oneOf",h],i);if(null===u&&d===this.errors.length){if(null!==n)return this.errors=this.errors.slice(0,o),this.createError(_.ONE_OF_MULTIPLE,{index1:n,index2:h},"","/oneOf",null,e,t);if(n=h,this.trackUnknownProperties){for(var l in this.knownPropertyPaths)s[l]=!0,delete r[l];for(var p in this.unknownPropertyPaths)s[p]||(r[p]=!0)}}else u&&a.push(u)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),null===n?(a=a.concat(this.errors.slice(o)),this.errors=this.errors.slice(0,o),this.createError(_.ONE_OF_MISSING,{},"","/oneOf",a,e,t)):(this.errors=this.errors.slice(0,o),null)},c.prototype.validateNot=function(e,t,i){if(void 0===t.not)return null;var r,s,n=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var a=this.validateAll(e,t.not,null,null,i),o=this.errors.slice(n);return this.errors=this.errors.slice(0,n),this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),null===a&&0===o.length?this.createError(_.NOT_PASSED,{},"","/not",null,e,t):null},c.prototype.validateHypermedia=function(e,t,i){if(!t.links)return null;for(var r,s=0;s<t.links.length;s++){var n=t.links[s];if("describedby"===n.rel){for(var a=new h(n.href),o=!0,c=0;c<a.varNames.length;c++)if(!(a.varNames[c]in e)){o=!1;break}if(o){var d={$ref:a.fillFromObject(e)};if(r=this.validateAll(e,d,[],["links",s],i))return r}}}};var _={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},w={};for(var v in _)w[_[v]]=v;var b={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function C(e,t,i,r,s){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+r);this.message="",this.params=t,this.code=e,this.dataPath=i||"",this.schemaPath=r||"",this.subErrors=s||null;var n=new Error(this.message);if(this.stack=n.stack||n.stacktrace,!this.stack)try{throw n}catch(n){this.stack=n.stack||n.stacktrace}}C.prototype=Object.create(Error.prototype),C.prototype.constructor=C,C.prototype.name="ValidationError",C.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var i=0;i<this.subErrors.length;i++)this.subErrors[i].prefixWith(e,t);return this};var x={},S=function e(t){var i,r,s=new c,n={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(r=e,!0)},addFormat:function(){s.addFormat.apply(s,arguments)},language:function(e){return e?(x[e]||(e=e.split("-")[0]),!!x[e]&&(i=e,e)):i},addLanguage:function(e,t){var i;for(i in _)t[i]&&!t[_[i]]&&(t[_[i]]=t[i]);var r=e.split("-")[0];if(x[r])for(i in x[e]=Object.create(x[r]),t)void 0===x[r][i]&&(x[r][i]=t[i]),x[e][i]=t[i];else x[e]=t,x[r]=t;return this},freshApi:function(t){var i=e();return t&&i.language(t),i},validate:function(e,t,n,a){var o=y(i),h=new c(s,!1,r?function(e,t,i){return r(e,t,i)||o(e,t,i)}:o,n,a);"string"==typeof t&&(t={$ref:t}),h.addSchema("",t);var d=h.validateAll(e,t,null,null,"");return!d&&a&&(d=h.banUnknownProperties(e,t)),this.error=d,this.missing=h.missing,this.valid=null===d,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,t,n,a){var o=y(i),h=new c(s,!0,r?function(e,t,i){return r(e,t,i)||o(e,t,i)}:o,n,a);"string"==typeof t&&(t={$ref:t}),h.addSchema("",t),h.validateAll(e,t,null,null,""),a&&h.banUnknownProperties(e,t);var d={toString:function(){return this.valid?"valid":this.error.message}};return d.errors=h.errors,d.missing=h.missing,d.valid=0===d.errors.length,d},addSchema:function(){return s.addSchema.apply(s,arguments)},getSchema:function(){return s.getSchema.apply(s,arguments)},getSchemaMap:function(){return s.getSchemaMap.apply(s,arguments)},getSchemaUris:function(){return s.getSchemaUris.apply(s,arguments)},getMissingUris:function(){return s.getMissingUris.apply(s,arguments)},dropSchemas:function(){s.dropSchemas.apply(s,arguments)},defineKeyword:function(){s.defineKeyword.apply(s,arguments)},defineError:function(e,t,i){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!=0||t<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==_[e])throw new Error("Error already defined: "+e+" as "+_[e]);if(void 0!==w[t])throw new Error("Error code already used: "+w[t]+" as "+t);for(var r in _[e]=t,w[t]=e,b[e]=b[t]=i,x){var s=x[r];s[e]&&(s[t]=s[t]||s[e])}},reset:function(){s.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:g,resolveUrl:m,getDocumentUri:f,errorCodes:_};return n.language(t||"en"),n}();return S.addLanguage("en-gb",b),S.tv4=S,S})?r.apply(t,s):r)||(e.exports=n)},function(e,t,i){var r={"./index.yml":60,"./request/ad/deinit.yml":61,"./request/ad/index.yml":62,"./request/ad/input.yml":63,"./request/ble/central/characteristic_get.yml":64,"./request/ble/central/characteristic_read.yml":65,"./request/ble/central/characteristic_register_notify.yml":66,"./request/ble/central/characteristic_unregister_notify.yml":67,"./request/ble/central/characteristic_write.yml":68,"./request/ble/central/connect.yml":69,"./request/ble/central/descriptor_get.yml":70,"./request/ble/central/descriptor_read.yml":71,"./request/ble/central/descriptor_write.yml":72,"./request/ble/central/disconnect.yml":73,"./request/ble/central/index.yml":74,"./request/ble/central/scan_start.yml":75,"./request/ble/central/scan_stop.yml":76,"./request/ble/central/service_get.yml":77,"./request/ble/index.yml":78,"./request/ble/peripheral/advertisement_start.yml":79,"./request/ble/peripheral/advertisement_stop.yml":80,"./request/ble/peripheral/characteristic_notify.yml":81,"./request/ble/peripheral/characteristic_read.yml":82,"./request/ble/peripheral/characteristic_write.yml":83,"./request/ble/peripheral/descriptor_read.yml":84,"./request/ble/peripheral/descriptor_write.yml":85,"./request/ble/peripheral/index.yml":86,"./request/ble/peripheral/servie_start.yml":87,"./request/ble/peripheral/servie_stop.yml":88,"./request/ble/peripheral/servie_stop_all.yml":89,"./request/ble/security/auth.yml":90,"./request/ble/security/devices_clear.yml":91,"./request/ble/security/index.yml":92,"./request/ble/security/indicate_security_level.yml":93,"./request/ble/security/key_max_size.yml":94,"./request/ble/security/key_type.yml":95,"./request/display/clear.yml":96,"./request/display/index.yml":97,"./request/display/pin_assign.yml":98,"./request/display/qr.yml":99,"./request/display/raw.yml":100,"./request/display/text.yml":101,"./request/i2c/deinit.yml":102,"./request/i2c/index.yml":103,"./request/i2c/init_master.yml":104,"./request/i2c/init_slave.yml":105,"./request/i2c/read.yml":106,"./request/i2c/write.yml":107,"./request/index.yml":108,"./request/io/deinit.yml":109,"./request/io/index.yml":110,"./request/io/input.yml":111,"./request/io/input_detail.yml":112,"./request/io/output.yml":113,"./request/io/output_detail.yml":114,"./request/io/output_type.yml":115,"./request/io/pull_type.yml":116,"./request/ioanimation/changeState.yml":117,"./request/ioanimation/index.yml":118,"./request/ioanimation/init.yml":119,"./request/logicanalyzer/deinit.yml":120,"./request/logicanalyzer/index.yml":121,"./request/logicanalyzer/init.yml":122,"./request/measure/echo.yml":123,"./request/measure/index.yml":124,"./request/message/index.yml":125,"./request/message/send.yml":126,"./request/pwm/deinit.yml":127,"./request/pwm/freq.yml":128,"./request/pwm/index.yml":129,"./request/pwm/init.yml":130,"./request/pwm/modulate.yml":131,"./request/pwm/pulse.yml":132,"./request/spi/deinit.yml":133,"./request/spi/index.yml":134,"./request/spi/init_master.yml":135,"./request/spi/write.yml":136,"./request/switch/get.yml":137,"./request/switch/index.yml":138,"./request/system/index.yml":139,"./request/system/keep_working_at_offline.yml":140,"./request/system/ping.yml":141,"./request/system/reboot.yml":142,"./request/system/reset.yml":143,"./request/system/self_check.yml":144,"./request/system/wait.yml":145,"./request/tcp/connect.yml":146,"./request/tcp/disconnect.yml":147,"./request/tcp/index.yml":148,"./request/tcp/write.yml":149,"./request/uart/deinit.yml":150,"./request/uart/index.yml":151,"./request/uart/init.yml":152,"./request/uart/send.yml":153,"./request/ws/index.yml":154,"./request/ws/reset_obniz_on_ws_disconnection.yml":155,"./response/ad/get.yml":156,"./response/ad/index.yml":157,"./response/ble/central/characteristic_get.yml":158,"./response/ble/central/characteristic_get_finish.yml":159,"./response/ble/central/characteristic_notify.yml":160,"./response/ble/central/characteristic_read.yml":161,"./response/ble/central/characteristic_register_notify.yml":162,"./response/ble/central/characteristic_unregister_notify.yml":163,"./response/ble/central/characteristic_write.yml":164,"./response/ble/central/descriptor_get.yml":165,"./response/ble/central/descriptor_get_finish.yml":166,"./response/ble/central/descriptor_read.yml":167,"./response/ble/central/descriptor_write.yml":168,"./response/ble/central/error.yml":169,"./response/ble/central/index.yml":170,"./response/ble/central/scan.yml":171,"./response/ble/central/scan_finish.yml":172,"./response/ble/central/service_get.yml":173,"./response/ble/central/service_get_finish.yml":174,"./response/ble/central/status_update.yml":175,"./response/ble/index.yml":176,"./response/ble/peripheral/characteristic_notify_read.yml":177,"./response/ble/peripheral/characteristic_notify_write.yml":178,"./response/ble/peripheral/characteristic_read.yml":179,"./response/ble/peripheral/characteristic_write.yml":180,"./response/ble/peripheral/descriptor_notify_read.yml":181,"./response/ble/peripheral/descriptor_notify_write.yml":182,"./response/ble/peripheral/descriptor_read.yml":183,"./response/ble/peripheral/descriptor_write.yml":184,"./response/ble/peripheral/index.yml":185,"./response/ble/peripheral/status.yml":186,"./response/debug/error.yml":187,"./response/debug/index.yml":188,"./response/debug/warning.yml":189,"./response/i2c/index.yml":190,"./response/i2c/master.yml":191,"./response/i2c/slave.yml":192,"./response/index.yml":193,"./response/io/get.yml":194,"./response/io/index.yml":195,"./response/ioanimation/index.yml":196,"./response/ioanimation/notify.yml":197,"./response/logicanalyzer/data.yml":198,"./response/logicanalyzer/index.yml":199,"./response/measure/echo.yml":200,"./response/measure/index.yml":201,"./response/message/index.yml":202,"./response/message/receive.yml":203,"./response/spi/index.yml":204,"./response/spi/read.yml":205,"./response/switch/change.yml":206,"./response/switch/index.yml":207,"./response/system/index.yml":208,"./response/system/pong.yml":209,"./response/tcp/index.yml":210,"./response/tcp/read.yml":211,"./response/uart/index.yml":212,"./response/uart/receive.yml":213,"./response/ws/index.yml":214,"./response/ws/obniz.yml":215,"./response/ws/ready.yml":216,"./response/ws/redirect.yml":217};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=59},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/",definitions:{pinSetting:{id:"pinSetting",type:"integer",minimum:0,maximum:40,default:null},bleAdvertiseData:{id:"bleAdvertiseData",type:"array",default:null,maxItems:31,items:{type:"integer",minimum:0,maximum:255}},dataArray32:{id:"dataArray32",type:"array",default:null,maxItems:32,items:{type:"integer",minimum:0,maximum:255}},dataArray1024:{id:"dataArray1024",type:"array",default:null,maxItems:1024,items:{type:"integer",minimum:0,maximum:255}},bitArray:{id:"bitArray",type:"array",default:null,items:{type:"integer",minimum:0,maximum:1}},dataArray:{id:"dataArray",type:"array",default:null,items:{type:"integer",minimum:0,maximum:255}},imageData128x64:{id:"imageData128x64",type:"array",minItems:1024,maxItems:1024,items:{type:"integer",minimum:0,maximum:255}},hexString:{id:"hexString",type:"string",default:null,pattern:"^([0-9a-fA-F]+)$"},uuid:{id:"uuid",type:"string",pattern:"^([-0-9a-fA-F]+)$",minLength:4,maxLength:36},uuidOrNull:{id:"uuidOrNull",type:["string","null"],pattern:"^([-0-9a-fA-F]+)$",minLength:4,maxLength:36},deviceAddress:{id:"deviceAddress",type:"string",pattern:"^([0-9a-fA-F]+)$",minLength:12,maxLength:12},obnizId:{id:"obnizId",type:["string","integer"],pattern:"^[0-9]{4}-?[0-9]{4}$",minimum:0,maximum:99999999}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad",basePath:"ad0",anyOf:[{$ref:"/request/ad/get"},{$ref:"/request/ad/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad/get",related:"/response/ad/get",desription:"enable & start ad module at io.",type:"object",required:["stream"],properties:{stream:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_get",related:"/response/ble/central/characteristic_get",type:"object",required:["get_characteristics"],properties:{get_characteristics:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_read",related:"/response/ble/central/characteristic_read",type:"object",required:["read_characteristic"],properties:{read_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_register_notify",related:"/response/ble/central/characteristic_register_notify",type:"object",required:["register_notify_characteristic"],properties:{register_notify_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_unregister_notify",related:"/response/ble/central/characteristic_unregister_notify",type:"object",required:["unregister_notify_characteristic"],properties:{unregister_notify_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_write",related:"/response/ble/central/characteristic_write",type:"object",required:["write_characteristic"],properties:{write_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},needResponse:{type:"boolean",default:!0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/connect",related:"/response/ble/central/status_update",type:"object",required:["connect"],properties:{connect:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_get",related:"/response/ble/central/descriptor_get",type:"object",required:["get_descriptors"],properties:{get_descriptors:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_read",related:"/response/ble/central/descriptor_read",type:"object",required:["read_descriptor"],properties:{read_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_write",related:"/response/ble/central/descriptor_write",type:"object",required:["write_descriptor"],properties:{write_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},needResponse:{type:"boolean",default:!0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/disconnect",type:"object",required:["disconnect"],properties:{disconnect:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central",basePath:"ble",anyOf:[{$ref:"/request/ble/central/scan_start"},{$ref:"/request/ble/central/scan_stop"},{$ref:"/request/ble/central/connect"},{$ref:"/request/ble/central/disconnect"},{$ref:"/request/ble/central/service_get"},{$ref:"/request/ble/central/characteristic_get"},{$ref:"/request/ble/central/characteristic_read"},{$ref:"/request/ble/central/characteristic_write"},{$ref:"/request/ble/central/characteristic_register_notify"},{$ref:"/request/ble/central/characteristic_unregister_notify"},{$ref:"/request/ble/central/descriptor_get"},{$ref:"/request/ble/central/descriptor_read"},{$ref:"/request/ble/central/descriptor_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/scan_start",related:["/response/ble/central/scan","/response/ble/central/scan_finish"],type:"object",required:["scan"],properties:{scan:{type:"object",additionalProperties:!1,properties:{duration:{type:"integer",default:30}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/scan_stop",type:"object",required:["scan"],properties:{scan:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/service_get",related:"/response/ble/central/service_get",type:"object",required:["get_services"],properties:{get_services:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble",basePath:"ble",anyOf:[{$ref:"/request/ble/peripheral"},{$ref:"/request/ble/central"},{$ref:"/request/ble/security"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/advertisement_start",related:"/response/ble/peripheral/status",type:"object",required:["advertisement"],properties:{advertisement:{type:"object",required:["adv_data"],additionalProperties:!1,properties:{adv_data:{$ref:"/bleAdvertiseData"},scan_resp:{$ref:"/bleAdvertiseData"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/advertisement_stop",type:"object",required:["advertisement"],properties:{advertisement:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_notify",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["notify_characteristic"],properties:{notify_characteristic:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_read",related:"/response/ble/peripheral/characteristic_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["read_characteristic"],properties:{read_characteristic:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_write",related:"/response/ble/peripheral/characteristic_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["write_characteristic"],properties:{write_characteristic:{type:"object",required:["service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/descriptor_read",related:"/response/ble/peripheral/descriptor_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["read_descriptor"],properties:{read_descriptor:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/descriptor_write",related:"/response/ble/peripheral/descriptor_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["write_descriptor"],properties:{write_descriptor:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral",basePath:"ble",anyOf:[{$ref:"/request/ble/peripheral/advertisement_start"},{$ref:"/request/ble/peripheral/advertisement_stop"},{$ref:"/request/ble/peripheral/service_start"},{$ref:"/request/ble/peripheral/service_stop"},{$ref:"/request/ble/peripheral/service_stop_all"},{$ref:"/request/ble/peripheral/characteristic_read"},{$ref:"/request/ble/peripheral/characteristic_write"},{$ref:"/request/ble/peripheral/descriptor_read"},{$ref:"/request/ble/peripheral/descriptor_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_start",related:["/response/ble/peripheral/status","/response/ble/peripheral/characteristic_notify_read","/response/ble/peripheral/characteristic_notify_write","/response/ble/peripheral/descriptor_notify_read","/response/ble/peripheral/descriptor_notify_write"],type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["services"],properties:{services:{type:"array",minItems:1,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},characteristics:{type:"array",minItems:0,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},properties:{type:"array",default:["read","write"],items:{type:"string",enum:["broadcast","read","write_without_response","write","notify","indicate","auth","extended_properties"]}},permissions:{type:"array",default:["read","write"],items:{default:["read","write"],type:"string",enum:["read","read_encrypted","read_encrypted_mitm","write","write_encrypted","write_encrypted_mitm","write_signed","write_signed_mitm"]}},descriptors:{type:"array",minItems:0,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},permissions:{type:"array",default:["read","write"],items:{default:["read","write"],type:"string",enum:["read","read_encrypted","read_encrypted_mitm","write","write_encrypted","write_encrypted_mitm","write_signed","write_signed_mitm"]}}}}}}}}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_stop",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["stop_service"],properties:{stop_service:{type:"object",required:["service_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_stop_all",type:"object",required:["peripheral"],properties:{peripheral:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/auth",type:"object",required:["security"],properties:{security:{type:"object",required:["auth"],properties:{auth:{type:"array",default:["bonding"],minItems:"1,",items:{type:"string",enum:["bonding","mitm","secure_connection"]}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/devices_clear",type:"object",required:["security"],properties:{security:{type:"object",required:["devices"],properties:{devices:{type:"object",required:["clear"],properties:{clear:{type:"boolean",enum:[!0]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security",basePath:"ble.security",anyOf:[{$ref:"/request/ble/security/indicate_security_level"},{$ref:"/request/ble/security/auth"},{$ref:"/request/ble/security/key_type"},{$ref:"/request/ble/security/key_max_size"},{$ref:"/request/ble/security/devices_clear"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/indicate_security_level",type:"object",required:["security"],properties:{security:{type:"object",required:["indicate_security_level"],properties:{indicate_security_level:{type:"integer",min:0,max:4}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/key_max_size",type:"object",required:["security"],properties:{security:{type:"object",required:["key"],properties:{key:{type:"object",required:["max_size"],properties:{max_size:{type:"integer",min:7,max:16}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/key_type",type:"object",required:["security"],properties:{security:{type:"object",required:["key"],properties:{key:{type:"object",required:["type"],properties:{type:{type:"array",default:["encryption"],items:{type:"string",enum:["ltk","irk","csrk"]}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/clear",type:"object",required:["clear"],properties:{clear:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display",basePath:"display",anyOf:[{$ref:"/request/display/text"},{$ref:"/request/display/clear"},{$ref:"/request/display/qr"},{$ref:"/request/display/raw"},{$ref:"/request/display/pin_assign"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/pin_assign",type:"object",required:["pin_assign"],properties:{pin_assign:{type:"object",minProperties:1,patternExample:[0,1,2,3],patternProperties:{"^[0-9]$":{type:"object",properties:{module_name:{type:"string"},pin_name:{type:"string"}}},"^1[0-1]$":{type:"object",properties:{module_name:{type:"string"},pin_name:{type:"string"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/qr",type:"object",required:["qr"],properties:{qr:{type:"object",required:["text"],additionalProperties:!1,properties:{text:{type:"string"},correction:{type:"string",enum:["L","M","Q","H"],default:"M"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/raw",type:"object",required:["raw"],properties:{raw:{$ref:"/imageData128x64"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/text",type:"object",required:["text"],properties:{text:{type:"string"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c",basePath:"i2c0",anyOf:[{$ref:"/request/i2c/init_master"},{$ref:"/request/i2c/init_slave"},{$ref:"/request/i2c/write"},{$ref:"/request/i2c/read"},{$ref:"/request/i2c/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/init_master",type:"object",required:["mode","sda","scl","clock"],uniqueKeys:["sda","scl"],properties:{mode:{type:"string",enum:["master"]},sda:{$ref:"/pinSetting"},scl:{$ref:"/pinSetting"},clock:{type:"integer",minimum:1,maximum:1e6}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/init_slave",related:"/response/i2c/slave",type:"object",required:["mode","sda","scl","slave_address"],uniqueKeys:["sda","scl"],properties:{mode:{type:"string",enum:["master","slave"]},sda:{$ref:"/pinSetting"},scl:{$ref:"/pinSetting"},slave_address:{type:"integer",minimum:0,maximum:1023},slave_address_length:{type:"integer",enum:[7],default:7},address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},data:{$ref:"/dataArray"},read:{type:"integer",minimum:0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/read",related:"/response/i2c/master",type:"object",required:["address","read"],properties:{address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},read:{type:"integer",minimum:0,maximum:1024}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/write",type:"object",required:["address","data"],properties:{address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},data:{$ref:"/dataArray1024"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request",type:"array",minItems:1,items:{type:"object",additionalProperties:!1,patternProperties:{"^io[0-9]$":{$ref:"/request/io"},"^io1[0-1]$":{$ref:"/request/io"},"^ad[0-9]$":{$ref:"/request/ad"},"^ad1[0-1]$":{$ref:"/request/ad"},"^pwm[0-5]$":{$ref:"/request/pwm"},"^uart[0-1]$":{$ref:"/request/uart"},"^spi[0-1]$":{$ref:"/request/spi"},"^i2c0$":{$ref:"/request/i2c"},"^tcp[0-7]$":{$ref:"/request/tcp"}},properties:{io:{$ref:"/request/ioAnimation"},ble:{$ref:"/request/ble"},switch:{$ref:"/request/switch"},display:{$ref:"/request/display"},measure:{$ref:"/request/measure"},message:{$ref:"/request/message"},logic_analyzer:{$ref:"/request/logicAnalyzer"},system:{$ref:"/request/system"},ws:{$ref:"/request/ws"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io",basePath:"io0",anyOf:[{$ref:"/request/io/input"},{$ref:"/request/io/input_detail"},{$ref:"/request/io/output"},{$ref:"/request/io/output_detail"},{$ref:"/request/io/output_type"},{$ref:"/request/io/pull_type"},{$ref:"/request/io/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/input",related:"/response/io/get",type:"string",enum:["get"]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/input_detail",related:"/response/io/get",type:"object",required:["direction"],properties:{direction:{type:"string",enum:["input"]},stream:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output",type:"boolean"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output_detail",type:"object",required:["direction","value"],properties:{direction:{type:"string",enum:["output"]},value:{type:"boolean"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output_type",type:"object",required:["output_type"],properties:{output_type:{type:"string",enum:["push-pull5v","push-pull3v","open-drain"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/pull_type",type:"object",required:["pull_type"],properties:{pull_type:{type:"string",enum:["pull-up5v","pull-up3v","pull-down","float"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation/changeState",type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status"],additionalProperties:!1,properties:{name:{type:"string",minLength:1,maxLength:254},status:{type:"string",enum:["pause","resume"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation",basePath:"io",anyOf:[{$ref:"/request/ioAnimation/init"},{$ref:"/request/ioAnimation/changeState"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation/init",commandExample:{io:{animation:{name:"animation-1",status:"loop",states:[{duration:500,state:{io0:!0}},{duration:500,state:{io0:!1}}]}}},type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status","states"],additionalProperties:!1,properties:{name:{type:"string",minLength:1,maxLength:254},repeat:{type:"integer",minLength:1,maxLength:4294967295,default:"undefined"},status:{type:"string",default:"loop",enum:["loop","registrate"]},states:{type:"array",default:[],items:{type:"object",required:["duration","state"],additionalProperties:!1,properties:{duration:{type:"integer",minimum:0,maximum:6e4},state:{type:["object","array"],filter:"pass_all"}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer",basePath:"logic_analyzer",anyOf:[{$ref:"/request/logicAnalyzer/init"},{$ref:"/request/logicAnalyzer/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer/init",exampleDescription:"With below sample code, you will receive only data which start with 'false, false, false' 3bit.",type:"object",required:["io","interval","duration"],properties:{io:{type:"array",minItems:1,maxItems:1,items:{$ref:"/pinSetting"}},interval:{type:"number",minimum:0,exclusiveMinimum:!0},duration:{type:"integer",minimum:0,exclusiveMinimum:!0},trigger:{type:"object",additionalProperties:!1,required:["value","samples"],default:{value:!1,samples:0},properties:{value:{type:"boolean",default:!1},samples:{type:"integer",minimum:0,default:0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/measure/echo",related:"/response/measure/echo",type:"object",required:["echo"],properties:{echo:{type:"object",required:["io_pulse","io_echo","pulse_width"],properties:{io_pulse:{$ref:"/pinSetting"},io_echo:{$ref:"/pinSetting"},pulse:{type:"string",default:"positive",enum:["positive","negative"]},pulse_width:{type:"number",minimum:.001,maximum:1e3},measure_edges:{type:"integer",minimum:1,maximum:4},timeout:{type:"number",default:1e3,minimum:.001,maximum:1e3}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/measure",basePath:"measure",anyOf:[{$ref:"/request/measure/echo"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/message",basePath:"message",anyOf:[{$ref:"/request/message/send"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/message/send",related:"/response/message/receive",type:"object",additionalProperties:!1,required:["data","to"],properties:{data:{},to:{type:"array",minItems:1,items:{$ref:"/obnizId"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/freq",type:"object",required:["freq"],properties:{freq:{type:"integer",minimum:1,maximum:8e7}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm",basePath:"pwm0",anyOf:[{$ref:"/request/pwm/init"},{$ref:"/request/pwm/freq"},{$ref:"/request/pwm/pulse"},{$ref:"/request/pwm/modulate"},{$ref:"/request/pwm/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/init",type:"object",required:["io"],properties:{io:{$ref:"/pinSetting"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/modulate",type:"object",required:["modulate"],properties:{modulate:{type:"object",required:["type","symbol_length","data"],additionalProperties:!1,properties:{type:{type:"string",enum:["am"]},symbol_length:{type:"number",minimum:.05,maximum:1e3},data:{$ref:"/bitArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/pulse",type:"object",required:["pulse"],properties:{pulse:{type:"number",minimum:0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi",basePath:"spi0",anyOf:[{$ref:"/request/spi/init_master"},{$ref:"/request/spi/deinit"},{$ref:"/request/spi/write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/init_master",type:"object",required:["mode","clock"],uniqueKeys:["mosi","miso","clk"],properties:{mode:{type:"string",enum:["master"]},clk:{$ref:"/pinSetting"},mosi:{$ref:"/pinSetting"},miso:{$ref:"/pinSetting"},clock:{type:"integer",default:115200,minimum:1,maximum:26e6,desription:"frequency (Hz)"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/write",related:"/response/spi/read",type:"object",required:["data","read"],properties:{data:{$ref:"/dataArray1024"},read:{type:"boolean",default:!0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/switch/get",related:"/response/switch/change",type:"string",enum:["get"]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/switch",basePath:"switch",anyOf:[{$ref:"/request/switch/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system",basePath:"system",anyOf:[{$ref:"/request/system/wait"},{$ref:"/request/system/reset"},{$ref:"/request/system/reboot"},{$ref:"/request/system/selfCheck"},{$ref:"/request/system/keepWorkingAtOffline"},{$ref:"/request/system/ping"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/keepWorkingAtOffline",type:"object",required:["keep_working_at_offline"],properties:{keep_working_at_offline:{type:"boolean"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/ping",response:"/response/system/pong",type:"object",required:["ping"],properties:{ping:{type:"object",required:["key"],properties:{key:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/reboot",type:"object",required:["reboot"],properties:{reboot:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/reset",type:"object",required:["reset"],properties:{reset:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/selfCheck",type:"object",required:["self_check"],properties:{self_check:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/wait",type:"object",required:["wait"],properties:{wait:{type:"integer"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/connect",type:"object",required:["connect"],properties:{connect:{type:"object",required:["port","domain"],additionalProperties:!1,properties:{port:{type:"integer",minimum:0,maximum:65535},domain:{type:"string",default:"obniz.io",maxLength:30}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/disconnect",type:"object",required:["disconnect"],properties:{disconnect:{type:"boolean",additionalProperties:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp",basePath:"tcp0",anyOf:[{$ref:"/request/tcp/connect"},{$ref:"/request/tcp/disconnect"},{$ref:"/request/tcp/write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/write",type:"object",required:["write"],properties:{write:{type:"object",required:["data"],additionalProperties:!1,properties:{data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart",basePath:"uart0",anyOf:[{$ref:"/request/uart/init"},{$ref:"/request/uart/send"},{$ref:"/request/uart/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/init",type:"object",required:["rx","tx"],uniqueKeys:["rx","tx","rts","cts"],properties:{rx:{$ref:"/pinSetting"},tx:{$ref:"/pinSetting"},baud:{type:"integer",default:115200,minimum:1,maximum:5e6},stop:{type:"number",enum:[1,1.5,2],default:1},bits:{type:"integer",enum:[5,6,7,8],default:8},parity:{type:"string",enum:["off","odd","even"],default:"off"},flowcontrol:{type:"string",enum:["off","rts","cts","rts-cts"],default:"off"},rts:{$ref:"/pinSetting"},cts:{$ref:"/pinSetting"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/send",type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ws",basePath:"ws",anyOf:[{$ref:"/request/ws/reset_obniz_on_ws_disconnection"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ws/reset_obniz_on_ws_disconnection",type:"object",required:["reset_obniz_on_ws_disconnection"],properties:{reset_obniz_on_ws_disconnection:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ad/get",type:"number",minimum:0,maximum:5}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ad",basePath:"ad0",anyOf:[{$ref:"/response/ad/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_get",type:"object",required:["get_characteristic_result"],properties:{get_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","properties"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},properties:{type:"array",items:{type:"string",enum:["broadcast","read","write_without_response","write","notify","indicate","auth","extended_properties"]}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_get_finish",type:"object",required:["get_characteristic_result_finish"],properties:{get_characteristic_result_finish:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_notify",type:"object",required:["nofity_characteristic"],properties:{nofity_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_read",type:"object",required:["read_characteristic_result"],properties:{read_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_register_notify",related:"/request/ble/central/characteristic_register_notify",type:"object",required:["characteristic_register_notify_result"],properties:{characteristic_register_notify_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"boolean"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_unregister_notify",related:"/request/ble/central/characteristic_unregister_notify",type:"object",required:["unregister_notify_characteristic_result"],properties:{unregister_notify_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"boolean"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_write",type:"object",required:["write_characteristic_result"],properties:{write_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_get",type:"object",required:["get_descriptor_result"],properties:{get_descriptor_result:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_get_finish",type:"object",required:["get_descriptor_result_finish"],properties:{get_descriptor_result_finish:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_read",type:"object",required:["read_descriptor_result"],properties:{read_descriptor_results:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","result","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_write",type:"object",required:["write_descriptor_result"],properties:{write_descriptor_results:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/error",type:"object",required:["error"],properties:{error:{type:"object",required:["error_code","message"],additionalProperties:!1,properties:{error_code:{type:"integer"},module_error_code:{type:"integer"},function_code:{type:"integer"},message:{type:"string"},address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuidOrNull"},characteristic_uuid:{$ref:"/uuidOrNull"},descriptor_uuid:{$ref:"/uuidOrNull"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central",basePath:"ble",anyOf:[{$ref:"/response/ble/central/scan"},{$ref:"/response/ble/central/scan_finish"},{$ref:"/response/ble/central/status_update"},{$ref:"/response/ble/central/service_get"},{$ref:"/response/ble/central/service_get_finish"},{$ref:"/response/ble/central/characteristic_get"},{$ref:"/response/ble/central/characteristic_get_finish"},{$ref:"/response/ble/central/characteristic_write"},{$ref:"/response/ble/central/characteristic_read"},{$ref:"/response/ble/central/characteristic_register_notify"},{$ref:"/response/ble/central/characteristic_notify"},{$ref:"/response/ble/central/characteristic_notify"},{$ref:"/response/ble/central/descriptor_get"},{$ref:"/response/ble/central/descriptor_get_finish"},{$ref:"/response/ble/central/descriptor_write"},{$ref:"/response/ble/central/descriptor_read"},{$ref:"/response/ble/central/error"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/scan",type:"object",required:["scan_result"],properties:{scan_result:{type:"object",required:["address","ble_event_type","device_type","address_type","flag","rssi"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},ble_event_type:{type:"string",enum:["connectable_advertisemnt","connectable_directed_advertisemnt","scannable_advertising","non_connectable_advertising","scan_response"]},device_type:{type:"string",enum:["ble","dumo","breder"]},address_type:{type:"string",enum:["public","random","rpa_public","rpa_random"]},flag:{type:"integer",minimum:0},rssi:{type:"integer",maximum:0},adv_data:{$ref:"/bleAdvertiseData"},scan_resp:{$ref:"/bleAdvertiseData"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/scan_finish",type:"object",required:["scan_result_finish"],properties:{scan_result_finish:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/service_get",type:"object",required:["get_service_result"],properties:{get_service_result:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/service_get_finish",type:"object",required:["get_service_result_finish"],properties:{get_service_result_finish:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/status_update",type:"object",required:["status_update"],properties:{status_update:{type:"object",required:["address","status"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},status:{type:"string",enum:["connected","disconnected"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble",basePath:"ble",anyOf:[{$ref:"/response/ble/central"},{$ref:"/response/ble/peripheral"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_notify_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_read_characteristic"],properties:{notify_read_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_notify_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_write_characteristic"],properties:{notify_write_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["read_characteristic_result"],properties:{read_characteristic_result:{type:"object",required:["service_uuid","characteristic_uuid","data","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["write_characteristic_result"],properties:{write_characteristic_result:{type:"object",required:["service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_notify_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_read_descriptor"],properties:{notify_read_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_notify_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_write_descriptor"],properties:{notify_write_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_read",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["read_descriptor_result"],properties:{read_descriptor_result:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","data","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_write",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["write_descriptor_result"],properties:{write_descriptor_result:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral",basePath:"ble",anyOf:[{$ref:"/response/ble/peripheral/status"},{$ref:"/response/ble/peripheral/characteristic_read"},{$ref:"/response/ble/peripheral/characteristic_write"},{$ref:"/response/ble/peripheral/characteristic_notify_read"},{$ref:"/response/ble/peripheral/characteristic_notify_write"},{$ref:"/response/ble/peripheral/descriptor_read"},{$ref:"/response/ble/peripheral/descriptor_write"},{$ref:"/response/ble/peripheral/descriptor_notify_read"},{$ref:"/response/ble/peripheral/descriptor_notify_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/status",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["connection_status"],properties:{connection_status:{type:"object",required:["address","status"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},status:{type:"string",enum:["connected","disconnected"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug/error",desccription:"global error",type:"object",required:["error"],properties:{error:{type:"object",additionalProperties:!0,properties:{message:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug",basePath:"debug",anyOf:[{$ref:"/response/debug/warning"},{$ref:"/response/debug/error"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug/warning",desccription:"global warnings",type:"object",required:["warning"],properties:{warning:{type:"object",additionalProperties:!0,properties:{message:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c",basePath:"i2c0",anyOf:[{$ref:"/response/i2c/master"},{$ref:"/response/i2c/slave"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c/master",type:"object",required:["mode","address","data"],properties:{mode:{type:"string",enum:["master"]},address:{type:"integer",minimum:0,maximum:1023},data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c/slave",type:"object",required:["mode","address","is_fragmented","data"],properties:{mode:{type:"string",enum:["slave"]},address:{type:"integer",minimum:0,maximum:1023},is_fragmented:{type:"boolean"},data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response",type:"array",minItems:1,items:{type:"object",additionalProperties:!1,patternProperties:{"^io[0-9]$":{$ref:"/response/io"},"^io1[0-1]$":{$ref:"/response/io"},"^ad[0-9]$":{$ref:"/response/ad"},"^ad1[0-1]$":{$ref:"/response/ad"},"^uart[0-1]$":{$ref:"/response/uart"},"^spi[0-1]$":{$ref:"/response/spi"},"^i2c0$":{$ref:"/response/i2c"},"^tcp[0-7]$":{$ref:"/response/tcp"}},properties:{io:{$ref:"/response/ioAnimation"},switch:{$ref:"/response/switch"},ble:{$ref:"/response/ble"},measure:{$ref:"/response/measure"},message:{$ref:"/response/message"},logic_analyzer:{$ref:"/response/logicAnalyzer"},system:{$ref:"/response/system"},debug:{$ref:"/response/debug"},ws:{$ref:"/response/ws"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/io/get",type:"boolean"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/io",basePath:"io0",anyOf:[{$ref:"/response/io/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ioAnimation",basePath:"io",anyOf:[{$ref:"/response/ioAnimation/notify"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ioAnimation/notify",type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status"],properties:{name:{type:"string",minLength:1,maxLength:254},status:{type:"string",enum:["finish"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/logicAnalyzer/data",type:"object",required:["data"],properties:{data:{$ref:"/bitArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/logicAnalyzer",basePath:"logic_analyzer",anyOf:[{$ref:"/response/logicAnalyzer/data"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/measure/echo",type:"object",required:["echo"],properties:{echo:{type:"array",minItesm:1,items:{type:"object",required:["edge","timing"],properties:{edge:{type:"boolean"},timing:{type:"number"}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/measure",basePath:"measure",anyOf:[{$ref:"/response/measure/echo"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/message",basePath:"message",anyOf:[{$ref:"/response/message/receive"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/message/receive",related:"/request/message/send",type:"object",required:["data","from"],properties:{data:{},from:{type:["string","null"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/spi",basePath:"spi0",anyOf:[{$ref:"/response/spi/read"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/spi/read",type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/switch/change",desccription:"value changes are always notified.",type:"object",required:["state"],properties:{state:{type:"string",enum:["none","push","left","right"]},action:{type:"string",enum:["get"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/switch",basePath:"switch",anyOf:[{$ref:"/response/switch/change"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/system",basePath:"system",anyOf:[{$ref:"/response/system/pong"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/system/pong",desccription:"pong response with same key of ping request",type:"object",required:["pong"],properties:{pong:{type:"object",required:["key"],properties:{key:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/tcp",basePath:"tcp0",anyOf:[{$ref:"/response/tcp/read"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/tcp/read",desccription:"value changes are always notified.",type:"object",required:["read"],properties:{read:{type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/uart",basePath:"uart0",anyOf:[{$ref:"/response/uart/receive"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/uart/receive",type:"object",properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws",basePath:"ws",anyOf:[{$ref:"/response/ws/ready"},{$ref:"/response/ws/obniz"},{$ref:"/response/ws/redirect"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/obniz",type:"object",required:["obniz"],properties:{obniz:{type:"object",required:["hw","firmware"],additionalProperties:!1,properties:{hw:{type:"string"},firmware:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/ready",type:"object",required:["ready"],properties:{ready:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/redirect",type:"object",required:["redirect"],properties:{redirect:{type:"string"}}}},function(e,t,i){(function(t){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=0,this._CommandReboot=0,this._CommandReset=2,this._CommandSelfCheck=3,this._CommandWait=4,this._CommandResetOnDisconnect=5,this._CommandPingPong=8,this._CommandVCC=9}reboot(e){this.sendCommand(this._CommandReboot,null)}reset(e){this.sendCommand(this._CommandReset,null)}selfCheck(e){this.sendCommand(this._CommandSelfCheck,null)}wait(e){let t=e.wait,i=new Uint8Array([t>>8,t]);this.sendCommand(this._CommandWait,i)}keepWorkingAtOffline(e){this.resetOnDisconnect(!e.keep_working_at_offline)}ping(e){let t=(new Date).getTime(),i=new Uint8Array(e.ping.key.length+8),r=Math.floor(t/Math.pow(2,32)),s=t-r*Math.pow(2,32);i[0]=r>>24,i[1]=r>>16,i[2]=r>>8,i[3]=r>>0,i[4]=s>>24,i[5]=s>>16,i[6]=s>>8,i[7]=s>>0;for(let t=0;t<e.ping.key.length;t++)i[8+t]=e.ping.key[t];this.sendCommand(this._CommandPingPong,i)}resetOnDisconnect(e){let t=new Uint8Array([e?1:0]);this.sendCommand(this._CommandResetOnDisconnect,t)}parseFromJson(e){let t=e.system;if(void 0===t)return;let i=[{uri:"/request/system/reboot",onValid:this.reboot},{uri:"/request/system/reset",onValid:this.reset},{uri:"/request/system/wait",onValid:this.wait},{uri:"/request/system/selfCheck",onValid:this.selfCheck},{uri:"/request/system/keepWorkingAtOffline",onValid:this.keepWorkingAtOffline},{uri:"/request/system/ping",onValid:this.ping}],r=this.validateCommandSchema(i,t,"system");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[system]unknown command")}pong(e,i){e.system=e.system||{};const r=(new Date).getTime();if(i.length>=16){let s=(i=t.from(i)).readUIntBE(0,4)*Math.pow(2,32)+i.readUIntBE(4,4),n=i.readUIntBE(8,4)*Math.pow(2,32)+i.readUIntBE(12,4),a=[];for(let e=16;e<i.length;e++)a.push(i[e]);e.system.pong={key:a,obnizTime:s,pingServerTime:n,pongServerTime:r}}else e.system.pong={pongServerTime:r}}notifyFromBinary(e,t,i){switch(t){case this._CommandVCC:if(3===i.byteLength){let t=(i[1]<<8)+i[2];t/=100,this.envelopWarning(e,"debug",{message:`Low Voltage ${t}v. connect obniz to more powerful USB.`})}break;case this._CommandPingPong:this.pong(e,i);break;default:super.notifyFromBinary(e,t,i)}}}}).call(this,i(1).Buffer)},function(e,t,i){const r=i(0),s=i(3),n=i(6);e.exports=class extends r{constructor(){super(),this.module=1,this._CommandRegistrate=0,this._CommandPause=1,this._CommandResume=2,this._CommandNotify=3;const e=i(17),t=i(18);this.availableCommands=[new e,new t]}init(e,t){const i=s.string2dataArray(e.animation.name);let a,o=0;if(n.lt(this._hw.firmware,"2.0.0")){if((a=new Uint8Array(1+i.length+1))[o++]=i.length+1,a.set(i,o),o+=i.length,a[o++]=0,"registrate"===e.animation.status||"number"==typeof e.animation.repeat)throw new Error("you need to update your firmware >= 2.0.0")}else{(a=new Uint8Array(1+i.length+1+1+4))[o++]=i.length+1,a.set(i,o),o+=i.length,a[o++]=0;let t=0,r=0;"loop"===e.animation.status&&(t=1),"number"==typeof e.animation.repeat&&(r=e.animation.repeat,t+=2),a[o++]=t,a[o++]=r>>24,a[o++]=r>>16,a[o++]=r>>8,a[o++]=r}const h=e.animation.states;for(let e=0;e<h.length;e++){const t=h[e],i=parseInt(1e3*t.duration),s=t.state;let n=JSON.parse(JSON.stringify(s));Array.isArray(n)||(n=[n]);let o=null;for(let e=0;e<n.length;e++){const t=r.compress(this.availableCommands,n[e]);if(!t)throw new Error("[io.animation.states.state]only io or pwm commands. Pleave provide state at least one of them.");if(o){let e=new Uint8Array(o.length+t.length);e.set(o,0),e.set(t,o.length),o=e}else o=t}if(!o)throw new Error("[io.animation.states.state]only io or pwm commands. Pleave provide state at least one of them.");const c=o.byteLength;let d=new Uint8Array(8);d[0]=c>>24,d[1]=c>>16,d[2]=c>>8,d[3]=c,d[4]=i>>24,d[5]=i>>16,d[6]=i>>8,d[7]=i;const u=new Uint8Array(a.byteLength+d.byteLength+o.byteLength);u.set(a,0),u.set(d,a.byteLength),u.set(o,a.byteLength+d.byteLength),a=u}if(a.byteLength>1e3)throw new Error("[io.animation]Too big animation datas");this.sendCommand(this._CommandRegistrate,a)}changeState(e){if("resume"===e.animation.status){const t=s.string2dataArray(e.animation.name);let i=new Uint8Array(t.length+2);i[0]=t.length+1,i.set(t,1),i[i.byteLength-1]=0,this.sendCommand(this._CommandResume,i)}else if("pause"===e.animation.status){const t=s.string2dataArray(e.animation.name);let i=new Uint8Array(t.length+2);i[0]=t.length+1,i.set(t,1),i[i.byteLength-1]=0,this.sendCommand(this._CommandPause,i)}}parseFromJson(e){let t=!1;try{super.parseFromJson(e)}catch(e){if(!(e instanceof this.WSCommandNotFoundError))throw e;t=!0}const i=e.io;if(void 0===i)return;const r=[{uri:"/request/ioAnimation/init",onValid:this.init},{uri:"/request/ioAnimation/changeState",onValid:this.changeState}],s=this.validateCommandSchema(r,i,"io",i);if(0===s.valid&&t){if(s.invalidButLike.length>0)throw new Error(s.invalidButLike[0].message);throw new(0,this.WSCommandNotFoundError)("[io.animation]unknown command")}}notifyFromBinary(e,t,i){if(t===this._CommandNotify){const t=s.dataArray2string(i.slice(2,i.byteLength-1));e.io={animation:{name:t,status:"finish"}}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=4,this._CommandInit=0,this._CommandDeinit=1,this._CommandSend=2,this._CommandRecv=3}init(e,t){let i=new Uint8Array(13);if(i[0]=t,i[1]=parseInt(e.tx),i[2]=parseInt(e.rx),i[3]=e.baud>>24,i[4]=e.baud>>16,i[5]=e.baud>>8,i[6]=e.baud,1===e.stop)i[7]=1;else if(1.5===e.stop)i[7]=2;else if(2===e.stop)i[7]=3;else{if(0!==e.stop)throw new Error("uart: invalid stop bits");i[7]=0}i[8]=e.bits,"even"===e.parity?i[9]=2:"odd"===e.parity&&(i[9]=3),"rts"===e.flowcontrol?i[10]=2:"cts"===e.flowcontrol?i[10]=3:"rts-cts"===e.flowcontrol&&(i[10]=4),null!==e.rts&&(i[11]=e.rts),null!==e.cts&&(i[12]=e.cts),this.sendCommand(this._CommandInit,i)}deinit(e,t){let i=new Uint8Array(1);i[0]=t,this.sendCommand(this._CommandDeinit,i)}send(e,t){let i=new Uint8Array(1+e.data.length);i[0]=t,i.set(e.data,1),this.sendCommand(this._CommandSend,i)}parseFromJson(e){for(let t=0;t<3;t++){let i=e["uart"+t];if(void 0===i)continue;let r=[{uri:"/request/uart/init",onValid:this.init},{uri:"/request/uart/send",onValid:this.send},{uri:"/request/uart/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"uart"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[uart${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandRecv&&i.byteLength>1){let t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["uart"+t]={data:r}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=7,this._CommandInitNormalInterval=0,this._CommandDeinit=1,this._CommandNotifyValue=2,this._CommandDoOnece=3}get(e,t){let i=new Uint8Array([t]);this.sendCommand(e.stream?this._CommandInitNormalInterval:this._CommandDoOnece,i)}deinit(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}parseFromJson(e){for(let t=0;t<40;t++){let i=e["ad"+t];if(void 0===i)continue;let r=[{uri:"/request/ad/deinit",onValid:this.deinit},{uri:"/request/ad/get",onValid:this.get}],s=this.validateCommandSchema(r,i,"ad"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[ad${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandNotifyValue)for(let t=0;t+2<i.byteLength;t+=3){let r;128&i[t+1]?(r=5*(r=((3&i[t+1])<<8)+i[t+2])/1023,r=Math.round(1e3*r)/1e3):64&i[t+1]?(r=3.3*(r=((15&i[t+1])<<8)+i[t+2])/4095,r=Math.round(1e3*r)/1e3):(r=(i[t+1]<<8)+i[t+2],r/=100),e["ad"+i[t]]=r}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=5,this._CommandInit=0,this._CommandDeinit=1,this._CommandWriteRead=2,this._CommandWrite=3}initMaster(e,t){let i=e.clk,r=e.mosi,s=e.miso,n=e.cs,a=e.clock;if(null===i&&null===r&&null===s)throw new Error("spi: master mode require one of clk/mosi/miso");null===i&&(i=this.ioNotUsed),null===r&&(r=this.ioNotUsed),null===s&&(s=this.ioNotUsed),null===n&&(n=this.ioNotUsed);let o=new Uint8Array(11);o[0]=t,o[1]=0,o[2]=i,o[3]=r,o[4]=s,o[5]=this.ioNotUsed,o[6]=this.ioNotUsed,o[7]=a>>24,o[8]=a>>16,o[9]=a>>8,o[10]=a,o[11]=n,this.sendCommand(this._CommandInit,o)}deinit(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}write(e,t){let i=new Uint8Array(1+e.data.length);i[0]=t,i.set(e.data,1),e.read?this.sendCommand(this._CommandWriteRead,i):this.sendCommand(this._CommandWrite,i)}parseFromJson(e){for(let t=0;t<2;t++){let i=e["spi"+t];if(void 0===i)continue;let r=[{uri:"/request/spi/init_master",onValid:this.initMaster},{uri:"/request/spi/write",onValid:this.write},{uri:"/request/spi/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"spi"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[spi${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandWriteRead&&i.byteLength>1){let t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["spi"+t]={data:r}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=6,this._CommandInit=0,this._CommandDeinit=1,this._CommandWrite=2,this._CommandRead=3,this._CommandSlvWritten=4}initMaster(e,t){let i=parseInt(e.sda),r=parseInt(e.scl),s=parseInt(e.clock),n=new Uint8Array(8);n[0]=t,n[1]=0,n[2]=i,n[3]=r,n[4]=s>>24,n[5]=s>>16,n[6]=s>>8,n[7]=s,this.sendCommand(this._CommandInit,n)}initSlave(e,t){let i=parseInt(e.sda),r=parseInt(e.scl),s=e.slave_address_length,n=e.slave_address;n>127&&(s=10);let a=new Uint8Array(11);a[0]=t,a[1]=1,a[2]=i,a[3]=r,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=s,a[9]=n>>8,a[10]=n,this.sendCommand(this._CommandInit,a)}deinit(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}write(e,t){let i=parseInt(e.address);(10===e.address_bits||i>127)&&(i|=32768);let r=new Uint8Array(3+e.data.length);r[0]=t,r[1]=i>>8,r[2]=i,r.set(e.data,3),this.sendCommand(this._CommandWrite,r)}read(e,t){let i=parseInt(e.address);(10===e.address_bits||i>127)&&(i|=32768);let r=e.read,s=new Uint8Array(7);s[0]=t,s[1]=i>>8,s[2]=i,s[3]=r>>24,s[4]=r>>16,s[5]=r>>8,s[6]=r,this.sendCommand(this._CommandRead,s)}parseFromJson(e){for(let t=0;t<1;t++){let i=e["i2c"+t];if(void 0===i)continue;let r=[{uri:"/request/i2c/init_master",onValid:this.initMaster},{uri:"/request/i2c/init_slave",onValid:this.initSlave},{uri:"/request/i2c/write",onValid:this.write},{uri:"/request/i2c/read",onValid:this.read},{uri:"/request/i2c/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"i2c"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[i2c${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandRead&&i.byteLength>3){let t=i[0],r=(i[1]<<8)+i[2],s=new Array(i.byteLength-3);for(let e=0;e<s.length;e++)s[e]=i[e+3];e["i2c"+t]={mode:"master",address:r,data:s}}else if(t===this._CommandSlvWritten&&i.byteLength>4){let t=i[0],r=(i[2]<<8)+i[3],s=new Array(i.byteLength-4);for(let e=0;e<s.length;e++)s[e]=i[e+4];e["i2c"+t]={mode:"slave",is_fragmented:!0,address:r,data:s}}else if(t===this.COMMAND_FUNC_ID_ERROR&&i.byteLength>2){const r=i[1],s=i[2];if(s===this._CommandWrite||s===this._CommandRead){let t=(s===this._CommandWrite?"writing":"reading")+" error. ";7===r?t+="Communication Timeout. Maybe, target is not connected.":255===r&&(t+="Communication Failed. Maybe, target is not connected."),this.envelopError(e,"i2c0",{message:t})}else super.notifyFromBinary(e,t,i)}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=10,this._CommandInit=0,this._CommandDeinit=1,this._CommandRecv=2}init(e){let t=e.io[0],i=1e3*e.interval,r=1e3*e.duration,s=parseInt(e.trigger.value),n=e.trigger.samples,a=new Uint8Array(12);a[0]=1,a[1]=t,a[2]=i>>24,a[3]=i>>16,a[4]=i>>8,a[5]=i,a[6]=r>>24,a[7]=r>>16,a[8]=r>>8,a[9]=r,a[10]=s,a[11]=n,this.sendCommand(this._CommandInit,a)}deinit(e){let t=new Uint8Array(0);this.sendCommand(this._CommandDeinit,t)}parseFromJson(e){let t=e.logic_analyzer;if(void 0===t)return;let i=[{uri:"/request/logicAnalyzer/init",onValid:this.init},{uri:"/request/logicAnalyzer/deinit",onValid:this.deinit}],r=this.validateCommandSchema(i,t,"logic_analyzer");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[logic_analyzer]unknown command")}notifyFromBinary(e,t,i){if(t===this._CommandRecv){let t=new Array(8*i.byteLength),r=0;for(let e=0;e<i.byteLength;e++){const s=i[e];for(let e=0;e<8;e++)t[r]=s&128>>>e?1:0,r++}e.logic_analyzer={data:t}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){(function(t){const r=i(0),s=i(226);e.exports=class extends r{constructor(){super(),this.module=8,this._CommandClear=0,this._CommandPrint=1,this._CommandDrawCampusVerticalBytes=2,this._CommandDrawCampusHorizonalBytes=3,this._CommandDrawIOState=4,this._CommandSetPinName=5}clear(e){this.sendCommand(this._CommandClear,null)}print(e){this.sendCommand(this._CommandPrint,e)}printText(e){let i;const r=t.from(e,"utf8");i=new Uint8Array(r),this.print(i)}text(e){this.printText(e.text)}raw(e){this.drawHorizonally(new Uint8Array(e.raw))}qr(e){const t=e.qr.text,i=e.qr.correction||"M",r=s(0,i);r.addData(t),r.make();let n=r.getModuleCount();if(n){n*=2;const e=r.getModules();let t=new Uint8Array(1024);t.fill(0);for(let e=0;e<2;e++)for(let i=0;i<n+4;i++)t[parseInt(16*e+i/8)]|=128>>i%8,t[parseInt(16*(e+n+2)+i/8)]|=128>>i%8;for(let e=2;e<n+2;e++){for(let i=0;i<2;i++)t[parseInt(16*e+i/8)]|=128>>i%8;for(let i=n+2;i<n+4;i++)t[parseInt(16*e+i/8)]|=128>>i%8}for(let i=0;i<n;i++)for(let r=0;r<n;r++)e[parseInt(i/2)][parseInt(r/2)]||(t[parseInt(16*(i+2)+(r+2)/8)]|=128>>(r+2)%8);this.drawHorizonally(t)}}pinName(e){for(let t=0;t<12;t++)"object"==typeof e.pin_assign[t]&&this.setPinName(t,e.pin_assign[t].module_name||"?",e.pin_assign[t].pin_name||"?")}drawVertically(e){this.sendCommand(this._CommandDrawCampusVerticalBytes,e)}drawHorizonally(e){this.sendCommand(this._CommandDrawCampusHorizonalBytes,e)}drawIOState(e){let t=new Uint8Array([!e]);this.sendCommand(this._CommandDrawIOState,t)}setPinName(e,i,r){let s=i.slice(0,4)+" "+r;s=s.slice(0,9);let n=new Uint8Array(1);n[0]=e;let a=new Uint8Array(t(s,"utf8")),o=new Uint8Array(n.length+a.length);o.set(n,0),o.set(a,1),this.sendCommand(this._CommandSetPinName,o)}parseFromJson(e){let t=e.display;if(void 0===t)return;let i=[{uri:"/request/display/clear",onValid:this.clear},{uri:"/request/display/text",onValid:this.text},{uri:"/request/display/raw",onValid:this.raw},{uri:"/request/display/pin_assign",onValid:this.pinName},{uri:"/request/display/qr",onValid:this.qr}],r=this.validateCommandSchema(i,t,"display");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[display]unknown command")}}}).call(this,i(1).Buffer)},function(e,t){var i=function(){var e=function(e,t){var i=e,r=h[t],s=null,n=0,a=null,o=[],c={},d=function(e,t){s=function(e){for(var t=new Array(e),i=0;i<e;i+=1){t[i]=new Array(e);for(var r=0;r<e;r+=1)t[i][r]=null}return t}(n=4*i+17),u(0,0),u(n-7,0),u(0,n-7),p(),l(),f(e,t),i>=7&&m(e),null==a&&(a=_(i,r,o)),g(a,t)},u=function(e,t){for(var i=-1;i<=7;i+=1)if(!(e+i<=-1||n<=e+i))for(var r=-1;r<=7;r+=1)t+r<=-1||n<=t+r||(s[e+i][t+r]=0<=i&&i<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=r&&r<=4)},l=function(){for(var e=8;e<n-8;e+=1)null==s[e][6]&&(s[e][6]=e%2==0);for(var t=8;t<n-8;t+=1)null==s[6][t]&&(s[6][t]=t%2==0)},p=function(){for(var e=y.getPatternPosition(i),t=0;t<e.length;t+=1)for(var r=0;r<e.length;r+=1){var n=e[t],a=e[r];if(null==s[n][a])for(var o=-2;o<=2;o+=1)for(var h=-2;h<=2;h+=1)s[n+o][a+h]=-2==o||2==o||-2==h||2==h||0==o&&0==h}},m=function(e){for(var t=y.getBCHTypeNumber(i),r=0;r<18;r+=1){var a=!e&&1==(t>>r&1);s[Math.floor(r/3)][r%3+n-8-3]=a}for(r=0;r<18;r+=1){a=!e&&1==(t>>r&1);s[r%3+n-8-3][Math.floor(r/3)]=a}},f=function(e,t){for(var i=r<<3|t,a=y.getBCHTypeInfo(i),o=0;o<15;o+=1){var h=!e&&1==(a>>o&1);o<6?s[o][8]=h:o<8?s[o+1][8]=h:s[n-15+o][8]=h}for(o=0;o<15;o+=1){h=!e&&1==(a>>o&1);o<8?s[8][n-o-1]=h:o<9?s[8][15-o-1+1]=h:s[8][15-o-1]=h}s[n-8][8]=!e},g=function(e,t){for(var i=-1,r=n-1,a=7,o=0,h=y.getMaskFunction(t),c=n-1;c>0;c-=2)for(6==c&&(c-=1);;){for(var d=0;d<2;d+=1)if(null==s[r][c-d]){var u=!1;o<e.length&&(u=1==(e[o]>>>a&1)),h(r,c-d)&&(u=!u),s[r][c-d]=u,-1==(a-=1)&&(o+=1,a=7)}if((r+=i)<0||n<=r){r-=i,i=-i;break}}},_=function(e,t,i){for(var r=v.getRSBlocks(e,t),s=b(),n=0;n<i.length;n+=1){var a=i[n];s.put(a.getMode(),4),s.put(a.getLength(),y.getLengthInBits(a.getMode(),e)),a.write(s)}var o=0;for(n=0;n<r.length;n+=1)o+=r[n].dataCount;if(s.getLengthInBits()>8*o)throw"code length overflow. ("+s.getLengthInBits()+">"+8*o+")";for(s.getLengthInBits()+4<=8*o&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*o||(s.put(236,8),s.getLengthInBits()>=8*o));)s.put(17,8);return function(e,t){for(var i=0,r=0,s=0,n=new Array(t.length),a=new Array(t.length),o=0;o<t.length;o+=1){var h=t[o].dataCount,c=t[o].totalCount-h;r=Math.max(r,h),s=Math.max(s,c),n[o]=new Array(h);for(var d=0;d<n[o].length;d+=1)n[o][d]=255&e.getBuffer()[d+i];i+=h;var u=y.getErrorCorrectPolynomial(c),l=w(n[o],u.getLength()-1).mod(u);a[o]=new Array(u.getLength()-1);for(d=0;d<a[o].length;d+=1){var p=d+l.getLength()-a[o].length;a[o][d]=p>=0?l.getAt(p):0}}var m=0;for(d=0;d<t.length;d+=1)m+=t[d].totalCount;var f=new Array(m),g=0;for(d=0;d<r;d+=1)for(o=0;o<t.length;o+=1)d<n[o].length&&(f[g]=n[o][d],g+=1);for(d=0;d<s;d+=1)for(o=0;o<t.length;o+=1)d<a[o].length&&(f[g]=a[o][d],g+=1);return f}(s,r)};return c.addData=function(e,t){var i=null;switch(t=t||"Byte"){case"Numeric":i=C(e);break;case"Alphanumeric":i=x(e);break;case"Byte":i=S(e);break;case"Kanji":i=A(e);break;default:throw"mode:"+t}o.push(i),a=null},c.getModules=function(){return s},c.isDark=function(e,t){if(e<0||n<=e||t<0||n<=t)throw e+","+t;return s[e][t]},c.getModuleCount=function(){return n},c.make=function(){if(i<1){for(var e=1;e<40;e++){for(var t=v.getRSBlocks(e,r),s=b(),n=0;n<o.length;n++){var a=o[n];s.put(a.getMode(),4),s.put(a.getLength(),y.getLengthInBits(a.getMode(),e)),a.write(s)}var h=0;for(n=0;n<t.length;n++)h+=t[n].dataCount;if(s.getLengthInBits()<=8*h)break}i=e}d(!1,function(){for(var e=0,t=0,i=0;i<8;i+=1){d(!0,i);var r=y.getLostPoint(c);(0==i||e>r)&&(e=r,t=i)}return t}())},c.createTableTag=function(e,t){e=e||2;var i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: "+(t=void 0===t?4*e:t)+"px;",i+='">',i+="<tbody>";for(var r=0;r<c.getModuleCount();r+=1){i+="<tr>";for(var s=0;s<c.getModuleCount();s+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+e+"px;",i+=" height: "+e+"px;",i+=" background-color: ",i+=c.isDark(r,s)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return i+="</tbody>",i+="</table>"},c.renderTo2dContext=function(e,t){t=t||2;for(var i=c.getModuleCount(),r=0;r<i;r++)for(var s=0;s<i;s++)e.fillStyle=c.isDark(r,s)?"black":"white",e.fillRect(r*t,s*t,t,t)},c};e.stringToBytes=(e.stringToBytesFuncs={default:function(e){for(var t=[],i=0;i<e.length;i+=1){var r=e.charCodeAt(i);t.push(255&r)}return t}}).default,e.createStringToBytes=function(e,t){var i=function(){for(var i=O(e),r=function(){var e=i.read();if(-1==e)throw"eof";return e},s=0,n={};;){var a=i.read();if(-1==a)break;var o=r(),h=r()<<8|r();n[String.fromCharCode(a<<8|o)]=h,s+=1}if(s!=t)throw s+" != "+t;return n}(),r="?".charCodeAt(0);return function(e){for(var t=[],s=0;s<e.length;s+=1){var n=e.charCodeAt(s);if(n<128)t.push(n);else{var a=i[e.charAt(s)];"number"==typeof a?(255&a)==a?t.push(a):(t.push(a>>>8),t.push(255&a)):t.push(r)}}return t}};var t,i,r,s=1,n=2,a=4,o=8,h={L:1,M:0,Q:3,H:2},c=0,d=1,u=2,l=3,p=4,m=5,f=6,g=7,y=(t=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],r=function(e){for(var t=0;0!=e;)t+=1,e>>>=1;return t},(i={}).getBCHTypeInfo=function(e){for(var t=e<<10;r(t)-r(1335)>=0;)t^=1335<<r(t)-r(1335);return 21522^(e<<10|t)},i.getBCHTypeNumber=function(e){for(var t=e<<12;r(t)-r(7973)>=0;)t^=7973<<r(t)-r(7973);return e<<12|t},i.getPatternPosition=function(e){return t[e-1]},i.getMaskFunction=function(e){switch(e){case c:return function(e,t){return(e+t)%2==0};case d:return function(e,t){return e%2==0};case u:return function(e,t){return t%3==0};case l:return function(e,t){return(e+t)%3==0};case p:return function(e,t){return(Math.floor(e/2)+Math.floor(t/3))%2==0};case m:return function(e,t){return e*t%2+e*t%3==0};case f:return function(e,t){return(e*t%2+e*t%3)%2==0};case g:return function(e,t){return(e*t%3+(e+t)%2)%2==0};default:throw"bad maskPattern:"+e}},i.getErrorCorrectPolynomial=function(e){for(var t=w([1],0),i=0;i<e;i+=1)t=t.multiply(w([1,_.gexp(i)],0));return t},i.getLengthInBits=function(e,t){if(1<=t&&t<10)switch(e){case s:return 10;case n:return 9;case a:case o:return 8;default:throw"mode:"+e}else if(t<27)switch(e){case s:return 12;case n:return 11;case a:return 16;case o:return 10;default:throw"mode:"+e}else{if(!(t<41))throw"type:"+t;switch(e){case s:return 14;case n:return 13;case a:return 16;case o:return 12;default:throw"mode:"+e}}},i.getLostPoint=function(e){for(var t=e.getModuleCount(),i=0,r=0;r<t;r+=1)for(var s=0;s<t;s+=1){for(var n=0,a=e.isDark(r,s),o=-1;o<=1;o+=1)if(!(r+o<0||t<=r+o))for(var h=-1;h<=1;h+=1)s+h<0||t<=s+h||0==o&&0==h||a==e.isDark(r+o,s+h)&&(n+=1);n>5&&(i+=3+n-5)}for(r=0;r<t-1;r+=1)for(s=0;s<t-1;s+=1){var c=0;e.isDark(r,s)&&(c+=1),e.isDark(r+1,s)&&(c+=1),e.isDark(r,s+1)&&(c+=1),e.isDark(r+1,s+1)&&(c+=1),0!=c&&4!=c||(i+=3)}for(r=0;r<t;r+=1)for(s=0;s<t-6;s+=1)e.isDark(r,s)&&!e.isDark(r,s+1)&&e.isDark(r,s+2)&&e.isDark(r,s+3)&&e.isDark(r,s+4)&&!e.isDark(r,s+5)&&e.isDark(r,s+6)&&(i+=40);for(s=0;s<t;s+=1)for(r=0;r<t-6;r+=1)e.isDark(r,s)&&!e.isDark(r+1,s)&&e.isDark(r+2,s)&&e.isDark(r+3,s)&&e.isDark(r+4,s)&&!e.isDark(r+5,s)&&e.isDark(r+6,s)&&(i+=40);var d=0;for(s=0;s<t;s+=1)for(r=0;r<t;r+=1)e.isDark(r,s)&&(d+=1);return i+=Math.abs(100*d/t/t-50)/5*10},i),_=function(){for(var e=new Array(256),t=new Array(256),i=0;i<8;i+=1)e[i]=1<<i;for(i=8;i<256;i+=1)e[i]=e[i-4]^e[i-5]^e[i-6]^e[i-8];for(i=0;i<255;i+=1)t[e[i]]=i;var r={glog:function(e){if(e<1)throw"glog("+e+")";return t[e]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return e[t]}};return r}();function w(e,t){if(void 0===e.length)throw e.length+"/"+t;var i=function(){for(var i=0;i<e.length&&0==e[i];)i+=1;for(var r=new Array(e.length-i+t),s=0;s<e.length-i;s+=1)r[s]=e[s+i];return r}(),r={getAt:function(e){return i[e]},getLength:function(){return i.length},multiply:function(e){for(var t=new Array(r.getLength()+e.getLength()-1),i=0;i<r.getLength();i+=1)for(var s=0;s<e.getLength();s+=1)t[i+s]^=_.gexp(_.glog(r.getAt(i))+_.glog(e.getAt(s)));return w(t,0)},mod:function(e){if(r.getLength()-e.getLength()<0)return r;for(var t=_.glog(r.getAt(0))-_.glog(e.getAt(0)),i=new Array(r.getLength()),s=0;s<r.getLength();s+=1)i[s]=r.getAt(s);for(s=0;s<e.getLength();s+=1)i[s]^=_.gexp(_.glog(e.getAt(s))+t);return w(i,0).mod(e)}};return r}var v=function(){var e=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=function(e,t){var i={};return i.totalCount=e,i.dataCount=t,i},i={};return i.getRSBlocks=function(i,r){var s=function(t,i){switch(i){case h.L:return e[4*(t-1)+0];case h.M:return e[4*(t-1)+1];case h.Q:return e[4*(t-1)+2];case h.H:return e[4*(t-1)+3];default:return}}(i,r);if(void 0===s)throw"bad rs block @ typeNumber:"+i+"/errorCorrectionLevel:"+r;for(var n=s.length/3,a=[],o=0;o<n;o+=1)for(var c=s[3*o+0],d=s[3*o+1],u=s[3*o+2],l=0;l<c;l+=1)a.push(t(d,u));return a},i}(),b=function(){var e=[],t=0,i={getBuffer:function(){return e},getAt:function(t){var i=Math.floor(t/8);return 1==(e[i]>>>7-t%8&1)},put:function(e,t){for(var r=0;r<t;r+=1)i.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return t},putBit:function(i){var r=Math.floor(t/8);e.length<=r&&e.push(0),i&&(e[r]|=128>>>t%8),t+=1}};return i},C=function(e){var t=s,i=e,r={getMode:function(){return t},getLength:function(e){return i.length},write:function(e){for(var t=i,r=0;r+2<t.length;)e.put(n(t.substring(r,r+3)),10),r+=3;r<t.length&&(t.length-r==1?e.put(n(t.substring(r,r+1)),4):t.length-r==2&&e.put(n(t.substring(r,r+2)),7))}},n=function(e){for(var t=0,i=0;i<e.length;i+=1)t=10*t+a(e.charAt(i));return t},a=function(e){if("0"<=e&&e<="9")return e.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+e};return r},x=function(e){var t=n,i=e,r={getMode:function(){return t},getLength:function(e){return i.length},write:function(e){for(var t=i,r=0;r+1<t.length;)e.put(45*s(t.charAt(r))+s(t.charAt(r+1)),11),r+=2;r<t.length&&e.put(s(t.charAt(r)),6)}},s=function(e){if("0"<=e&&e<="9")return e.charCodeAt(0)-"0".charCodeAt(0);if("A"<=e&&e<="Z")return e.charCodeAt(0)-"A".charCodeAt(0)+10;switch(e){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+e}};return r},S=function(t){var i=a,r=e.stringToBytes(t),s={getMode:function(){return i},getLength:function(e){return r.length},write:function(e){for(var t=0;t<r.length;t+=1)e.put(r[t],8)}};return s},A=function(t){var i=o,r=e.stringToBytesFuncs.SJIS;if(!r)throw"sjis not supported.";!function(e,t){var i=r("友");if(2!=i.length||38726!=(i[0]<<8|i[1]))throw"sjis not supported."}();var s=r(t),n={getMode:function(){return i},getLength:function(e){return~~(s.length/2)},write:function(e){for(var t=s,i=0;i+1<t.length;){var r=(255&t[i])<<8|255&t[i+1];if(33088<=r&&r<=40956)r-=33088;else{if(!(57408<=r&&r<=60351))throw"illegal char at "+(i+1)+"/"+r;r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13),i+=2}if(i<t.length)throw"illegal char at "+(i+1)}};return n},O=function(e){var t=e,i=0,r=0,s=0,n={read:function(){for(;s<8;){if(i>=t.length){if(0==s)return-1;throw"unexpected end of file./"+s}var e=t.charAt(i);if(i+=1,"="==e)return s=0,-1;e.match(/^\s$/)||(r=r<<6|a(e.charCodeAt(0)),s+=6)}var n=r>>>s-8&255;return s-=8,n}},a=function(e){if(65<=e&&e<=90)return e-65;if(97<=e&&e<=122)return e-97+26;if(48<=e&&e<=57)return e-48+52;if(43==e)return 62;if(47==e)return 63;throw"c:"+e};return n};return e}();i.stringToBytesFuncs["UTF-8"]=function(e){return function(e){for(var t=[],i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(i++,r=65536+((1023&r)<<10|1023&e.charCodeAt(i)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}(e)},e.exports=i},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=9,this._CommandNotifyValue=0,this._CommandOnece=1}get(e){let t=new Uint8Array(0);this.sendCommand(this._CommandOnece,t)}parseFromJson(e){let t=e.switch;if(void 0===t)return;let i=[{uri:"/request/switch/get",onValid:this.get}],r=this.validateCommandSchema(i,t,"switch");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[switch]unknown command")}notifyFromBinary(e,t,i){if(t!==this._CommandOnece&&t!==this._CommandNotifyValue||1!=i.byteLength)super.notifyFromBinary(e,t,i);else{let r=parseInt(i[0]),s=["none","push","left","right"];e.switch={state:s[r]},t===this._CommandOnece&&(e.switch.action="get")}}}},function(e,t,i){const r=i(229),s=i(0);e.exports=class extends s{constructor(){super(),this.module=11,this.uuidLength=18,this._CommandSetAdvData=0,this._CommandSetScanRespData=1,this._CommandStartAdv=2,this._CommandStopAdv=3,this._CommandScan=4,this._CommandStartScan=4,this._CommandStopScan=5,this._CommandScanResults=6,this._CommandConnect=7,this._CommandServices=8,this._CommandCharacteristics=9,this._CommandWriteCharacteristics=10,this._CommandReadCharacteristics=11,this._CommandRegisterNotifyCharacteristic=12,this._CommandUnregisterNotifyCharacteristic=13,this._CommandDescriptors=14,this._CommandWriteDescriptor=15,this._CommandReadDescriptor=16,this._CommandNotifyCharacteristic=17,this._CommandSetDeviceName=19,this._CommandServerStartPeripheral=20,this._CommandServerNotifyConnect=21,this._CommandServerAddService=22,this._CommandServerAddCharacteristic=23,this._CommandServerAddDescriptor=24,this._CommandServerWriteCharavteristicValue=25,this._CommandServerReadCharavteristicValue=26,this._CommandServerNotifyWriteCharavteristicValue=27,this._CommandServerNotifyReadCharavteristicValue=28,this._CommandServerWriteDescriptorValue=29,this._CommandServerReadDescriptorValue=30,this._CommandServerNotifyWriteDescriptorValue=31,this._CommandServerNotifyReadDescriptorValue=32,this._CommandServerNofityCharavteristic=33,this._CommandServerStartStopService=34,this._CommandSecuritySetAuth=35,this._CommandSecuritySetEncryptionLevel=36,this._CommandSecuritySetEnableKeyTypes=37,this._CommandSecuritySetKeyMaxSize=38,this._CommandSecuritySetIOCapability=39,this._CommandSecurityClearBondingDevices=40,this._CommandScanResultsDevice={breder:1,ble:2,dumo:3},this._CommandScanResultsDeviceAddress={public:0,random:1,rpa_public:2,rpa_random:3},this._CommandScanResultsEvet={inquiry_result:0/*!< Inquiry result for a peer device. */,inquiry_complete:1/*!< Inquiry complete. */,discovery_result:2/*!< Discovery result for a peer device. */,discovery_ble_result:3/*!< Discovery result for BLE GATT based service on a peer device. */,discovery_cmoplete:4/*!< Discovery complete. */,discovery_di_cmoplete:5/*!< Discovery complete. */,cancelled:6/*!< Search cancelled */},this._CommandScanResultsBleEvent={connectable_advertisemnt:0/*!< Connectable undirected advertising (ADV_IND) */,connectable_directed_advertisemnt:1/*!< Connectable directed advertising (ADV_DIRECT_IND) */,scannable_advertising:2/*!< Scannable undirected advertising (ADV_SCAN_IND) */,non_connectable_advertising:3/*!< Non connectable undirected advertising (ADV_NONCONN_IND) */,scan_response:4/*!< Scan Response (SCAN_RSP) */},this._CommandCharacteristicsProperties={broadcast:1,read:2,write_without_response:4,write:8,notify:16,indicate:32,auth:64,extended_properties:128},this._commandResults={success:0,failed:1},this._securityAuthValues={1:"bonding",4:"mitm",8:"secure_connection"},this._securityEncryotionLevels={none:1,encryption:2,mitm:3},this._securityKeyTypes={1:"ltk",2:"irk",4:"csrk"}}centralScanStart(e){let t=r.createSendBuffer([{path:"scan.duration",length:4,type:"int",default:30}],e);this.sendCommand(this._CommandStartScan,t)}centralScanStop(e){this.sendCommand(this._CommandStopScan,null)}centralConnect(e){let t=r.createSendBuffer([{path:"connect.address",length:6,type:"hex",required:!0,endianness:"little"},{path:null,length:1,type:"char",default:!1}],e);this.sendCommand(this._CommandConnect,t)}centralDisconnect(e){let t=r.createSendBuffer([{path:"disconnect.address",length:6,type:"hex",required:!0,endianness:"little"},{path:null,length:1,type:"char",default:!0}],e);this.sendCommand(this._CommandConnect,t)}centralServiceGet(e){let t=r.createSendBuffer([{path:"get_services.address",length:6,type:"hex",required:!0,endianness:"little"}],e);this.sendCommand(this._CommandServices,t)}centralCharacteristicGet(e){let t=r.createSendBuffer([{path:"get_characteristics.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"get_characteristics.service_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandCharacteristics,t)}centralCharacteristicRead(e){let t=r.createSendBuffer([{path:"read_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"read_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"read_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandReadCharacteristics,t)}centralCharacteristicWrite(e){let t=r.createSendBuffer([{path:"write_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"write_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"write_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"write_characteristic.needResponse",length:1,type:"char",default:1},{path:"write_characteristic.data",length:null,type:"dataArray"}],e);this.sendCommand(this._CommandWriteCharacteristics,t)}centralCharacteristicRegisterNotify(e){let t=r.createSendBuffer([{path:"register_notify_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"register_notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"register_notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandRegisterNotifyCharacteristic,t)}centralCharacteristicUnregisterNotify(e){let t=r.createSendBuffer([{path:"unregister_notify_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"unregister_notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"unregister_notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandUnregisterNotifyCharacteristic,t)}centralDescriptorGet(e){let t=r.createSendBuffer([{path:"get_descriptors.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"get_descriptors.service_uuid",length:18,type:"uuid",required:!0},{path:"get_descriptors.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandDescriptors,t)}centralDescriptorRead(e){let t=r.createSendBuffer([{path:"read_descriptor.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"read_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"read_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"read_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandReadDescriptor,t)}centralDescriptorWrite(e){let t=r.createSendBuffer([{path:"write_descriptor.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"write_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.needResponse",length:1,type:"char",default:1},{path:"write_descriptor.data",length:null,type:"dataArray"}],e);this.sendCommand(this._CommandWriteDescriptor,t)}peripheralAdvertisementStart(e){this.sendCommand(this._CommandSetAdvData,new Uint8Array(e.advertisement.adv_data)),e.advertisement.scan_resp&&this.sendCommand(this._CommandSetScanRespData,new Uint8Array(e.advertisement.scan_resp)),this.sendCommand(this._CommandStartAdv,null)}peripheralAdvertisementStop(e){this.sendCommand(this._CommandStopAdv,null)}peripheralServiceStart(e){let t,i=e.peripheral,s={1:"read",2:"read_encrypted",4:"read_encrypted_mitm",16:"write",32:"write_encrypted",64:"write_encrypted_mitm",128:"write_signed",256:"write_signed_mitm"},n={service:{command:this._CommandServerAddService,schema:[{path:"uuid",length:18,type:"uuid",required:!0}]},characteristic:{command:this._CommandServerAddCharacteristic,schema:[{path:"service_uuid",length:18,type:"uuid",required:!0},{path:"uuid",length:18,type:"uuid",required:!0},{path:"permissions",length:2,type:"flag",default:["write","read"],flags:s},{path:"properties",length:1,type:"flag",default:["write","read"],flags:{1:"broadcast",2:"read",4:"write_without_response",8:"write",16:"notify",32:"indiate",64:"auth",128:"ext_prop"}},{path:"data",type:"dataArray"}]},descriptor:{command:this._CommandServerAddDescriptor,schema:[{path:"service_uuid",length:18,type:"uuid",required:!0},{path:"characteristic_uuid",length:18,type:"uuid",required:!0},{path:"uuid",length:18,type:"uuid",required:!0},{path:"permissions",length:2,type:"flag",default:["write","read"],flags:s},{path:"data",type:"dataArray"}]},startService:{command:this._CommandServerStartStopService,schema:[{path:"uuid",length:18,type:"uuid",required:!0},{path:null,length:1,type:"char",default:0}]}},a=[],o=[];for(let e in i.services){let s=i.services[e];if(0===(t=r.createSendBuffer(n.service.schema,s)).length)return;a.push({command:n.service.command,buffer:t}),t=r.createSendBuffer(n.startService.schema,s),o.push({command:n.startService.command,buffer:t});for(let e in s.characteristics){let i=s.characteristics[e];if(i.service_uuid=s.uuid,0===(t=r.createSendBuffer(n.characteristic.schema,i)).length)return;a.push({command:n.characteristic.command,buffer:t});for(let e in i.descriptors){let o=i.descriptors[e];if(o.service_uuid=s.uuid,o.characteristic_uuid=i.uuid,0===(t=r.createSendBuffer(n.descriptor.schema,o)).length)return;a.push({command:n.descriptor.command,buffer:t})}}}for(let e in a)this.sendCommand(a[e].command,a[e].buffer);for(let e in o)this.sendCommand(o[e].command,o[e].buffer)}peripheralServiceStop(e){let t=r.createSendBuffer([{path:"peripheral.stop_service.service_uuid",length:18,type:"uuid",required:!0},{path:null,length:1,type:"char",default:1}],e);this.sendCommand(this._CommandServerStartStopService,t)}peripheralServiceStopAll(){this.sendCommand(this._CommandServerStartPeripheral,new Uint8Array([1]))}peripheralCharacteristicRead(e){let t=r.createSendBuffer([{path:"peripheral.read_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerReadCharavteristicValue,t)}peripheralCharacteristicWrite(e){let t=r.createSendBuffer([{path:"peripheral.write_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_characteristic.data",type:"dataArray"}],e);this.sendCommand(this._CommandServerWriteCharavteristicValue,t)}peripheralCharacteristicNotify(e){let t=r.createSendBuffer([{path:"peripheral.notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerNofityCharavteristic,t)}peripheralDescriptorRead(e){let t=r.createSendBuffer([{path:"peripheral.read_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerReadDescriptorValue,t)}peripheralDescriptorWrite(e){let t=r.createSendBuffer([{path:"peripheral.write_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.data",type:"dataArray"}],e);this.sendCommand(this._CommandServerWriteDescriptorValue,t)}securityAuth(e){let t=[{path:"security.auth",type:"flag",length:1,required:!0,flags:this._securityAuthValues}],i=r.createSendBuffer(t,e);this.sendCommand(this._CommandSecuritySetAuth,i)}securityIndicateLevel(e){let t=r.createSendBuffer([{path:"security.indicate_security_level",type:"char",length:1,required:!0}],e);this.sendCommand(this._CommandSecuritySetEncryptionLevel,t)}securityKeyType(e){let t=[{path:"security.key.type",type:"flag",length:1,required:!0,flags:this._securityKeyTypes}],i=r.createSendBuffer(t,e);this.sendCommand(this._CommandSecuritySetEnableKeyTypes,i)}securityKeySize(e){let t=r.createSendBuffer([{path:"security.key.max_size",type:"char",length:1,required:!0}],e);this.sendCommand(this._CommandSecuritySetKeyMaxSize,t)}clearBondingDevicesList(e){let t=new Uint8Array([]);this.sendCommand(this._CommandSecurityClearBondingDevices,t)}parseFromJson(e){let t=e.ble;if(void 0===t)return;let i=[{uri:"/request/ble/central/scan_start",onValid:this.centralScanStart},{uri:"/request/ble/central/scan_stop",onValid:this.centralScanStop},{uri:"/request/ble/central/connect",onValid:this.centralConnect},{uri:"/request/ble/central/disconnect",onValid:this.centralDisconnect},{uri:"/request/ble/central/service_get",onValid:this.centralServiceGet},{uri:"/request/ble/central/characteristic_get",onValid:this.centralCharacteristicGet},{uri:"/request/ble/central/characteristic_read",onValid:this.centralCharacteristicRead},{uri:"/request/ble/central/characteristic_write",onValid:this.centralCharacteristicWrite},{uri:"/request/ble/central/characteristic_register_notify",onValid:this.centralCharacteristicRegisterNotify},{uri:"/request/ble/central/characteristic_unregister_notify",onValid:this.centralCharacteristicUnregisterNotify},{uri:"/request/ble/central/descriptor_get",onValid:this.centralDescriptorGet},{uri:"/request/ble/central/descriptor_read",onValid:this.centralDescriptorRead},{uri:"/request/ble/central/descriptor_write",onValid:this.centralDescriptorWrite},{uri:"/request/ble/peripheral/advertisement_start",onValid:this.peripheralAdvertisementStart},{uri:"/request/ble/peripheral/advertisement_stop",onValid:this.peripheralAdvertisementStop},{uri:"/request/ble/peripheral/service_start",onValid:this.peripheralServiceStart},{uri:"/request/ble/peripheral/service_stop",onValid:this.peripheralServiceStop},{uri:"/request/ble/peripheral/service_stop_all",onValid:this.peripheralServiceStopAll},{uri:"/request/ble/peripheral/characteristic_read",onValid:this.peripheralCharacteristicRead},{uri:"/request/ble/peripheral/characteristic_write",onValid:this.peripheralCharacteristicWrite},{uri:"/request/ble/peripheral/characteristic_notify",onValid:this.peripheralCharacteristicNotify},{uri:"/request/ble/peripheral/descriptor_read",onValid:this.peripheralDescriptorRead},{uri:"/request/ble/peripheral/descriptor_write",onValid:this.peripheralDescriptorWrite},{uri:"/request/ble/security/auth",onValid:this.securityAuth},{uri:"/request/ble/security/indicate_security_level",onValid:this.securityIndicateLevel},{uri:"/request/ble/security/key_type",onValid:this.securityKeyType},{uri:"/request/ble/security/key_max_size",onValid:this.securityKeySize},{uri:"/request/ble/security/devices_clear",onValid:this.clearBondingDevicesList}],r=this.validateCommandSchema(i,t,"ble");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[ble]unknown command")}notifyFromBinary(e,t,i){let r={};r[this._CommandScanResults]=this.notifyFromBinaryScanResponse.bind(this),r[this._CommandConnect]=this.notifyFromBinaryConnect.bind(this),r[this._CommandServices]=this.notifyFromBinaryServices.bind(this),r[this._CommandCharacteristics]=this.notifyFromBinaryChacateristics.bind(this),r[this._CommandWriteCharacteristics]=this.notifyFromBinaryWriteChacateristics.bind(this),r[this._CommandReadCharacteristics]=this.notifyFromBinaryReadChacateristics.bind(this),r[this._CommandRegisterNotifyCharacteristic]=this.notifyFromBinaryRegisterNotifyChacateristic.bind(this),r[this._CommandUnregisterNotifyCharacteristic]=this.notifyFromBinaryUnregisterNotifyChacateristic.bind(this),r[this._CommandNotifyCharacteristic]=this.notifyFromBinaryNotifyChacateristic.bind(this),r[this._CommandDescriptors]=this.notifyFromBinaryDescriptors.bind(this),r[this._CommandWriteDescriptor]=this.notifyFromBinaryWriteDescriptor.bind(this),r[this._CommandReadDescriptor]=this.notifyFromBinaryReadDescriptor.bind(this),r[this._CommandServerNotifyConnect]=this.notifyFromBinaryServerConnectionState.bind(this),r[this._CommandServerReadCharavteristicValue]=this.notifyFromBinaryServerReadCharavteristicValue.bind(this),r[this._CommandServerWriteCharavteristicValue]=this.notifyFromBinaryServerWriteCharavteristicValue.bind(this),r[this._CommandServerNotifyReadCharavteristicValue]=this.notifyFromBinaryServerNotifyReadCharavteristicValue.bind(this),r[this._CommandServerNotifyWriteCharavteristicValue]=this.notifyFromBinaryServerNotifyWriteCharavteristicValue.bind(this),r[this._CommandServerReadDescriptorValue]=this.notifyFromBinaryServerReadDescriptorValue.bind(this),r[this._CommandServerWriteDescriptorValue]=this.notifyFromBinaryServerWriteDescriptorValue.bind(this),r[this._CommandServerNotifyReadDescriptorValue]=this.notifyFromBinaryServerNotifyReadDescriptorValue.bind(this),r[this._CommandServerNotifyWriteDescriptorValue]=this.notifyFromBinaryServerNotifyWriteDescriptorValue.bind(this),r[this.COMMAND_FUNC_ID_ERROR]=this.notifyFromBinaryError.bind(this),r[t]&&r[t](e,i)}notifyFromBinaryScanResponse(e,t){if(t.byteLength>1){let i=[{name:"event_type",type:"enum",length:1,enum:this._CommandScanResultsEvet},{name:"address",type:"hex",length:6,endianness:"little"},{name:"device_type",type:"enum",length:1,enum:this._CommandScanResultsDevice},{name:"address_type",type:"enum",length:1,enum:this._CommandScanResultsDeviceAddress},{name:"ble_event_type",type:"enum",length:1,enum:this._CommandScanResultsBleEvent},{name:"rssi",type:"signed number",length:4},{name:"adv_data",type:"dataArray",length:62},{name:"flag",type:"number",length:4},{name:"num_response",type:"number",length:4},{name:"advertise_length",type:"number",length:1},{name:"scan_response_length",type:"number",length:1}],s=r.convertFromBinaryToJson(i,t);s.scan_resp=s.adv_data.slice(s.advertise_length,s.advertise_length+s.scan_response_length),s.adv_data=s.adv_data.slice(0,s.advertise_length),delete s.num_response,delete s.advertise_length,delete s.scan_response_length,delete s.advertise_data,"inquiry_result"===s.event_type?(delete s.event_type,this._addRowForPath(e,"ble.scan_result",s)):"inquiry_complete"===s.event_type&&this._addRowForPath(e,"ble.scan_result_finish",!0)}}notifyFromBinaryConnect(e,t){if(7===t.length){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"status",type:"enum",length:1,enum:{connected:0,disconnected:1}}],s=r.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.status_update",s)}}notifyFromBinaryServices(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength}],s=r.convertFromBinaryToJson(i,t);null!==s.service_uuid?this._addRowForPath(e,"ble.get_service_result",s):(delete s.service_uuid,this._addRowForPath(e,"ble.get_service_result_finish",s))}notifyFromBinaryChacateristics(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"properties",type:"enum",length:1,enum:this._CommandCharacteristicsProperties,flags:!0}],s=r.convertFromBinaryToJson(i,t);null!==s.characteristic_uuid?this._addRowForPath(e,"ble.get_characteristic_result",s):(delete s.characteristic_uuid,delete s.properties,this._addRowForPath(e,"ble.get_characteristic_result_finish",s))}notifyFromBinaryReadChacateristics(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.read_characteristic_result",s)}notifyFromBinaryWriteChacateristics(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.write_characteristic_result",s)}notifyFromBinaryRegisterNotifyChacateristic(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.register_nofity_characteristic_result",s)}notifyFromBinaryUnregisterNotifyChacateristic(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.unregister_nofity_characteristic_result",s)}notifyFromBinaryNotifyChacateristic(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"is_notify",type:"int",length:1},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);s.is_notify=1===s.is_notify,this._addRowForPath(e,"ble.nofity_characteristic",s)}notifyFromBinaryDescriptors(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],s=r.convertFromBinaryToJson(i,t);null!==s.descriptor_uuid?this._addRowForPath(e,"ble.get_descriptor_result",s):(delete s.descriptor_uuid,this._addRowForPath(e,"ble.get_descriptor_result_finish",s))}notifyFromBinaryReadDescriptor(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.read_descriptor_result",s)}notifyFromBinaryWriteDescriptor(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.write_descriptor_result",s)}notifyFromBinaryServerConnectionState(e,t){let i=r.convertFromBinaryToJson([{name:"address",type:"hex",length:6,endianness:"little"},{name:"status",type:"enum",length:1,enum:{connected:1,disconnected:0}}],t);this._addRowForPath(e,"ble.peripheral.connection_status",i)}notifyFromBinaryServerWriteCharavteristicValue(e,t){let i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.peripheral.write_characteristic_result",s)}notifyFromBinaryServerReadCharavteristicValue(e,t){let i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);s.result="success",this._addRowForPath(e,"ble.peripheral.read_characteristic_result",s)}notifyFromBinaryServerNotifyReadCharavteristicValue(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength}],s=r.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_read_characteristic",s)}notifyFromBinaryServerNotifyWriteCharavteristicValue(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_write_characteristic",s)}notifyFromBinaryServerReadDescriptorValue(e,t){let i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);s.result="success",this._addRowForPath(e,"ble.peripheral.read_descriptor_result",s)}notifyFromBinaryServerWriteDescriptorValue(e,t){let i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],s=r.convertFromBinaryToJson(i,t);s.result=s.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.peripheral.write_descriptor_result",s)}notifyFromBinaryServerNotifyReadDescriptorValue(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],s=r.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_read_descriptor",s)}notifyFromBinaryServerNotifyWriteDescriptorValue(e,t){let i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],s=r.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_write_descriptor",s)}notifyFromBinaryError(e,t){let i=[{name:"module_error_code",type:"char",length:1},{name:"error_code",type:"char",length:1},{name:"function_code",type:"char",length:1},{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],s=r.convertFromBinaryToJson(i,t);s.message={0:"no error",1:"device not connected",2:"service not found",3:"charavteristic not found",4:"descriptor not found",5:"no permission",6:"device not found",7:"ble is busy",8:"service already running",9:"security param are already set",255:"error"}[s.error_code]+" "+{0:"on setting advertisement data",1:"on setting scan response data",2:"on starting advertisement",3:"on stopping advertisement",4:"on starting scan",5:"on stoping scan",6:"",7:"on connecting device",8:"on getting services",9:"on getting characteristic",10:"on writing characteristic",11:"on reading characteristic",14:"on getting descriptor",15:"on writing descriptor",16:"on reading descriptor",20:"on start pheripheral",21:"on notify connect",22:"on adding service",23:"on adding characteristic",24:"on adding descriptor",25:"on writing characteristic",26:"on reading characteristic",27:"on writing characteristic from remote",28:"on reading characteristic from remote",29:"on writing descriptor",30:"on reading descriptor",31:"on writing descriptor from remote",32:"on reading descriptor from remote",33:"on notify characteristic",34:"on start/stop service",35:"on set security auth param",36:"on set security encryption level param",37:"on set security key type param",38:"on set security key size param",39:"on set security io capability",40:"on clear bonding devices list"}[s.function_code],this.envelopError(e,"ble",s)}_addRowForPath(e,t,i){let r=t.split("."),s=e;for(let e=0;e<r.length-1;e++)s[r[e]]=s[r[e]]||{},s=s[r[e]];s[r[r.length-1]]=i}}},function(e,t,i){(function(t){e.exports=class{static convertFromBinaryToJson(e,t){let i={hex:this.hexFromBinary.bind(this),uuid:this.uuidFromBinary.bind(this),number:this.numberFromBinary.bind(this),"signed number":this.signedNumberFromBinary.bind(this),int:this.numberFromBinary.bind(this),char:this.numberFromBinary.bind(this),enum:this.enumFromBinary.bind(this),dataArray:this.dataArrayFromBinary.bind(this)},r={},s=0;for(let n=0;n<e.length;n++){let a=t.slice(s,e[n].length?s+e[n].length:void 0);if(r[e[n].name]=i[e[n].type](a,e[n]),!e[n].length)break;s+=e[n].length}return r}static hexFromBinary(e,t){let i="";for(let r=0;r<e.length;r++)t.endianness&&"little"===t.endianness?i=("00"+e[r].toString(16)).slice(-2)+i:i+=("00"+e[r].toString(16)).slice(-2);return i}static uuidFromBinary(e){let t=16*e[0]+e[1];if(0===t)return null;let i=e.slice(2),r="";for(let e=0;e<t;e++)r=("00"+i[e].toString(16)).slice(-2)+r;return r}static signedNumberFromBinary(e){let t=127&e[0];for(let i=1;i<e.length;i++)t=256*t+e[i];return 0!=(128&e[0])&&(t-=Math.pow(2,8*e.length-1)),t}static numberFromBinary(e){let t=0;for(let i=0;i<e.length;i++)t=256*t+e[i];return t}static keyForVal(e,t){return Object.keys(e).filter((function(i){return e[i]===t}))[0]}static enumFromBinary(e,t){let i=t.enum,r=this.numberFromBinary(e);if(!0===t.flags){let e=[];for(let t of Object.keys(i)){i[t]&r&&e.push(t)}r=e}else{let e=this.keyForVal(i,r);e&&(r=e)}return r}static dataArrayFromBinary(e){let t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}static createSendBuffer(e,t){let i=[];for(let r=0;r<e.length;r++){let s=e[r],n=void 0;if(Array.isArray(s))for(let e in s){let i=Object.assign({},s[e],{required:!0});if(n=this.analyzeSchema(t,i))break}else n=this.analyzeSchema(t,s);Array.prototype.push.apply(i,n)}return new Uint8Array(i)}static analyzeSchema(e,t){let i={hex:this.hexToBinary.bind(this),uuid:this.uuidToBinary.bind(this),int:this.intToBinary.bind(this),char:this.charToBinary.bind(this),dataArray:this.dataArrayToBinary.bind(this),enum:this.enumToBinary.bind(this),string:this.stringToBinary.bind(this),text:this.stringToBinary.bind(this),flag:this.flagToBinary.bind(this)},r=void 0;if(t.path&&(r=this.getProperty(e,t.path)),void 0===r&&t.required)return null;void 0===r&&t.default&&(r=t.default);let s=i[t.type](r,t);return t.length&&s.length!==t.length&&console.log("JSON->BINARY SCHEMA ERROR: (",r,")",t),s}static getProperty(e,t){if(""===t||void 0===t)return e;"string"==typeof t&&(t=t.split(".")),Array.isArray(t)||(t=[t]);let i=0,r=t.length;for(;i<r;)if(void 0===(e=e[t[i++]]))return;return i&&i===r?e:void 0}static hexToBinary(e,t){let i=[],r=e.toLowerCase().replace(/[^0-9abcdef]/g,"");for(let e=0;e<r.length/2;e++)i[e]=parseInt(r[2*e]+r[2*e+1],16);return t&&t.endianness&&"little"===t.endianness&&i.reverse(),i}static intToBinary(e){let t=[];return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e>>0&255,t}static charToBinary(e){let t=[];return t[0]=255&e,t}static dataArrayToBinary(e){return Array.isArray(e)||(e=[e]),e}static uuidToBinary(e){let t=this.hexToBinary(e);t.reverse();let i=t.length,r=[];r[0]=i>>8&255,r[1]=i>>0&255,Array.prototype.push.apply(r,t);for(let e=r.length;e<18;e++)r[e]=0;return r}static enumToBinary(e,t){let i=[];return i.push(t.enum[e]),i}static flagToBinary(e,t){Array.isArray(e)||(e=[e]);let i=t.flags,r=0;for(let t in i)e.includes(i[t])&&(r+=parseInt(t));let s=[];for(let e=(t.length||1)-1;e>=0;e--)s.push(r>>8*e&255);return s}static stringToBinary(e){return new Uint8Array(t(e,"utf8"))}}}).call(this,i(1).Buffer)},function(e,t,i){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=12,this._CommandMeasurementEcho=0}echo(e){let t=e.echo.io_pulse,i="negative"!==e.echo.pulse,r=parseInt(1e3*e.echo.pulse_width),s=e.echo.io_echo,n=e.echo.measure_edges,a=1e3*e.echo.timeout;a=parseInt(a);let o=new Uint8Array(13);o[0]=0,o[1]=t,o[2]=i?1:0,o[3]=r>>24,o[4]=r>>16,o[5]=r>>8,o[6]=r,o[7]=s,o[8]=n,o[9]=a>>24,o[10]=a>>16,o[11]=a>>8,o[12]=a,this.sendCommand(this._CommandMeasurementEcho,o)}parseFromJson(e){let t=e.measure;if(void 0===t)return;let i=[{uri:"/request/measure/echo",onValid:this.echo}],r=this.validateCommandSchema(i,t,"measure");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[measure]unknown command")}notifyFromBinary(e,t,i){if(t===this._CommandMeasurementEcho){let t=0,r=parseInt(i[t++]),s=[];for(let e=0;e<r;e++){let e,r=i[t++]>0;e=i[t++]<<24,e+=i[t++]<<16,e+=i[t++]<<8,e+=i[t++],e/=1e3,s.push({edge:r,timing:e})}e.measure={echo:s}}else super.notifyFromBinary(e,t,i)}}},function(e,t,i){(function(t){const r=i(0);e.exports=class extends r{constructor(){super(),this.module=13,this._MaxPort=8,this._CommandConnect=0,this._CommandClose=1,this._CommandConnection=2,this._CommandWrite=3,this._CommandRead=4}connect(e,i){let r=new Uint8Array(t.from(e.connect.domain,"utf8")),s=new Uint8Array(r.length+3);s[0]=i,s[1]=e.connect.port>>8,s[2]=e.connect.port;for(let e=0;e<r.length;e++)s[3+e]=r[e];this.sendCommand(this._CommandConnect,s)}disconnect(e,t){let i=new Uint8Array([t]);this.sendCommand(this._CommandClose,i)}write(e,t){let i=new Uint8Array(e.write.data.length+1);i[0]=t;for(let t=0;t<e.write.data.length;t++)i[1+t]=e.write.data[t];this.sendCommand(this._CommandWrite,i)}parseFromJson(e){for(let t=0;t<this._MaxPort;t++){let i=e["tcp"+t];if(void 0===i)continue;let r=[{uri:"/request/tcp/connect",onValid:this.connect},{uri:"/request/tcp/disconnect",onValid:this.disconnect},{uri:"/request/tcp/write",onValid:this.write}],s=this.validateCommandSchema(r,i,"tcp"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[tcp${t}]unknown command`)}}notifyFromBinary(e,t,i){switch(t){case this._CommandConnect:{let t="Error";switch(i[1]){case 0:t="ok";break;case 1:t="Port Used";break;case 2:t="Port Area Error";break;case 3:t="Lookup Error";break;case 4:t="Error"}e["tcp"+i[0]]={connect:{message:t,code:i[1]}};break}case this._CommandConnection:if(2===i.length&&0===i[1]){e["tcp"+i[0]]={connection:{connected:!0}}}else{e["tcp"+i[0]]={connection:{connected:!1}}}break;case this._CommandRead:if(i.length>=1){let t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["tcp"+t]={read:{data:r}}}}}}}).call(this,i(1).Buffer)},function(e,t,i){e.exports=class{constructor(){}static getDefinitionFor(e){return"obnizb1"===e?i(233):"esp32w"===e?i(234):"esp32p"===e?i(235):void 0}}},function(e){e.exports=JSON.parse('{"rev":"1","hw":"obnizb1","peripherals":{"io":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"ad":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{},"display":{},"switch":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"1","hw":"esp32w","peripherals":{"io":{"units":{"0":{},"2":{},"4":{},"5":{},"12":{},"13":{},"14":{},"15":{},"16":{},"17":{},"18":{},"19":{},"21":{},"22":{},"23":{},"25":{},"26":{},"27":{},"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"38":{},"39":{}}},"ad":{"units":{"32":{},"33":{},"34":{},"35":{},"36":{},"39":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{},"display":{},"switch":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"1","hw":"esp32w","peripherals":{"io":{"units":{"0":{},"2":{},"4":{},"5":{},"9":{},"10":{},"12":{},"13":{},"14":{},"15":{},"18":{},"19":{},"21":{},"22":{},"23":{},"25":{},"26":{},"27":{},"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"38":{},"39":{}}},"ad":{"units":{"32":{},"33":{},"34":{},"35":{},"36":{},"39":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{},"display":{},"switch":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e,t,i){const r=i(237);e.exports=class{constructor(e,t){this.id=e,t=t||{},this.options={access_token:t.access_token||null,obniz_server:t.obniz_server||"https://obniz.io"},this.urlBase=this.options.obniz_server+"/obniz/"+this.id}get apiVersion(){return i(19).version.split(".").shift()}post(e,t,i){let s=this.urlBase+e,n={"Content-Type":"application/json"};this.options.access_token&&(n.authorization="Bearer "+this.options.access_token);let a={method:"POST",headers:n};return t&&(a.body=JSON.stringify(t)),r(s,a).then(e=>e.json()).then(e=>("function"==typeof i&&i(e),new Promise(t=>{t(e)})))}getState(e){return this.post("/state",null,e)}postJson(e,t){return this.post("/api/"+this.apiVersion,e,t)}}},function(e,t,i){"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,t.default=r.fetch.bind(r),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},function(e,t,i){var r={"./ADConverter/hx711/index.js":239,"./Accessory/USB/index.js":240,"./Biological/PULSE08-M5STICKC-S/index.js":241,"./Ble/2jcie/index.js":242,"./Camera/ArduCAMMini/index.js":243,"./Camera/JpegSerialCam/index.js":244,"./ColorSensor/S11059/index.js":245,"./CompassSensor/HMC5883L/index.js":246,"./Display/7SegmentLED/index.js":247,"./Display/7SegmentLEDArray/index.js":248,"./Display/7SegmentLED_MAX7219/index.js":249,"./Display/MatrixLED_MAX7219/index.js":250,"./Display/ST7735S/index.js":251,"./Display/SainSmartTFT18LCD/index.js":252,"./Display/SharpMemoryTFT/index.js":253,"./DistanceSensor/GP2Y0A21YK0F/index.js":254,"./DistanceSensor/HC-SR04/index.js":255,"./GPS/GYSFDMAXB/index.js":256,"./GasSensor/MQ135/index.js":257,"./GasSensor/MQ2/index.js":258,"./GasSensor/MQ3/index.js":259,"./GasSensor/MQ4/index.js":260,"./GasSensor/MQ5/index.js":261,"./GasSensor/MQ6/index.js":262,"./GasSensor/MQ7/index.js":263,"./GasSensor/MQ8/index.js":264,"./GasSensor/MQ9/index.js":265,"./Grove/Grove_3AxisAccelerometer/index.js":266,"./Grove/Grove_EarHeartRate/index.js":267,"./Grove/Grove_GPS/index.js":268,"./Grove/Grove_MP3/index.js":269,"./GyroSensor/ENC03R_Module/index.js":270,"./Infrared/IRModule/index.js":271,"./Infrared/IRSensor/index.js":272,"./Infrared/InfraredLED/index.js":273,"./Light/FullColorLED/index.js":274,"./Light/LED/index.js":275,"./Light/WS2811/index.js":276,"./Light/WS2812/index.js":277,"./Light/WS2812B/index.js":278,"./Logic/SNx4HC595/index.js":279,"./Memory/24LC256/index.js":280,"./MovementSensor/AK8963/index.js":281,"./MovementSensor/Button/index.js":282,"./MovementSensor/FlickHat/index.js":283,"./MovementSensor/HC-SR505/index.js":284,"./MovementSensor/JoyStick/index.js":285,"./MovementSensor/KXR94-2050/index.js":286,"./MovementSensor/KXSC7-2050/index.js":287,"./MovementSensor/MPU6050/index.js":288,"./MovementSensor/MPU6886/index.js":289,"./MovementSensor/MPU9250/index.js":290,"./MovementSensor/PaPIRsVZ/index.js":291,"./MovementSensor/Potentiometer/index.js":292,"./MovementSensor/SH200Q/index.js":293,"./Moving/DCMotor/index.js":294,"./Moving/PCA9685/index.js":295,"./Moving/ServoMotor/index.js":296,"./Moving/Solenoid/index.js":297,"./Moving/StepperMotor/index.js":298,"./Power/AXP192/index.js":299,"./PressureSensor/FSR-40X/index.js":300,"./SoilSensor/SEN0114/index.js":301,"./Sound/Speaker/index.js":302,"./TemperatureSensor/analog/AnalogTemperatureSensor.js":4,"./TemperatureSensor/analog/LM35DZ/index.js":303,"./TemperatureSensor/analog/LM60/index.js":304,"./TemperatureSensor/analog/LM61/index.js":305,"./TemperatureSensor/analog/LMT87/index.js":306,"./TemperatureSensor/analog/MCP9700/index.js":307,"./TemperatureSensor/analog/MCP9701/index.js":308,"./TemperatureSensor/analog/S8100B/index.js":309,"./TemperatureSensor/analog/S8120C/index.js":310,"./TemperatureSensor/i2c/ADT7410/index.js":311,"./TemperatureSensor/i2c/AM2320/index.js":312,"./TemperatureSensor/i2c/AMG8833/index.js":313,"./TemperatureSensor/i2c/BME280/index.js":314,"./TemperatureSensor/i2c/D6T44L/index.js":315,"./TemperatureSensor/i2c/DHT12/index.js":316,"./TemperatureSensor/i2c/S-5851A/index.js":317,"./TemperatureSensor/i2c/SHT31/index.js":318,"./TemperatureSensor/spi/ADT7310/index.js":319,"./Wireless/RN42/index.js":320,"./Wireless/XBee/index.js":321,"./i2cParts.js":10};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=238},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","sck","dout"],this.requiredKeys=["sck","dout"],this._offset=0,this._scale=1}static info(){return{name:"hx711"}}wired(e){this.obniz=e,this.spi=e.getFreeSpi(),e.setVccGnd(this.params.vcc,this.params.gnd,"5v");let t=["clk","dout"];for(let e of t)if(this.params[e]&&!this.obniz.isValidIO(this.params[e]))throw new Error("spi start param '"+e+"' are to be valid io no");this.sck=e.getIO(this.params.sck),this.dout=e.getIO(this.params.dout),this.sck.output(!0),e.wait(500)}async readWait(){for(this.sck.output(!1);;){if(0==await this.dout.inputWait())break}this.spi.start({mode:"master",mosi:this.params.sck,miso:this.params.dout,frequency:5e5});let e=await this.spi.writeWait([170,170,170,170,170,170,128]);this.spi.end(!0),this.sck.output(!1);let t=[this.doubleBit2singleBit(e[0],e[1]),this.doubleBit2singleBit(e[2],e[3]),this.doubleBit2singleBit(e[4],e[5])];return(0==(128&t[0])?1:-1)*(((127&t[0])<<16)+(t[1]<<8)+(t[2]<<0))}doubleBit2singleBit(e,t){return this.bit(e,7)<<7|this.bit(e,5)<<6|this.bit(e,3)<<5|this.bit(e,1)<<4|this.bit(t,7)<<3|this.bit(t,5)<<2|this.bit(t,3)<<1|this.bit(t,1)<<0}bit(e,t){return e&1<<t?1:0}async readAverageWait(e){let t=[];for(let i=0;i<e;i++)t.push(await this.readWait());return t.reduce((e,t,i)=>e+t,0)/t.length}powerDown(){this.sck.output(!0)}powerUp(){this.sck.output(!1)}async zeroAdjustWait(e){e=parseInt(e)||1,this._offset=await this.readAverageWait(e)}async getValueWait(e){return e=parseInt(e)||1,(await this.readAverageWait(e)-this._offset)/this._scale}setOffset(e){if("number"!=typeof e)throw new Error("offset variable is Number");this._offset=e}setScale(e){if("number"!=typeof e)throw new Error("scale variable is Number");this._scale=e}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd"],this.requiredKeys=["vcc","gnd"],this.displayIoNames={vcc:"vcc",gnd:"gnd"}}static info(){return{name:"USB"}}wired(e){this.obniz=e,this.io_vdd=e.getIO(this.params.vcc),this.io_gnd=e.getIO(this.params.gnd),this.io_gnd.output(!1)}on(){this.io_vdd.output(!0)}off(){this.io_vdd.output(!1)}}e.exports=r},function(e,t,i){(function(t){class i{constructor(){this.keys=["vcc","gnd","tx","rx"],this.requiredKeys=["tx","rx"],this.delimiter=10}static info(){return{name:"Puls08M5stickcS"}}onbpmupdate(e){}onrawupdate(e){}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:19200}),this.receivingData=[],this.init(),this.uart.onreceive=(e,t)=>{let i=[];e.forEach(e=>{if(e===this.delimiter){let e=this.receivingData;if(e[0]==="#".charCodeAt(0)){e[0]=" ".charCodeAt(0);let t=this.decode(e),i=parseInt(t),r=i>0?6e4/i:null;this.onbpmupdate(r)}else{let t=this.decode(e),r=parseInt(t);i.push(r)}this.receivingData=[]}else this.receivingData.push(e)}),i.length>0&&this.onrawupdate(i)}}decode(e){return t.from(e).toString("utf8")}init(){this.uart.send("@OF30"),this.uart.send(10),this.uart.send("@RG2"),this.uart.send(10)}}e.exports=i}).call(this,i(1).Buffer)},function(e,t,i){class r{constructor(){this.keys=[],this.requiredKeys=[],this.periperal=null}static info(){return{name:"2JCIE"}}wired(e){this.obniz=e}async findWait(){return this.periperal=await this.obniz.ble.scan.startOneWait({localName:"Env"}),this.periperal}omron_uuid(e){return`0C4C${e}-7700-46F4-AA96D5E974E32A54`}async connectWait(){if(this.periperal||await this.findWait(),!this.periperal)throw new Error("2JCIE not found");this.periperal.connected||await this.periperal.connectWait()}async disconnectWait(){this.periperal&&this.periperal.connected&&this.periperal.disconnectWait()}signedNumberFromBinary(e){let t=127&e[e.length-1];for(let i=e.length-2;i>=0;i--)t=256*t+e[i];return 0!=(128&e[e.length-1])&&(t-=Math.pow(2,8*e.length-1)),t}unsignedNumberFromBinary(e){let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)t=256*t+e[i];return t}async getLatestData(){await this.connectWait();let e=this.periperal.getService(this.omron_uuid("3000")).getCharacteristic(this.omron_uuid("3001")),t=await e.readWait();return{row_number:t[0],temperature:.01*this.signedNumberFromBinary(t.slice(1,3)),relative_humidity:.01*this.signedNumberFromBinary(t.slice(3,5)),light:1*this.signedNumberFromBinary(t.slice(5,7)),uv_index:.01*this.signedNumberFromBinary(t.slice(7,9)),barometric_pressure:.1*this.signedNumberFromBinary(t.slice(9,11)),soud_noise:.01*this.signedNumberFromBinary(t.slice(11,13)),discomfort_index:.01*this.signedNumberFromBinary(t.slice(13,15)),heatstroke_risk_factor:.01*this.signedNumberFromBinary(t.slice(15,17)),battery_voltage:.001*this.unsignedNumberFromBinary(t.slice(17,19))}}}e.exports=r},function(e,t,i){(function(t){class i{constructor(){this.keys=["cs","mosi","miso","sclk","gnd","vcc","sda","scl","spi","i2c","spi_frequency","spi_drive","module_version"],this.requiredKeys=["cs"],this.ioKeys=this.keys,this.displayName="Cam",this.regs={ARDUCHIP_TEST1:0,ARDUCHIP_MODE:2,ARDUCHIP_FIFO:4,BURST_FIFO_READ:60,ARDUCHIP_TRIG:65,FIFO_SIZE1:66,FIFO_SIZE2:67,FIFO_SIZE3:68},this.configs={OV2640_JPEG_INIT:[[255,0],[44,255],[46,223],[255,1],[60,50],[17,4],[9,2],[4,40],[19,229],[20,72],[44,12],[51,120],[58,51],[59,251],[62,0],[67,17],[22,16],[57,146],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[72,0],[91,0],[66,3],[74,129],[33,153],[36,64],[37,56],[38,130],[92,0],[99,0],[97,112],[98,128],[124,5],[32,128],[40,48],[108,0],[109,128],[110,0],[112,2],[113,148],[115,193],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[55,192],[79,96],[80,168],[109,0],[61,56],[70,63],[79,96],[12,60],[255,0],[229,127],[249,192],[65,36],[224,20],[118,255],[51,160],[66,32],[67,24],[76,0],[135,213],[136,63],[215,3],[217,16],[211,130],[200,8],[201,128],[124,0],[125,0],[124,3],[125,72],[125,72],[124,8],[125,32],[125,16],[125,14],[144,0],[145,14],[145,26],[145,49],[145,90],[145,105],[145,117],[145,126],[145,136],[145,143],[145,150],[145,163],[145,175],[145,196],[145,215],[145,232],[145,32],[146,0],[147,6],[147,227],[147,5],[147,5],[147,0],[147,4],[147,0],[147,0],[147,0],[147,0],[147,0],[147,0],[147,0],[150,0],[151,8],[151,25],[151,2],[151,12],[151,36],[151,48],[151,40],[151,38],[151,2],[151,152],[151,128],[151,0],[151,0],[195,237],[164,0],[168,0],[197,17],[198,81],[191,128],[199,16],[182,102],[184,165],[183,100],[185,124],[179,175],[180,151],[181,255],[176,197],[177,148],[178,15],[196,92],[192,100],[193,75],[140,0],[134,61],[80,0],[81,200],[82,150],[83,0],[84,0],[85,0],[90,200],[91,150],[92,0],[211,0],[195,237],[127,0],[218,0],[229,31],[225,103],[224,0],[221,127],[5,0],[18,64],[211,4],[192,22],[193,18],[140,0],[134,61],[80,0],[81,44],[82,36],[83,0],[84,0],[85,0],[90,44],[91,36],[92,0],[255,255]],OV2640_YUV422:[[255,0],[5,0],[218,16],[215,3],[223,0],[51,128],[60,64],[225,119],[0,0],[255,255]],OV2640_JPEG:[[224,20],[225,119],[229,31],[215,3],[218,16],[224,0],[255,1],[4,8],[255,255]],OV2640_160x120_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,146],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,40],[91,30],[92,0],[224,0],[255,255]],OV2640_176x144_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,146],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,44],[91,36],[92,0],[224,0],[255,255]],OV2640_320x240_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,137],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,80],[91,60],[92,0],[224,0],[255,255]],OV2640_352x288_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,137],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,88],[91,72],[92,0],[224,0],[255,255]],OV2640_640x480_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,137],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,160],[91,120],[92,0],[211,4],[224,0],[255,255]],OV2640_800x600_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,53],[80,137],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,200],[91,150],[92,0],[211,2],[224,0],[255,255]],OV2640_1024x768_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[192,200],[193,150],[140,0],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[90,0],[91,192],[92,1],[211,2],[255,255]],OV2640_1280x960_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,64],[91,240],[92,1],[211,2],[224,0],[255,255]],OV2640_1600x1200_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,144],[91,44],[92,5],[211,2],[224,0],[255,255]]}}static info(){return{name:"ArduCAMMini"}}wired(e){this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_cs=e.getIO(this.params.cs),this.io_cs.output(!0),e.wait(100),this.sensor_addr=48,this.params.module_version=this.params.module_version||0,this.params.mode=this.params.mode||"master",this.params.drive=this.params.spi_drive||"3v",this.params.frequency=this.params.spi_frequency||4e6,this.params.clk=this.params.sclk,this.spi=this.obniz.getSpiWithConfig(this.params),this.params.sda=this.params.sda,this.params.scl=this.params.scl,this.params.clock=this.params.clock||1e5,this.params.mode="master",this.params.pull="5v",this.i2c=e.getI2CWithConfig(this.params)}spi_write(e,t){let i=[];i.push(e),i.push(t),this.io_cs.output(!1),this.spi.write(i),this.io_cs.output(!0)}async spi_readWait(e){let t=[];t.push(e),t.push(0),this.io_cs.output(!1);const i=await this.spi.writeWait(t);return this.io_cs.output(!0),i[1]}i2c_byte_write(e,t){this.i2c.write(this.sensor_addr,[e,t])}i2c_regs_write(e){for(let t=0;t<e.length;t++)this.i2c.write(this.sensor_addr,e[t])}spi_write_reg(e,t){this.spi_write(128|e,t)}async spi_read_regWait(e){return await this.spi_readWait(127&e)}async spi_pingpongWait(){if(this.spi_write_reg(this.regs.ARDUCHIP_TEST1,85),85!==await this.spi_read_regWait(this.regs.ARDUCHIP_TEST1))throw new Error("spi bus fail")}setMode(e){const t={MCU2LCD:0,CAM2LCD:1,LCD2MCU:2};if("number"!=typeof t[e])throw new Error("unknown mode. options are "+t);this.spi_write_reg(this.regs.ARDUCHIP_MODE,t[e])}async getChipIdWait(){this.i2c.write(this.sensor_addr,[10]);const e=await this.i2c.readWait(this.sensor_addr,1);this.i2c.write(this.sensor_addr,[11]);const t=await this.i2c.readWait(this.sensor_addr,1);return(e[0]<<8)+t[0]}init(){this.i2c_byte_write(255,1),this.i2c_byte_write(18,128),this.obniz.wait(100),this.i2c_regs_write(this.configs.OV2640_JPEG_INIT),this.i2c_regs_write(this.configs.OV2640_YUV422),this.i2c_regs_write(this.configs.OV2640_JPEG),this.i2c_byte_write(255,1),this.i2c_byte_write(21,0),this.setSize("320x240")}async startupWait(){await this.spi_pingpongWait(),this.setMode("MCU2LCD");const e=await this.getChipIdWait();if(9794!=e)throw new Error("unknown chip "+e);this.init()}async takeWait(e){for("string"==typeof e&&this._size!==e&&(this.setSize(e),this.obniz.wait(1e3)),this.flushFIFO(),this.flushFIFO(),this.startCapture();!await this.isCaptureDoneWait(););return await this.readFIFOWait()}setSize(e){if(this._size===e)return;const t={"160x120":this.configs.OV2640_160x120_JPEG,"176x144":this.configs.OV2640_176x144_JPEG,"320x240":this.configs.OV2640_320x240_JPEG,"352x288":this.configs.OV2640_352x288_JPEG,"640x480":this.configs.OV2640_640x480_JPEG,"800x600":this.configs.OV2640_800x600_JPEG,"1024x768":this.configs.OV2640_1024x768_JPEG,"1280x960":this.configs.OV2640_1280x960_JPEG,"1600x1200":this.configs.OV2640_1600x1200_JPEG};if(!t[e])throw new Error("unsupported size options are "+Object.keys(t));this._size=e,this.i2c_regs_write(t[e])}updateFIFO(e){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,e)}flushFIFO(){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,1)}async readFIFOLengthWait(){const e=await this.spi_read_regWait(this.regs.FIFO_SIZE1),t=await this.spi_read_regWait(this.regs.FIFO_SIZE2);return 524287&((7&await this.spi_read_regWait(this.regs.FIFO_SIZE3))<<16|t<<8|e)}startCapture(){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,2)}async isCaptureDoneWait(){return!!(8&await this.spi_read_regWait(this.regs.ARDUCHIP_TRIG))}async readFIFOWait(){let e=await this.readFIFOLengthWait();this.io_cs.output(!1),this.spi.write([this.regs.BURST_FIFO_READ]),0==this.params.module_version&&this.spi.write([255]);let t=[];for(;t.length<e;){let i=e-t.length;i>1024&&(i=1024);let r=new Array(i);r.fill(0);const s=await this.spi.writeWait(r);t.push(...s)}return this.io_cs.output(!0),t}arrayToBase64(e){return t.from(e).toString("base64")}}e.exports=i}).call(this,i(1).Buffer)},function(e,t,i){(function(t){class i{constructor(){this.keys=["vcc","cam_tx","cam_rx","gnd"],this.requiredKeys=["cam_tx","cam_rx"],this.ioKeys=this.keys,this.displayName="Jcam",this.displayIoNames={cam_tx:"camTx",cam_rx:"camRx"}}static info(){return{name:"JpegSerialCam"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.my_tx=this.params.cam_rx,this.my_rx=this.params.cam_tx,this.obniz.getIO(this.my_tx).drive("3v"),this.uart=this.obniz.getFreeUart()}async _drainUntil(e,t,i){for(i||(i=[]);;){let r=e.readBytes();i=i.concat(r);let s=this._seekTail(t,i);if(s>=0)return i.splice(0,s),i;await this.obniz.wait(10)}}_seekTail(e,t){let i=0;for(let r=0;r<t.length;r++)if(t[r]===e[i]){if(++i===e.length)return r+1}else i=0;return-1}arrayToBase64(e){return t.from(e).toString("base64")}async startWait(e){e||(e={}),this.uart.start({tx:this.my_tx,rx:this.my_rx,baud:e.baud||38400}),this.obniz.display.setPinName(this.my_tx,"JpegSerialCam","camRx"),this.obniz.display.setPinName(this.my_rx,"JpegSerialCam","camTx"),await this.obniz.wait(2500)}async resetwait(){this.uart.send([86,0,38,0]),await this._drainUntil(this.uart,[118,0,38,0]),await this.obniz.wait(2500)}async setSizeWait(e){let t;if("640x480"===e)t=0;else if("320x240"===e)t=17;else{if("160x120"!==e)throw new Error("unsupported size");t=34}this.uart.send([86,0,49,5,4,1,0,25,t]),await this._drainUntil(this.uart,[118,0,49,0]),await this.resetwait()}async setCompressibilityWait(e){let t=Math.floor(e/100*255);this.uart.send([86,0,49,5,1,1,18,4,t]),await this._drainUntil(this.uart,[118,0,49,0]),await this.resetwait()}async setBaudWait(e){let t;switch(e){case 9600:t=[174,200];break;case 19200:t=[86,228];break;case 38400:t=[42,242];break;case 57600:t=[28,76];break;case 115200:t=[13,166];break;default:throw new Error("invalid baud rate")}this.uart.send([86,0,49,6,4,2,0,8,t[0],t[1]]),await this._drainUntil(this.uart,[118,0,49,0]),await this.startWait({baud:e})}async takeWait(){const e=this.uart;e.send([86,0,54,1,2]),await this._drainUntil(e,[118,0,54,0,0]),e.send([86,0,54,1,0]),await this._drainUntil(e,[118,0,54,0,0]),e.send([86,0,52,1,0]);let t,i,r=await this._drainUntil(e,[118,0,52,0,4,0,0]);for(;;){let s=e.readBytes();if((r=r.concat(s)).length>=2){t=r[0],i=r[1];break}await this.obniz.wait(1e3)}let s=256*t+i;for(e.send([86,0,50,12,0,10,0,0,0,0,0,0,t,i,0,255]),r=await this._drainUntil(e,[118,0,50,0,0]);;){let t=e.readBytes();if((r=r.concat(t)).length>=s)break;await this.obniz.wait(10)}return r=(r=r.splice(0,s)).concat([255,217])}}e.exports=i}).call(this,i(1).Buffer)},function(e,t,i){class r{constructor(){this.keys=["vcc","sda","scl","i2c","gnd"],this.requiredKeys=[],this.address=42,this.regAdrs={},this.regAdrs.ctrl=0,this.regAdrs.manualTiming=1,this.regAdrs.sensorRed=3}static info(){return{name:"S11059"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"3v"),this.obniz.wait(100),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(100)}init(e,t){this.i2c.write(this.address,[this.regAdrs.ctrl,128]);let i=e<<3|t;this.i2c.write(this.address,[this.regAdrs.ctrl,i])}async getVal(){this.i2c.write(this.address,[this.regAdrs.sensorRed]);let e=await this.i2c.readWait(this.address,8),t=[0,0,0,0];return t[0]=e[0]<<8|e[1],t[1]=e[2]<<8|e[3],t[2]=e[4]<<8|e[5],t[3]=e[6]<<8|e[7],t}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","sda","scl","i2c"],this.address={},this.address.device=30,this.address.reset=[2,0],this.address.xMSB=[3]}static info(){return{name:"HMC5883L"}}wired(e){this.obniz=e,e.setVccGnd(null,this.params.gnd,"3v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(500)}init(){this.i2c.write(this.address.device,this.address.reset),this.obniz.wait(500)}async get(){this.i2c.write(this.address.device,this.address.xMSB);let e=await this.i2c.readWait(this.address.device,6),t={},i=["x","y","z"];for(let r=0;r<3;r++){let s=e[2*r]<<8|e[2*r+1];32768&s&&(s-=65536),t[i[r]]=s}return t}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["a","b","c","d","e","f","g","dp","common","commonType"],this.requiredKeys=["a","b","c","d","e","f","g"],this.digits=[63,6,91,79,102,109,125,7,127,111,111],this.displayIoNames={a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",dp:"dp",common:"com"}}static info(){return{name:"7SegmentLED"}}wired(e){function t(t){return t&&"object"==typeof t&&"function"==typeof t.output?t:e.getIO(t)}function i(t){return!(!t||"object"!=typeof t||"function"!=typeof t.output)||e.isValidIO(t)}this.obniz=e,this.ios=[],this.ios.push(t(this.params.a)),this.ios.push(t(this.params.b)),this.ios.push(t(this.params.c)),this.ios.push(t(this.params.d)),this.ios.push(t(this.params.e)),this.ios.push(t(this.params.f)),this.ios.push(t(this.params.g)),this.isCathodeCommon="anode"!==this.params.commonType;for(let e=0;e<this.ios.length;e++)this.ios[e].output(!this.isCathodeCommon);i(this.params.dp)&&(this.dp=t(this.params.dp),this.dp.output(!1)),i(this.params.common)&&(this.common=t(this.params.common),this.on())}print(e){if("number"==typeof e){e=parseInt(e),e%=10;for(let t=0;t<7;t++)if(this.ios[t]){let i=!!(this.digits[e]&1<<t);this.isCathodeCommon||(i=!i),this.ios[t].output(i)}this.on()}}printRaw(e){if("number"==typeof e){for(let t=0;t<7;t++)if(this.ios[t]){let i=!!(e&1<<t);this.isCathodeCommon||(i=!i),this.ios[t].output(i)}this.on()}}dpState(e){this.dp&&this.dp.output(this.isCathodeCommon?e:!e)}on(){this.common.output(!this.isCathodeCommon)}off(){this.common.output(!!this.isCathodeCommon)}}e.exports=r},function(e,t,i){class r{constructor(){this.identifier=""+(new Date).getTime(),this.keys=["segments"],this.requiredKeys=this.keys}static info(){return{name:"7SegmentLEDArray"}}wired(e){this.obniz=e,this.segments=this.params.segments}print(e){if("number"==typeof e){e=parseInt(e);const t=t=>{let i=e;for(let e=0;e<this.segments.length;e++)t===e?this.segments[e].print(i%10):this.segments[e].off(),i/=10};let i=[];for(let e=0;e<this.segments.length;e++)i.push({duration:3,state:t});this.obniz.io.animation(this.identifier,"loop",i)}}on(){this.obniz.io.animation(this.identifier,"resume")}off(){this.obniz.io.animation(this.identifier,"pause");for(let e=0;e<this.segments.length;e++)this.segments[e].off()}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","din","cs","clk"],this.requiredKeys=["din","cs","clk"]}static info(){return{name:"7SegmentLED_MAX7219"}}wired(e){this.cs=e.getIO(this.params.cs),e.isValidIO(this.params.vcc)&&e.getIO(this.params.vcc).output(!0),e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.params.frequency=this.params.frequency||1e7,this.params.mode="master",this.params.mosi=this.params.din,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.cs.output(!0),this.cs.output(!1),this.cs.output(!0)}init(e,t){this.numOfDisp=e,this.digits=t,this.writeAllDisp([9,255]),this.writeAllDisp([10,5]),this.writeAllDisp([11,t-1]),this.writeAllDisp([12,1]),this.writeAllDisp([15,0]),this.obniz.wait(10)}clear(e){for(let t=0;t<this.digits;t++)this.writeOneDisp(e,[t+1,15])}clearAll(){for(let e=0;e<this.numOfDisp;e++)for(let e=0;e<this.digits;e++)this.writeAllDisp([e+1,15])}test(){this.writeAllDisp([15,0])}brightness(e,t){this.writeOneDisp(e,[10,t])}brightnessAll(e){this.writeAllDisp([10,e])}writeAllDisp(e){for(let t=0;t<this.numOfDisp;t++)this.writeOneDisp(t,e)}writeOneDisp(e,t){this.cs.output(!1);for(let t=0;t<e;t++)this.spi.write([0,0]);this.spi.write(t);for(let t=0;t<this.numOfDisp-(e+1);t++)this.spi.write([0,0]);this.cs.output(!0)}setNumber(e,t,i,r){t>=0&&t<=this.digits-1&&this.writeOneDisp(e,[t+1,this.encodeBCD(i,r)])}encodeBCD(e,t){let i;return i=1==t?128:0,e>=0&&e<=9?e|i:"-"==e||10==e?10|i:"e"==e||11==e?11|i:"h"==e||12==e?12|i:"l"==e||13==e?13|i:"p"==e||14==e?14|i:"on"==e?136:15|i}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","din","cs","clk"],this.requiredKeys=["din","cs","clk"]}static info(){return{name:"MatrixLED_MAX7219"}}wired(e){this.cs=e.getIO(this.params.cs),e.isValidIO(this.params.vcc)&&e.getIO(this.params.vcc).output(!0),e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.params.frequency=this.params.frequency||1e7,this.params.mode="master",this.params.mosi=this.params.din,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.cs.output(!0),this.cs.output(!1),this.cs.output(!0)}init(e,t){this.width=e,this.height=t,this.preparevram(e,t),this.initModule()}initModule(){this.write([9,0]),this.write([10,5]),this.write([11,7]),this.write([12,1]),this.write([15,0]),this.passingCommands(),this.obniz.wait(10)}test(){this.write([15,0]),this.passingCommands()}passingCommands(){for(let e=8;e<this.width;e+=8)this.write([0,0])}brightness(e){this.write([10,e]),this.passingCommands()}preparevram(e,t){this.vram=[];for(let i=0;i<t;i++){let t=new Array(e/8);for(let e=0;e<t.length;e++)t[e]=0;this.vram.push(t)}}write(e){this.cs.output(!1),this.spi.write(e),this.cs.output(!0)}writeVram(){for(let e=0;e<this.height;e++){let t=e+1,i=this.vram[e],r=[];for(let e=0;e<i.length;e++)r.push(t),r.push(i[e]);this.write(r)}}clear(){for(let e=0;e<this.height;e++){let t=this.vram[e];for(let i=0;i<t.length;i++)this.vram[e][i]=0;this.writeVram()}}draw(e){const t=e.getImageData(0,0,this.width,this.height).data;for(let e=0;e<t.length;e+=4){let i=.34*t[e]+.5*t[e+1]+.16*t[e+2],r=parseInt(e/4),s=parseInt(r/this.width),n=parseInt((r-s*this.width)/8),a=parseInt(r-s*this.width)%8;0===a&&(this.vram[s][n]=0),i>127&&(this.vram[s][n]|=128>>a)}this.writeVram()}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["sclk","mosi","cs","res","dc"],this.required=[]}static info(){return{name:"ST7735S"}}wired(e){this.debugprint=!1,this.obniz=e,this.io_dc=e.getIO(this.params.dc),this.io_res=e.getIO(this.params.res),this.io_cs=e.getIO(this.params.cs),this.params.frequency=16e6,this.params.mode="master",this.params.clk=this.params.sclk,this.params.mosi=this.params.mosi,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.io_dc.output(!0),this.io_cs.output(!1),this.width=s,this.height=n,this.rotation=0,this.x_offset=26,this.y_offset=2,this.writeBuffer=[],this._setPresetColor(),this.init()}print_debug(e){this.debugprint&&console.log("SainSmartTFT18LCD: "+Array.prototype.slice.call(arguments).join(""))}_deadSleep(e){let t=new Date;for(;new Date-t<e;);}_reset(){this.io_res.output(!1),this._deadSleep(10),this.io_res.output(!0),this._deadSleep(10)}writeCommand(e){this.io_dc.output(!1),this.io_cs.output(!1),this.spi.write([e]),this.io_cs.output(!0)}writeData(e){this.io_dc.output(!0),this.io_cs.output(!1),this.spi.write(e),this.io_cs.output(!0)}write(e,t){0!=t.length&&(this.writeCommand(e),this.writeData(t))}async asyncwait(){return await this.spi.writeWait([0])}_writeFlush(){for(;this.writeBuffer.length>0;)if(this.writeBuffer.length>1024){let e=this.writeBuffer.slice(0,1024);this.writeData(e),this.writeBuffer.splice(0,1024)}else this.writeBuffer.length>0&&this.writeData(this.writeBuffer),this.writeBuffer=[]}_writeBuffer(e){e&&e.length>0?this.writeBuffer=this.writeBuffer.concat(e):this._writeFlush()}color16(e,t,i){return(248&e)<<8|(252&t)<<3|i>>3}_initG(){this.writeCommand(a),this.obniz.wait(150),this.writeCommand(o),this.obniz.wait(500),this.write(y,[1,44,45]),this.write(_,[1,44,45]),this.write(w,[1,44,45,1,44,45]),this.write(v,[7]),this.write(b,[162,2,132]),this.write(C,[197]),this.write(x,[10,0]),this.write(S,[138,42]),this.write(A,[138,238]),this.write(O,[14]),this.writeCommand(h),this.write(f,[200]),this.write(g,[5]),this.write(l,[0,0,0,127]),this.write(p,[0,0,0,159]),this.writeCommand(c),this.write(I,[2,28,7,18,55,50,41,45,41,37,43,57,0,1,3,16]),this.write(P,[3,29,7,6,46,44,41,45,46,46,55,63,0,0,2,16])}init(){this._reset(),this._initG(),this.setDisplayOn(),this.setRotation(0)}setDisplayOn(){this.writeCommand(u)}setDisplayOff(){this.writeCommand(d)}setDisplay(e){1==e?this.setDisplayOn():this.setDisplayOff()}setInversionOn(){this.writeCommand(c)}setInversionOff(){this.writeCommand(h)}setInversion(e){1==e?this.setInversionOn():this.setInversionOff()}setRotation(e){let t;switch(this.rotation=e%4,this.rotation){case 0:t=[192],this.width=s,this.height=n;break;case 1:t=[160],this.width=n,this.height=s;break;case 2:t=[0],this.width=s,this.height=n;break;case 3:t=[96],this.width=n,this.height=s}this.write(f,t),this.setAddrWindow(0,0,this.width-1,this.height-1)}setAddrWindow(e,t,i,r){this.print_debug(`setAddrWindow: (x0: ${e}, y0: ${t}) - (x1: ${i}, y1: ${r})`),e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),r<0&&(r=0),0==this.rotation||2==this.rotation?(e+=this.x_offset,i+=this.x_offset,t+=this.y_offset,r+=this.y_offset):(e+=this.y_offset,i+=this.y_offset,t+=this.x_offset,r+=this.x_offset),this.write(l,[0,e,0,i]),this.write(p,[0,t,0,r]),this.writeCommand(m),this.writeBuffer=[]}fillScreen(e){this.fillRect(0,0,this.width,this.height,e)}fillRect(e,t,i,r,s){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),t+r-1>=this.height&&(r=this.height-t),this.setAddrWindow(e,t,e+i-1,t+r-1);let n=s>>8,a=255&s,o=[];for(t=r;t>0;t--)for(e=i;e>0;e--)o.push(n),o.push(a);this._writeBuffer(o),this._writeBuffer()}drawRect(e,t,i,r,s){this.drawHLine(e,t,i,s),this.drawHLine(e,t+r-1,i,s),this.drawVLine(e,t,r,s),this.drawVLine(e+i-1,t,r,s)}drawCircle(e,t,i,r){let s=1-i,n=1,a=-2*i,o=0,h=i;for(this.drawPixel(e,t+i,r),this.drawPixel(e,t-i,r),this.drawPixel(e+i,t,r),this.drawPixel(e-i,t,r);o<h;)s>=0&&(h--,s+=a+=2),o++,s+=n+=2,this.drawPixel(e+o,t+h,r),this.drawPixel(e-o,t+h,r),this.drawPixel(e+o,t-h,r),this.drawPixel(e-o,t-h,r),this.drawPixel(e+h,t+o,r),this.drawPixel(e-h,t+o,r),this.drawPixel(e+h,t-o,r),this.drawPixel(e-h,t-o,r)}_drawCircleHelper(e,t,i,r,s){let n=1-i,a=1,o=-2*i,h=0,c=i;for(;h<c;)n>=0&&(c--,n+=o+=2),h++,n+=a+=2,4&r&&(this.drawPixel(e+h,t+c,s),this.drawPixel(e+c,t+h,s)),2&r&&(this.drawPixel(e+h,t-c,s),this.drawPixel(e+c,t-h,s)),8&r&&(this.drawPixel(e-c,t+h,s),this.drawPixel(e-h,t+c,s)),1&r&&(this.drawPixel(e-c,t-h,s),this.drawPixel(e-h,t-c,s))}fillCircle(e,t,i,r){this.drawVLine(e,t-i,2*i+1,r),this._fillCircleHelper(e,t,i,3,0,r)}_fillCircleHelper(e,t,i,r,s,n){let a=1-i,o=1,h=-2*i,c=0,d=i;for(;c<d;)a>=0&&(d--,a+=h+=2),c++,a+=o+=2,1&r&&(this.drawVLine(e+c,t-d,2*d+1+s,n),this.drawVLine(e+d,t-c,2*c+1+s,n)),2&r&&(this.drawVLine(e-c,t-d,2*d+1+s,n),this.drawVLine(e-d,t-c,2*c+1+s,n))}drawRoundRect(e,t,i,r,s,n){this.drawHLine(e+s,t,i-2*s,n),this.drawHLine(e+s,t+r-1,i-2*s,n),this.drawVLine(e,t+s,r-2*s,n),this.drawVLine(e+i-1,t+s,r-2*s,n),this._drawCircleHelper(e+s,t+s,s,1,n),this._drawCircleHelper(e+i-s-1,t+s,s,2,n),this._drawCircleHelper(e+i-s-1,t+r-s-1,s,4,n),this._drawCircleHelper(e+s,t+r-s-1,s,8,n)}fillRoundRect(e,t,i,r,s,n){this.fillRect(e+s,t,i-2*s,r,n),this._fillCircleHelper(e+i-s-1,t+s,s,1,r-2*s-1,n),this._fillCircleHelper(e+s,t+s,s,2,r-2*s-1,n)}drawTriangle(e,t,i,r,s,n,a){this.drawLine(e,t,i,r,a),this.drawLine(i,r,s,n,a),this.drawLine(s,n,e,t,a)}fillTriangle(e,t,i,r,s,n,a){let o,h,c,d;if(t>r&&(r=[t,t=r][0],i=[e,e=i][0]),r>n&&(n=[r,r=n][0],s=[i,i=s][0]),t>r&&(r=[t,t=r][0],i=[e,e=i][0]),t==n)return i<(o=h=e)?o=i:i>h&&(h=i),s<o?o=s:s>h&&(h=s),void this.drawHLine(o,t,h-o+1,a);let u=i-e,l=r-t,p=s-e,m=n-t,f=s-i,g=n-r,y=0,_=0;for(d=r==n?r:r-1,c=t;c<=d;c++)o=e+Math.floor(y/l),h=e+Math.floor(_/m),y+=u,_+=p,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a);for(y=f*(c-r),_=p*(c-t);c<=n;c++)o=i+Math.floor(y/g),h=e+Math.floor(_/m),y+=f,_+=p,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a)}drawVLine(e,t,i,r){if(e>=this.width||t>=this.height)return;t+i-1>=this.height&&(i=this.height-t),this.setAddrWindow(e,t,e,t+i-1);let s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawHLine(e,t,i,r){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),this.setAddrWindow(e,t,e+i-1,t);let s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawLine(e,t,i,r,s){let n=Math.abs(r-t)>Math.abs(i-e);n&&(t=[e,e=t][0],r=[i,i=r][0]),e>i&&(i=[e,e=i][0],r=[t,t=r][0]);let a=i-e,o=Math.abs(r-t),h=a/2,c=t<r?1:-1;for(;e<=i;e++)n?this.drawPixel(t,e,s):this.drawPixel(e,t,s),(h-=o)<0&&(t+=c,h+=a)}drawPixel(e,t,i){e<0||e>=this.width||t<0||t>=this.height||(this.setAddrWindow(e,t,e+1,t+1),this.writeData([i>>8,255&i]))}drawChar(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;if(r!=s)return void this.drawChar2(e,t,i,r,s,n);let a=i.charCodeAt(0);for(let i=0;i<6;i++){let o=5==i?0:q[5*a+i];for(let a=0;a<8;a++)1&o?1==n?this.drawPixel(e+i,t+a,r):this.fillRect(e+i*n,t+a*n,n,n,r):s!=r&&(1==n?this.drawPixel(e+i,t+a,s):this.fillRect(e+i*n,t+a*n,n,n,s)),o>>=1}}drawChar2(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;let a=new Array(48*n*n),o=i.charCodeAt(0);for(let e=0;e<6;e++){let t=5==e?0:q[5*o+e];for(let i=0;i<8;i++){let o=1&t?r:s;for(let t=0;t<n;t++)for(let r=0;r<n;r++)a[e*(1*n)+t+(i*(6*n*n)+r*(6*n))]=o;t>>=1}}this.rawBound16(e,t,6*n,8*n,a)}rawBound16(e,t,i,r,s){let n=[];s.forEach((function(e){n.push((65280&e)>>8),n.push(255&e)})),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer()}drawString(e,t,i,r,s,n,a){n=n||1;for(let o=0;o<i.length;o++){let h=i.charAt(o);"\n"==h?(t+=8*n,e=0):"\r"==h||(this.drawChar(e,t,h,r,s,n),e+=6*n,a&&e>this.width-6*n&&(t+=8*n,e=0))}return[e,t]}drawContextBound(e,t,i,r,s,n,a,o){t=t||0,i=i||0,r=r||e.canvas.clientWidth,s=s||e.canvas.clientHeight,n=n||0,a=a||0,o=o||!1,this.write(g,[E]);let h=e.getImageData(t,i,r,s).data,c=[];for(let e=0;e<h.length;e+=4){let t=h[e+0],i=h[e+1],r=h[e+2];if(o){let e=Math.round(.299*t+.587*i+.114*r);c.push(e),c.push(e),c.push(e)}else c.push(t),c.push(i),c.push(r)}this.write(g,[E]),this.setAddrWindow(n,a,n+r-1,a+s-1),this._writeBuffer(c),this._writeBuffer(),this.write(g,[k])}drawContext(e,t){t=t||!1,this.drawContextBound(e,0,0,this.width,this.height,0,0,t)}draw(e,t){this.drawContext(e,t)}rawBound(e,t,i,r,s){let n=[];s.forEach((function(e){n.push((16711680&e)>>16),n.push((65280&e)>>8),n.push(255&e)})),this.write(g,[E]),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer(),this.write(g,[k])}raw(e){this.rawBound16(0,0,this.width,this.height,e)}_setPresetColor(){this.color={AliceBlue:63455,AntiqueWhite:65370,Aqua:2047,Aquamarine:32762,Azure:63487,Beige:63419,Bisque:65336,Black:0,BlanchedAlmond:65369,Blue:31,BlueViolet:35164,Brown:41285,BurlyWood:56784,CadetBlue:23796,Chartreuse:32736,Chocolate:54083,Coral:64490,CornflowerBlue:25789,Cornsilk:65499,Crimson:55463,Cyan:2047,DarkBlue:17,DarkCyan:1105,DarkGoldenRod:48161,DarkGray:44373,DarkGreen:800,DarkKhaki:48557,DarkMagenta:34833,DarkOliveGreen:21317,DarkOrange:64608,DarkOrchid:39321,DarkRed:34816,DarkSalmon:60591,DarkSeaGreen:36337,DarkSlateBlue:18929,DarkSlateGray:10857,DarkTurquoise:1658,DarkViolet:36890,DeepPink:63666,DeepSkyBlue:1535,DimGray:27469,DodgerBlue:7327,FireBrick:45316,FloralWhite:65502,ForestGreen:9284,Fuchsia:63519,Gainsboro:57083,GhostWhite:65503,Gold:65184,GoldenRod:56612,Gray:33808,Green:1024,GreenYellow:45029,HoneyDew:63486,HotPink:64342,IndianRed:51947,Indigo:18448,Ivory:65534,Khaki:63281,Lavender:59199,LavenderBlush:65438,LawnGreen:32736,LemonChiffon:65497,LightBlue:44764,LightCoral:62480,LightCyan:59391,LightGoldenRodYellow:65498,LightGray:54938,LightGreen:38770,LightPink:64952,LightSalmon:64783,LightSeaGreen:9621,LightSkyBlue:34431,LightSlateGray:29779,LightSteelBlue:46651,LightYellow:65532,Lime:2016,LimeGreen:13926,Linen:65436,Magenta:63519,Maroon:32768,MediumAquaMarine:26229,MediumBlue:25,MediumOrchid:47802,MediumPurple:37787,MediumSeaGreen:15758,MediumSlateBlue:31581,MediumSpringGreen:2003,MediumTurquoise:20121,MediumVioletRed:49328,MidnightBlue:6350,MintCream:63487,MistyRose:65340,Moccasin:65334,NavajoWhite:65269,Navy:16,OldLace:65468,Olive:33792,OliveDrab:27748,Orange:64800,OrangeRed:64032,Orchid:56218,PaleGoldenRod:61269,PaleGreen:40915,PaleTurquoise:44925,PaleVioletRed:56210,PapayaWhip:65402,PeachPuff:65239,Peru:52263,Pink:65049,Plum:56603,PowderBlue:46876,Purple:32784,RebeccaPurple:24979,Red:63488,RosyBrown:48241,RoyalBlue:17244,SaddleBrown:35362,Salmon:64526,SandyBrown:62764,SeaGreen:11338,SeaShell:65469,Sienna:41605,Silver:50712,SkyBlue:34429,SlateBlue:27353,SlateGray:29714,Snow:65503,SpringGreen:2031,SteelBlue:17430,Tan:54705,Teal:1040,Thistle:56827,Tomato:64264,Turquoise:18202,Violet:60445,Wheat:63222,White:65535,WhiteSmoke:63422,Yellow:65504,YellowGreen:40550}}}e.exports=r;const s=80,n=160,a=1,o=17,h=32,c=33,d=40,u=41,l=42,p=43,m=44,f=54,g=58,y=177,_=178,w=179,v=180,b=192,C=193,x=194,S=195,A=196,O=197,I=224,P=225,E=6,k=5,q=[0,0,0,0,0,62,91,79,91,62,62,107,79,107,62,28,62,124,62,28,24,60,126,60,24,28,87,125,87,28,28,94,127,94,28,0,24,60,24,0,255,231,195,231,255,0,24,36,24,0,255,231,219,231,255,48,72,58,6,14,38,41,121,41,38,64,127,5,5,7,64,127,5,37,63,90,60,231,60,90,127,62,28,28,8,8,28,28,62,127,20,34,127,34,20,95,95,0,95,95,6,9,127,1,127,0,102,137,149,106,96,96,96,96,96,148,162,255,162,148,8,4,126,4,8,16,32,126,32,16,8,8,42,28,8,8,28,42,8,8,30,16,16,16,16,12,30,12,30,12,48,56,62,56,48,6,14,62,14,6,0,0,0,0,0,0,0,95,0,0,0,7,0,7,0,20,127,20,127,20,36,42,127,42,18,35,19,8,100,98,54,73,86,32,80,0,8,7,3,0,0,28,34,65,0,0,65,34,28,0,42,28,127,28,42,8,8,62,8,8,0,128,112,48,0,8,8,8,8,8,0,0,96,96,0,32,16,8,4,2,62,81,73,69,62,0,66,127,64,0,114,73,73,73,70,33,65,73,77,51,24,20,18,127,16,39,69,69,69,57,60,74,73,73,49,65,33,17,9,7,54,73,73,73,54,70,73,73,41,30,0,0,20,0,0,0,64,52,0,0,0,8,20,34,65,20,20,20,20,20,0,65,34,20,8,2,1,89,9,6,62,65,93,89,78,124,18,17,18,124,127,73,73,73,54,62,65,65,65,34,127,65,65,65,62,127,73,73,73,65,127,9,9,9,1,62,65,65,81,115,127,8,8,8,127,0,65,127,65,0,32,64,65,63,1,127,8,20,34,65,127,64,64,64,64,127,2,28,2,127,127,4,8,16,127,62,65,65,65,62,127,9,9,9,6,62,65,81,33,94,127,9,25,41,70,38,73,73,73,50,3,1,127,1,3,63,64,64,64,63,31,32,64,32,31,63,64,56,64,63,99,20,8,20,99,3,4,120,4,3,97,89,73,77,67,0,127,65,65,65,2,4,8,16,32,0,65,65,65,127,4,2,1,2,4,64,64,64,64,64,0,3,7,8,0,32,84,84,120,64,127,40,68,68,56,56,68,68,68,40,56,68,68,40,127,56,84,84,84,24,0,8,126,9,2,24,164,164,156,120,127,8,4,4,120,0,68,125,64,0,32,64,64,61,0,127,16,40,68,0,0,65,127,64,0,124,4,120,4,120,124,8,4,4,120,56,68,68,68,56,252,24,36,36,24,24,36,36,24,252,124,8,4,4,8,72,84,84,84,36,4,4,63,68,36,60,64,64,32,124,28,32,64,32,28,60,64,48,64,60,68,40,16,40,68,76,144,144,144,124,68,100,84,76,68,0,8,54,65,0,0,0,119,0,0,0,65,54,8,0,2,1,2,4,2,60,38,35,38,60,30,161,161,97,18,58,64,64,32,122,56,84,84,85,89,33,85,85,121,65,33,84,84,120,65,33,85,84,120,64,32,84,85,121,64,12,30,82,114,18,57,85,85,85,89,57,84,84,84,89,57,85,84,84,88,0,0,69,124,65,0,2,69,125,66,0,1,69,124,64,240,41,36,41,240,240,40,37,40,240,124,84,85,69,0,32,84,84,124,84,124,10,9,127,73,50,73,73,73,50,50,72,72,72,50,50,74,72,72,48,58,65,65,33,122,58,66,64,32,120,0,157,160,160,125,57,68,68,68,57,61,64,64,64,61,60,36,255,36,36,72,126,73,67,102,43,47,252,47,43,255,9,41,246,32,192,136,126,9,3,32,84,84,121,65,0,0,68,125,65,48,72,72,74,50,56,64,64,34,122,0,122,10,10,114,125,13,25,49,125,38,41,41,47,40,38,41,41,41,38,48,72,77,64,32,56,8,8,8,8,8,8,8,8,56,47,16,200,172,186,47,16,40,52,250,0,0,123,0,0,8,20,42,20,34,34,20,42,20,8,170,0,85,0,170,170,85,170,85,170,0,0,0,255,0,16,16,16,255,0,20,20,20,255,0,16,16,255,0,255,16,16,240,16,240,20,20,20,252,0,20,20,247,0,255,0,0,255,0,255,20,20,244,4,252,20,20,23,16,31,16,16,31,16,31,20,20,20,31,0,16,16,16,240,0,0,0,0,31,16,16,16,16,31,16,16,16,16,240,16,0,0,0,255,16,16,16,16,16,16,16,16,16,255,16,0,0,0,255,20,0,0,255,0,255,0,0,31,16,23,0,0,252,4,244,20,20,23,16,23,20,20,244,4,244,0,0,255,0,247,20,20,20,20,20,20,20,247,0,247,20,20,20,23,20,16,16,31,16,31,20,20,20,244,20,16,16,240,16,240,0,0,31,16,31,0,0,0,31,20,0,0,0,252,20,0,0,240,16,240,16,16,255,16,255,20,20,20,255,20,16,16,16,31,0,0,0,0,240,16,255,255,255,255,255,240,240,240,240,240,255,255,255,0,0,0,0,0,255,255,15,15,15,15,15,56,68,68,56,68,124,42,42,62,20,126,2,2,6,6,2,126,2,126,2,99,85,73,65,99,56,68,68,60,4,64,126,32,30,32,6,2,126,2,2,153,165,231,165,153,28,42,73,42,28,76,114,1,114,76,48,74,77,77,48,48,72,120,72,48,188,98,90,70,61,62,73,73,73,0,126,1,1,1,126,42,42,42,42,42,68,68,95,68,68,64,81,74,68,64,64,68,74,81,64,0,0,255,1,3,224,128,255,0,0,8,8,107,107,8,54,18,54,36,54,6,15,9,15,6,0,0,24,24,0,0,0,16,16,0,48,64,255,1,1,0,31,1,1,30,0,25,29,23,18,0,60,60,60,60,0,0,0,0,0]},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","scl","sda","dc","res","cs"],this.required=["scl","sda","dc","res","cs"],this.displayIoNames={vcc:"vcc",gnd:"gnd",scl:"scl",sda:"sda",dc:"dc",res:"res",cs:"cs"}}static info(){return{name:"SainSmartTFT18LCD"}}wired(e){this.debugprint=!1,this.obniz=e,this.io_dc=e.getIO(this.params.dc),this.io_res=e.getIO(this.params.res),this.io_cs=e.getIO(this.params.cs),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.frequency=16e6,this.params.mode="master",this.params.clk=this.params.scl,this.params.mosi=this.params.sda,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.io_dc.output(!0),this.io_cs.output(!1),this.width=s,this.height=n,this.writeBuffer=[],this._setPresetColor(),this.init()}print_debug(e){this.debugprint&&console.log("SainSmartTFT18LCD: "+Array.prototype.slice.call(arguments).join(""))}_deadSleep(e){let t=new Date;for(;new Date-t<e;);}_reset(){this.io_res.output(!1),this._deadSleep(10),this.io_res.output(!0),this._deadSleep(10)}writeCommand(e){this.io_dc.output(!1),this.io_cs.output(!1),this.spi.write([e]),this.io_cs.output(!0)}writeData(e){this.io_dc.output(!0),this.io_cs.output(!1),this.spi.write(e),this.io_cs.output(!0)}write(e,t){0!=t.length&&(this.writeCommand(e),this.writeData(t))}async asyncwait(){return await this.spi.writeWait([0])}_writeFlush(){for(;this.writeBuffer.length>0;)if(this.writeBuffer.length>1024){let e=this.writeBuffer.slice(0,1024);this.writeData(e),this.writeBuffer.splice(0,1024)}else this.writeBuffer.length>0&&this.writeData(this.writeBuffer),this.writeBuffer=[]}_writeBuffer(e){e&&e.length>0?this.writeBuffer=this.writeBuffer.concat(e):this._writeFlush()}color16(e,t,i){return(248&e)<<8|(252&t)<<3|i>>3}_initG(){this.writeCommand(a),this.obniz.wait(120),this.write(g,[1,44,45]),this.write(y,[1,44,45]),this.write(_,[1,44,45,1,44,45]),this.write(w,[7]),this.write(v,[162,2,132]),this.write(b,[197]),this.write(C,[10,0]),this.write(x,[138,42]),this.write(S,[138,238]),this.write(A,[14]),this.write(O,[2,28,7,18,55,50,41,45,41,37,43,57,0,1,3,16]),this.write(I,[3,29,7,6,46,44,41,45,46,46,55,63,0,0,2,16]),this.write(m,[E])}init(){this._reset(),this._initG(),this.setDisplayOn(),this.setRotation(0)}setDisplayOn(){this.writeCommand(d)}setDisplayOff(){this.writeCommand(c)}setDisplay(e){1==e?this.setDisplayOn():this.setDisplayOff()}setInversionOn(){this.writeCommand(h)}setInversionOff(){this.writeCommand(o)}setInversion(e){1==e?this.setInversionOn():this.setInversionOff()}setRotation(e){let t;switch(e%4){case 0:t=[192],this.width=s,this.height=n;break;case 1:t=[160],this.width=n,this.height=s;break;case 2:t=[0],this.width=s,this.height=n;break;case 3:t=[96],this.width=n,this.height=s}this.write(f,t),this.setAddrWindow(0,0,this.width-1,this.height-1)}setAddrWindow(e,t,i,r){this.print_debug(`setAddrWindow: (x0: ${e}, y0: ${t}) - (x1: ${i}, y1: ${r})`),e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),r<0&&(r=0),this.write(u,[0,e,0,i]),this.write(l,[0,t,0,r]),this.writeCommand(p),this.writeBuffer=[]}fillScreen(e){this.fillRect(0,0,this.width,this.height,e)}fillRect(e,t,i,r,s){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),t+r-1>=this.height&&(r=this.height-t),this.setAddrWindow(e,t,e+i-1,t+r-1);let n=s>>8,a=255&s,o=[];for(t=r;t>0;t--)for(e=i;e>0;e--)o.push(n),o.push(a);this._writeBuffer(o),this._writeBuffer()}drawRect(e,t,i,r,s){this.drawHLine(e,t,i,s),this.drawHLine(e,t+r-1,i,s),this.drawVLine(e,t,r,s),this.drawVLine(e+i-1,t,r,s)}drawCircle(e,t,i,r){let s=1-i,n=1,a=-2*i,o=0,h=i;for(this.drawPixel(e,t+i,r),this.drawPixel(e,t-i,r),this.drawPixel(e+i,t,r),this.drawPixel(e-i,t,r);o<h;)s>=0&&(h--,s+=a+=2),o++,s+=n+=2,this.drawPixel(e+o,t+h,r),this.drawPixel(e-o,t+h,r),this.drawPixel(e+o,t-h,r),this.drawPixel(e-o,t-h,r),this.drawPixel(e+h,t+o,r),this.drawPixel(e-h,t+o,r),this.drawPixel(e+h,t-o,r),this.drawPixel(e-h,t-o,r)}_drawCircleHelper(e,t,i,r,s){let n=1-i,a=1,o=-2*i,h=0,c=i;for(;h<c;)n>=0&&(c--,n+=o+=2),h++,n+=a+=2,4&r&&(this.drawPixel(e+h,t+c,s),this.drawPixel(e+c,t+h,s)),2&r&&(this.drawPixel(e+h,t-c,s),this.drawPixel(e+c,t-h,s)),8&r&&(this.drawPixel(e-c,t+h,s),this.drawPixel(e-h,t+c,s)),1&r&&(this.drawPixel(e-c,t-h,s),this.drawPixel(e-h,t-c,s))}fillCircle(e,t,i,r){this.drawVLine(e,t-i,2*i+1,r),this._fillCircleHelper(e,t,i,3,0,r)}_fillCircleHelper(e,t,i,r,s,n){let a=1-i,o=1,h=-2*i,c=0,d=i;for(;c<d;)a>=0&&(d--,a+=h+=2),c++,a+=o+=2,1&r&&(this.drawVLine(e+c,t-d,2*d+1+s,n),this.drawVLine(e+d,t-c,2*c+1+s,n)),2&r&&(this.drawVLine(e-c,t-d,2*d+1+s,n),this.drawVLine(e-d,t-c,2*c+1+s,n))}drawRoundRect(e,t,i,r,s,n){this.drawHLine(e+s,t,i-2*s,n),this.drawHLine(e+s,t+r-1,i-2*s,n),this.drawVLine(e,t+s,r-2*s,n),this.drawVLine(e+i-1,t+s,r-2*s,n),this._drawCircleHelper(e+s,t+s,s,1,n),this._drawCircleHelper(e+i-s-1,t+s,s,2,n),this._drawCircleHelper(e+i-s-1,t+r-s-1,s,4,n),this._drawCircleHelper(e+s,t+r-s-1,s,8,n)}fillRoundRect(e,t,i,r,s,n){this.fillRect(e+s,t,i-2*s,r,n),this._fillCircleHelper(e+i-s-1,t+s,s,1,r-2*s-1,n),this._fillCircleHelper(e+s,t+s,s,2,r-2*s-1,n)}drawTriangle(e,t,i,r,s,n,a){this.drawLine(e,t,i,r,a),this.drawLine(i,r,s,n,a),this.drawLine(s,n,e,t,a)}fillTriangle(e,t,i,r,s,n,a){let o,h,c,d;if(t>r&&(r=[t,t=r][0],i=[e,e=i][0]),r>n&&(n=[r,r=n][0],s=[i,i=s][0]),t>r&&(r=[t,t=r][0],i=[e,e=i][0]),t==n)return i<(o=h=e)?o=i:i>h&&(h=i),s<o?o=s:s>h&&(h=s),void this.drawHLine(o,t,h-o+1,a);let u=i-e,l=r-t,p=s-e,m=n-t,f=s-i,g=n-r,y=0,_=0;for(d=r==n?r:r-1,c=t;c<=d;c++)o=e+Math.floor(y/l),h=e+Math.floor(_/m),y+=u,_+=p,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a);for(y=f*(c-r),_=p*(c-t);c<=n;c++)o=i+Math.floor(y/g),h=e+Math.floor(_/m),y+=f,_+=p,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a)}drawVLine(e,t,i,r){if(e>=this.width||t>=this.height)return;t+i-1>=this.height&&(i=this.height-t),this.setAddrWindow(e,t,e,t+i-1);let s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawHLine(e,t,i,r){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),this.setAddrWindow(e,t,e+i-1,t);let s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawLine(e,t,i,r,s){let n=Math.abs(r-t)>Math.abs(i-e);n&&(t=[e,e=t][0],r=[i,i=r][0]),e>i&&(i=[e,e=i][0],r=[t,t=r][0]);let a=i-e,o=Math.abs(r-t),h=a/2,c=t<r?1:-1;for(;e<=i;e++)n?this.drawPixel(t,e,s):this.drawPixel(e,t,s),(h-=o)<0&&(t+=c,h+=a)}drawPixel(e,t,i){e<0||e>=this.width||t<0||t>=this.height||(this.setAddrWindow(e,t,e+1,t+1),this.writeData([i>>8,255&i]))}drawChar(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;if(r!=s)return void this.drawChar2(e,t,i,r,s,n);let a=i.charCodeAt(0);for(let i=0;i<6;i++){let o=5==i?0:k[5*a+i];for(let a=0;a<8;a++)1&o?1==n?this.drawPixel(e+i,t+a,r):this.fillRect(e+i*n,t+a*n,n,n,r):s!=r&&(1==n?this.drawPixel(e+i,t+a,s):this.fillRect(e+i*n,t+a*n,n,n,s)),o>>=1}}drawChar2(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;let a=new Array(48*n*n),o=i.charCodeAt(0);for(let e=0;e<6;e++){let t=5==e?0:k[5*o+e];for(let i=0;i<8;i++){let o=1&t?r:s;for(let t=0;t<n;t++)for(let r=0;r<n;r++)a[e*(1*n)+t+(i*(6*n*n)+r*(6*n))]=o;t>>=1}}this.rawBound16(e,t,6*n,8*n,a)}rawBound16(e,t,i,r,s){let n=[];s.forEach((function(e){n.push((65280&e)>>8),n.push(255&e)})),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer()}drawString(e,t,i,r,s,n,a){n=n||1;for(let o=0;o<i.length;o++){let h=i.charAt(o);"\n"==h?(t+=8*n,e=0):"\r"==h||(this.drawChar(e,t,h,r,s,n),e+=6*n,a&&e>this.width-6*n&&(t+=8*n,e=0))}return[e,t]}drawContextBound(e,t,i,r,s,n,a,o){t=t||0,i=i||0,r=r||e.canvas.clientWidth,s=s||e.canvas.clientHeight,n=n||0,a=a||0,o=o||!1,this.write(m,[P]);let h=e.getImageData(t,i,r,s).data,c=[];for(let e=0;e<h.length;e+=4){let t=h[e+0],i=h[e+1],r=h[e+2];if(o){let e=Math.round(.299*t+.587*i+.114*r);c.push(e),c.push(e),c.push(e)}else c.push(t),c.push(i),c.push(r)}this.write(m,[P]),this.setAddrWindow(n,a,n+r-1,a+s-1),this._writeBuffer(c),this._writeBuffer(),this.write(m,[E])}drawContext(e,t){t=t||!1,this.drawContextBound(e,0,0,this.width,this.height,0,0,t)}rawBound(e,t,i,r,s){let n=[];s.forEach((function(e){n.push((16711680&e)>>16),n.push((65280&e)>>8),n.push(255&e)})),this.write(m,[P]),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer(),this.write(m,[E])}raw(e){this.raw(0,0,this.width,this.height,e)}_setPresetColor(){this.color={AliceBlue:63455,AntiqueWhite:65370,Aqua:2047,Aquamarine:32762,Azure:63487,Beige:63419,Bisque:65336,Black:0,BlanchedAlmond:65369,Blue:31,BlueViolet:35164,Brown:41285,BurlyWood:56784,CadetBlue:23796,Chartreuse:32736,Chocolate:54083,Coral:64490,CornflowerBlue:25789,Cornsilk:65499,Crimson:55463,Cyan:2047,DarkBlue:17,DarkCyan:1105,DarkGoldenRod:48161,DarkGray:44373,DarkGreen:800,DarkKhaki:48557,DarkMagenta:34833,DarkOliveGreen:21317,DarkOrange:64608,DarkOrchid:39321,DarkRed:34816,DarkSalmon:60591,DarkSeaGreen:36337,DarkSlateBlue:18929,DarkSlateGray:10857,DarkTurquoise:1658,DarkViolet:36890,DeepPink:63666,DeepSkyBlue:1535,DimGray:27469,DodgerBlue:7327,FireBrick:45316,FloralWhite:65502,ForestGreen:9284,Fuchsia:63519,Gainsboro:57083,GhostWhite:65503,Gold:65184,GoldenRod:56612,Gray:33808,Green:1024,GreenYellow:45029,HoneyDew:63486,HotPink:64342,IndianRed:51947,Indigo:18448,Ivory:65534,Khaki:63281,Lavender:59199,LavenderBlush:65438,LawnGreen:32736,LemonChiffon:65497,LightBlue:44764,LightCoral:62480,LightCyan:59391,LightGoldenRodYellow:65498,LightGray:54938,LightGreen:38770,LightPink:64952,LightSalmon:64783,LightSeaGreen:9621,LightSkyBlue:34431,LightSlateGray:29779,LightSteelBlue:46651,LightYellow:65532,Lime:2016,LimeGreen:13926,Linen:65436,Magenta:63519,Maroon:32768,MediumAquaMarine:26229,MediumBlue:25,MediumOrchid:47802,MediumPurple:37787,MediumSeaGreen:15758,MediumSlateBlue:31581,MediumSpringGreen:2003,MediumTurquoise:20121,MediumVioletRed:49328,MidnightBlue:6350,MintCream:63487,MistyRose:65340,Moccasin:65334,NavajoWhite:65269,Navy:16,OldLace:65468,Olive:33792,OliveDrab:27748,Orange:64800,OrangeRed:64032,Orchid:56218,PaleGoldenRod:61269,PaleGreen:40915,PaleTurquoise:44925,PaleVioletRed:56210,PapayaWhip:65402,PeachPuff:65239,Peru:52263,Pink:65049,Plum:56603,PowderBlue:46876,Purple:32784,RebeccaPurple:24979,Red:63488,RosyBrown:48241,RoyalBlue:17244,SaddleBrown:35362,Salmon:64526,SandyBrown:62764,SeaGreen:11338,SeaShell:65469,Sienna:41605,Silver:50712,SkyBlue:34429,SlateBlue:27353,SlateGray:29714,Snow:65503,SpringGreen:2031,SteelBlue:17430,Tan:54705,Teal:1040,Thistle:56827,Tomato:64264,Turquoise:18202,Violet:60445,Wheat:63222,White:65535,WhiteSmoke:63422,Yellow:65504,YellowGreen:40550}}}e.exports=r;const s=128,n=160,a=17,o=32,h=33,c=40,d=41,u=42,l=43,p=44,m=58,f=54,g=177,y=178,_=179,w=180,v=192,b=193,C=194,x=195,S=196,A=197,O=224,I=225,P=6,E=5,k=[0,0,0,0,0,62,91,79,91,62,62,107,79,107,62,28,62,124,62,28,24,60,126,60,24,28,87,125,87,28,28,94,127,94,28,0,24,60,24,0,255,231,195,231,255,0,24,36,24,0,255,231,219,231,255,48,72,58,6,14,38,41,121,41,38,64,127,5,5,7,64,127,5,37,63,90,60,231,60,90,127,62,28,28,8,8,28,28,62,127,20,34,127,34,20,95,95,0,95,95,6,9,127,1,127,0,102,137,149,106,96,96,96,96,96,148,162,255,162,148,8,4,126,4,8,16,32,126,32,16,8,8,42,28,8,8,28,42,8,8,30,16,16,16,16,12,30,12,30,12,48,56,62,56,48,6,14,62,14,6,0,0,0,0,0,0,0,95,0,0,0,7,0,7,0,20,127,20,127,20,36,42,127,42,18,35,19,8,100,98,54,73,86,32,80,0,8,7,3,0,0,28,34,65,0,0,65,34,28,0,42,28,127,28,42,8,8,62,8,8,0,128,112,48,0,8,8,8,8,8,0,0,96,96,0,32,16,8,4,2,62,81,73,69,62,0,66,127,64,0,114,73,73,73,70,33,65,73,77,51,24,20,18,127,16,39,69,69,69,57,60,74,73,73,49,65,33,17,9,7,54,73,73,73,54,70,73,73,41,30,0,0,20,0,0,0,64,52,0,0,0,8,20,34,65,20,20,20,20,20,0,65,34,20,8,2,1,89,9,6,62,65,93,89,78,124,18,17,18,124,127,73,73,73,54,62,65,65,65,34,127,65,65,65,62,127,73,73,73,65,127,9,9,9,1,62,65,65,81,115,127,8,8,8,127,0,65,127,65,0,32,64,65,63,1,127,8,20,34,65,127,64,64,64,64,127,2,28,2,127,127,4,8,16,127,62,65,65,65,62,127,9,9,9,6,62,65,81,33,94,127,9,25,41,70,38,73,73,73,50,3,1,127,1,3,63,64,64,64,63,31,32,64,32,31,63,64,56,64,63,99,20,8,20,99,3,4,120,4,3,97,89,73,77,67,0,127,65,65,65,2,4,8,16,32,0,65,65,65,127,4,2,1,2,4,64,64,64,64,64,0,3,7,8,0,32,84,84,120,64,127,40,68,68,56,56,68,68,68,40,56,68,68,40,127,56,84,84,84,24,0,8,126,9,2,24,164,164,156,120,127,8,4,4,120,0,68,125,64,0,32,64,64,61,0,127,16,40,68,0,0,65,127,64,0,124,4,120,4,120,124,8,4,4,120,56,68,68,68,56,252,24,36,36,24,24,36,36,24,252,124,8,4,4,8,72,84,84,84,36,4,4,63,68,36,60,64,64,32,124,28,32,64,32,28,60,64,48,64,60,68,40,16,40,68,76,144,144,144,124,68,100,84,76,68,0,8,54,65,0,0,0,119,0,0,0,65,54,8,0,2,1,2,4,2,60,38,35,38,60,30,161,161,97,18,58,64,64,32,122,56,84,84,85,89,33,85,85,121,65,33,84,84,120,65,33,85,84,120,64,32,84,85,121,64,12,30,82,114,18,57,85,85,85,89,57,84,84,84,89,57,85,84,84,88,0,0,69,124,65,0,2,69,125,66,0,1,69,124,64,240,41,36,41,240,240,40,37,40,240,124,84,85,69,0,32,84,84,124,84,124,10,9,127,73,50,73,73,73,50,50,72,72,72,50,50,74,72,72,48,58,65,65,33,122,58,66,64,32,120,0,157,160,160,125,57,68,68,68,57,61,64,64,64,61,60,36,255,36,36,72,126,73,67,102,43,47,252,47,43,255,9,41,246,32,192,136,126,9,3,32,84,84,121,65,0,0,68,125,65,48,72,72,74,50,56,64,64,34,122,0,122,10,10,114,125,13,25,49,125,38,41,41,47,40,38,41,41,41,38,48,72,77,64,32,56,8,8,8,8,8,8,8,8,56,47,16,200,172,186,47,16,40,52,250,0,0,123,0,0,8,20,42,20,34,34,20,42,20,8,170,0,85,0,170,170,85,170,85,170,0,0,0,255,0,16,16,16,255,0,20,20,20,255,0,16,16,255,0,255,16,16,240,16,240,20,20,20,252,0,20,20,247,0,255,0,0,255,0,255,20,20,244,4,252,20,20,23,16,31,16,16,31,16,31,20,20,20,31,0,16,16,16,240,0,0,0,0,31,16,16,16,16,31,16,16,16,16,240,16,0,0,0,255,16,16,16,16,16,16,16,16,16,255,16,0,0,0,255,20,0,0,255,0,255,0,0,31,16,23,0,0,252,4,244,20,20,23,16,23,20,20,244,4,244,0,0,255,0,247,20,20,20,20,20,20,20,247,0,247,20,20,20,23,20,16,16,31,16,31,20,20,20,244,20,16,16,240,16,240,0,0,31,16,31,0,0,0,31,20,0,0,0,252,20,0,0,240,16,240,16,16,255,16,255,20,20,20,255,20,16,16,16,31,0,0,0,0,240,16,255,255,255,255,255,240,240,240,240,240,255,255,255,0,0,0,0,0,255,255,15,15,15,15,15,56,68,68,56,68,124,42,42,62,20,126,2,2,6,6,2,126,2,126,2,99,85,73,65,99,56,68,68,60,4,64,126,32,30,32,6,2,126,2,2,153,165,231,165,153,28,42,73,42,28,76,114,1,114,76,48,74,77,77,48,48,72,120,72,48,188,98,90,70,61,62,73,73,73,0,126,1,1,1,126,42,42,42,42,42,68,68,95,68,68,64,81,74,68,64,64,68,74,81,64,0,0,255,1,3,224,128,255,0,0,8,8,107,107,8,54,18,54,36,54,6,15,9,15,6,0,0,24,24,0,0,0,16,16,0,48,64,255,1,1,0,31,1,1,30,0,25,29,23,18,0,60,60,60,60,0,0,0,0,0]},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","vcc_a","gnd_a","sclk","mosi","cs","disp","extcomin","extmode","width","height"],this.requiredKeys=["sclk","mosi","cs","width","height"],this.commands={},this.commands.write=128,this.commands.clear=32,this.commands.vcom=64,this._canvas=null,this._reset()}static info(){return{name:"SharpMemoryTFT"}}wired(e){this.obniz=e,this.io_cs=e.getIO(this.params.cs),this.params.disp&&this.params.extcomin&&this.params.extmode&&(this.io_disp=e.getIO(this.params.disp),this.io_extcomin=e.getIO(this.params.extcomin),this.io_extmode=e.getIO(this.params.extmode),this.io_disp.output(!0),this.io_extcomin.output(!1),this.io_extmode.output(!1)),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),e.setVccGnd(this.params.vcc_a,this.params.gnd_a,"5v"),this.params.mode="master",this.params.frequency=parseInt(1e6),this.params.clk=this.params.sclk,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params),this.width=this.params.width,this.height=this.params.height,this.obniz.wait(100)}_reverseBits(e){let t=0;for(let i=0;i<8;i++)t+=1&e,e>>=1,i<7&&(t<<=1);return t}sendLSB(e){this.spi.write([this._reverseBits(e)])}sendClear(){this.io_cs.output(!0),this.spi.write([0|this.commands.clear,0]),this.io_cs.output(!1)}raw(e){let t,i,r=this.width*this.height/8,s=new Array(1024),n=0;s[n++]=this.commands.write|this.commands.vcom,t=i=1,s[n++]=this._reverseBits(i),this.io_cs.output(!0);for(let a=0;a<r;a++)s[n++]=e[a],(i=parseInt((a+1)/(this.width/8)+1,10))!=t&&(s[n++]=0,i<=this.height&&(s[n++]=this._reverseBits(i)),t=i),n>=1021&&(this.spi.write(s.slice(0,n)),s=new Array(1024),n=0);n>0&&this.spi.write(s.slice(0,n)),this.spi.write([0]),this.io_cs.output(!1)}_reset(){this._pos={x:0,y:0},this.autoFlush=!0}warnCanvasAvailability(){throw this.obniz.isNode?new Error("MemoryDisplay require node-canvas to draw rich contents. see more detail on docs"):new Error("MemoryDisplay cant create canvas element to body")}_preparedCanvas(){if(this._canvas)return this._canvas;if(this.obniz.isNode)try{const{createCanvas:e}=i(11);this._canvas=e(this.width,this.height)}catch(e){return null}else{const e="MemoryDispCanvas-"+this.obniz.id;let t=document.getElementById(e);if(!t){(t=document.createElement("canvas")).setAttribute("id",e),t.style.visibility="hidden",t.width=this.width,t.height=this.height,t.style["-webkit-font-smoothing"]="none",document.getElementsByTagName("body")[0].appendChild(t)}this._canvas=t}const e=this._canvas.getContext("2d");return e.fillStyle="#FFF",e.fillRect(0,0,this.width,this.height),e.fillStyle="#000",e.strokeStyle="#000",this._pos.x=0,this._pos.y=0,this.fontSize=16,e.font=`${this.fontSize}px Arial`,this._canvas}_ctx(){const e=this._preparedCanvas();if(e)return e.getContext("2d")}font(e,t){const i=this._ctx();"number"!=typeof t&&(t=16),"string"!=typeof e&&(e="Arial"),this.fontSize=t,i.font=t+"px "+e}clear(){const e=this._ctx();this._pos.x=0,this._pos.y=0,e?(e.fillStyle="#fff",e.fillRect(0,0,this.width,this.height),e.fillStyle="#000",e.strokeStyle="#000",this.draw(e)):this.sendClear()}pos(e,t){return this._ctx(),"number"==typeof e&&(this._pos.x=e),"number"==typeof t&&(this._pos.y=t),this._pos}print(e){const t=this._ctx();t&&(t.fillText(e,this._pos.x,this._pos.y+this.fontSize),this.draw(t),this._pos.y+=this.fontSize)}line(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.moveTo(e,t),s.lineTo(i,r),s.stroke(),this.draw(s)):this.warnCanvasAvailability()}rect(e,t,i,r,s){const n=this._ctx();n?(s?n.fillRect(e,t,i,r):n.strokeRect(e,t,i,r),this.draw(n)):this.warnCanvasAvailability()}circle(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.arc(e,t,i,0,2*Math.PI),r?s.fill():s.stroke(),this.draw(s)):this.warnCanvasAvailability()}_draw(e){const t=this.width/8;let i=new Array(64*t);const r=e.getImageData(0,0,this.width,this.height).data;for(let e=0;e<r.length;e+=4){let s=.34*r[e]+.5*r[e+1]+.16*r[e+2],n=parseInt(e/4),a=parseInt(n/this.width),o=parseInt((n-a*this.width)/8),h=parseInt(n-a*this.width)%8;0==h&&(i[a*t+o]=0),s>115&&(i[a*t+o]|=128>>h)}this.raw(i)}draw(e){this.autoFlush&&this._draw(e)}drawing(e){this.autoFlush=1==e;const t=this._ctx();t&&this.draw(t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"],this.displayIoNames={vcc:"vcc",gnd:"gnd",signal:"signal"},this._unit="mm"}static info(){return{name:"GP2Y0A21YK0F"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_signal=e.getIO(this.params.signal),this.io_signal.end(),this.ad_signal=e.getAD(this.params.signal)}start(e){this.ad_signal.start(t=>{let i=this._volt2distance(t);"function"==typeof e&&e(i)})}_volt2distance(e){e<=0&&(e=.001);let t=19988.34*Math.pow(e/5*1024,-1.25214)*10;return"mm"===this._unit?t=parseInt(10*t)/10:(t*=.0393701,t=parseInt(1e3*t)/1e3),t}getWait(){return new Promise(async e=>{let t=await this.ad_signal.getWait();e(this._volt2distance(t))})}unit(e){if("mm"===e)this._unit="mm";else{if("inch"!==e)throw new Error("unknown unit "+e);this._unit="inch"}}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","trigger","echo","gnd"],this.requiredKeys=["vcc","trigger","echo"],this._unit="mm",this.reset_alltime=!1,this.temp=15}static info(){return{name:"HC-SR04"}}wired(e){this.obniz=e,e.setVccGnd(null,this.params.gnd,"5v"),this.vccIO=e.getIO(this.params.vcc),this.trigger=this.params.trigger,this.echo=this.params.echo,this.vccIO.drive("5v"),this.vccIO.output(!0),this.obniz.wait(100)}measure(e){let t=this;this.obniz.measure.echo({io_pulse:this.trigger,io_echo:this.echo,pulse:"positive",pulse_width:.011,measure_edges:3,timeout:10/340*1e3,callback:async i=>{this.reset_alltime&&(this.vccIO.output(!1),this.obniz.wait(100),this.vccIO.output(!0),this.obniz.wait(100));let r=void 0;for(let e=0;e<i.length-1;e++)if(!0===i[e].edge){r=(i[e+1].timing-i[e].timing)/1e3/2*20.055*Math.sqrt(this.temp+273.15)*1e3,"inch"===t._unit&&(r*=.0393701)}"function"==typeof e&&e(r)}})}async measureWait(){return new Promise(e=>{this.measure(t=>{e(t)})})}unit(e){if("mm"===e)this._unit="mm";else{if("inch"!==e)throw new Error("HCSR04: unknown unit "+e);this._unit="inch"}}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","txd","rxd","gnd","Opps"],this.requiredKeys=["txd","rxd"],this.ioKeys=this.keys,this.displayName="gps",this.displayIoNames={txd:"txd",rxd:"rxd",Opps:"1pps"}}static info(){return{name:"GYSFDMAXB"}}wired(e){this.obniz=e,this.tx=this.params.txd,this.rx=this.params.rxd,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.Opps=this.params.Opps,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.txd,rx:this.params.rxd,baud:9600,drive:"3v"}),this.editedData={},this.editedData.enable=!1,this.editedData.GPGSV=new Array(4),this.on1pps=null,this.last1pps=0,this.gpsInfo={},this.gpsInfo._sentenceType={GPGGA:1,GPGSA:2,GPGSV:4,GPRMC:8,GPVTG:16,GPZDA:32},this.gpsInfo.status="V",this.gpsInfo.sentences=new Set,this.gpsInfo.satelliteInfo={satellites:[],inView:0}}start1pps(e){this.on1pps=e,e?(this.last1pps=2,this.obniz.getAD(this.Opps).self=this,this.obniz.getAD(this.Opps).start((function(e){let t=Math.round(e);t!=this.self.last1pps&&(this.self.last1pps=t,0==t&&this.self.on1pps&&this.self.on1pps())}))):this.obniz.getAD(this.Opps).end()}readSentence(){let e=[];if(this.uart.isDataExists()){let t=this.uart.received.indexOf(10);if(t>=0)return e=this.uart.received.slice(0,t-1),this.uart.received.splice(0,t+1),this.uart.tryConvertString(e)}return""}getEditedData(){let e,t,i,r=this.readSentence();for(this.editedData.enable=!1,this.editedData.GPGSV=new Array(4);r.length>0;){let s=r.split(",");if(","!=r.slice(-4,-3)){let e=s[s.length-1].slice(0,-3);s.push(s[s.length-1].slice(-3)),s[s.length-2]=e}switch(this.editedData.sentence=s.join(","),s[0]){case"$GPGGA":this.editedData.GPGGA=s;break;case"$GPGLL":this.editedData.GPGLL=s;break;case"$GPGSA":this.editedData.GPGSA=s;break;case"$GPGSV":if((e=Number(s[2]))>this.editedData.GPGSV.length)for(;e>this.editedData.GPGSV.length;)this.editedData.GPGSV.push([]);this.editedData.GPGSV[e-1]=s;break;case"$GPRMC":this.editedData.GPRMC=s;break;case"$GPVTG":this.editedData.GPVTG=s;break;case"$GPZDA":this.editedData.GPZDA=s,t=s[4]+"/"+s[3]+"/"+s[2]+" "+s[1].substring(0,2)+":"+s[1].substring(2,4)+":"+s[1].substring(4,6)+" +00:00",this.editedData.timestamp=new Date(t);break;default:i=s[0].substr(1),this.editedData[i]=s}this.editedData.enable=!0,r=this.readSentence()}return this.editedData}getGpsInfo(e){if(e=e||this.getEditedData(),this.gpsInfo.status="V",e.enable){if(e.GPGGA){const t=e.GPGGA;this.gpsInfo.gpsQuality=parseFloat(t[6]),this.gpsInfo.hdop=parseFloat(t[8]),this.gpsInfo.altitude=parseFloat(t[9]);const i=this.nmea2dd(parseFloat(t[2]));this.gpsInfo.latitude="N"==t[3]?i:-i;const r=this.nmea2dd(parseFloat(t[4]));this.gpsInfo.longitude="E"==t[5]?r:-r,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA)}if(e.GPGSV)for(let t=0;t<e.GPGSV.length;t++)if(e.GPGSV[t]){const i=e.GPGSV[t].map(e=>parseFloat(e)),r=i[1],s=i[2],n=i[3];if(s>r)continue;this.gpsInfo.satelliteInfo.inView=n;let a=4*(s-1);a=a+4>n?n-a:4;for(let e=0;e<a;++e){const t=4*(s-1)+e;this.gpsInfo.satelliteInfo.satellites.length<=t&&this.gpsInfo.satelliteInfo.satellites.push({});const r=4*e;this.gpsInfo.satelliteInfo.satellites[t]={id:i[r+4],elevation:i[r+5],azimuth:i[r+6],snr:i[r+7],inUse:!1}}this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV)}if(e.GPGSA){const t=e.GPGSA;let i=0;this.gpsInfo.fixMode=parseFloat(t[2]),this.gpsInfo.pdop=parseFloat(t[15]),this.gpsInfo.hdop=parseFloat(t[16]),this.gpsInfo.vdop=parseFloat(t[17]);for(let e=0;e<12;++e)for(let r=0;r<this.gpsInfo.satelliteInfo.inView;++r)this.gpsInfo.satelliteInfo.satellites[r]&&t[e+3]==this.gpsInfo.satelliteInfo.satellites[r].id&&(this.gpsInfo.satelliteInfo.satellites[r].inUse=!0,i++);this.gpsInfo.satelliteInfo.inUse=i,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA)}if(e.GPRMC){const t=e.GPRMC;this.gpsInfo.status=t[2];const i=this.nmea2dd(parseFloat(t[3]));this.gpsInfo.latitude="N"==t[4]?i:-i;const r=this.nmea2dd(parseFloat(t[5]));this.gpsInfo.longitude="E"==t[6]?r:-r;const s=1.852;this.gpsInfo.speed=parseFloat(t[7])*s,this.gpsInfo.direction=t[8],this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC)}if(e.GPVTG){const t=e.GPVTG;this.gpsInfo.direction=parseFloat(t[1]),this.gpsInfo.declination=parseFloat(t[3]),this.gpsInfo.speed=parseFloat(t[7]),this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG)}e.GPZDA&&(this.gpsInfo.utc=e.timestamp,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA))}return this.gpsInfo}get latitude(){return this.nmea2dd(this._latitude)}get longitude(){return this.nmea2dd(this._longitude)}_mneaTo(e,t){let i=this.nmea2dd(t);if("string"==typeof e)switch(e.toUpperCase()){case"DMS":i=this.nmea2dms(t);break;case"DM":i=this.nmea2dm(t);break;case"S":i=this.nmea2s(t)}return i}latitudeTo(e){return this._mneaTo(e,this._latitude)}longitudeTo(e){return this._mneaTo(e,this._longitude)}status2string(e){return"A"==(e=e||this.status)?"Active":"V"==e?"Void":e}fixMode2string(e){return 1==(e=e||this.fixMode)?"Fix not available":2==e?"2D":3==e?"3D":e}gpsQuality2string(e){return 0==(e=e||this.gpsQuality)?"Invalid":1==e?"GPS fix":2==e?"DGPS fix":e}nmea2dms(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t));return t+"°"+i+"'"+(60*(100*(e/100-t)-i)).toFixed(1)+'"'}nmea2dm(e){e=parseFloat(e);let t=Math.floor(e/100);return t+"°"+(100*(e/100-t)).toFixed(4)+"'"}nmea2dd(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return parseFloat((t+i+60*(100*(e/100-t)-i)/3600).toFixed(6))}nmea2s(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return(t+i+60*(100*(e/100-t)-i)/3600)/(1/60/60)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ135"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ2"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ3"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ4"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ5"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ6"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ7"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ8"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[],this.onchangeanalog=void 0,this.onchangedigital=void 0,this.onexceedvoltage=void 0,this.voltageLimit=void 0}static info(){return{name:"MQ9"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","sda","scl"],this.requiredKeys=["sda","scl"],this.ioKeys=this.keys,this.displayName="3axis",this.displayIoNames={sda:"sda",scl:"scl"},this.address=83,this.regAdrs={},this.regAdrs.POWER_CTL=45,this.regAdrs.THRESH_ACT=36,this.regAdrs.THRESH_INACT=37,this.regAdrs.TIME_INACT=38,this.regAdrs.ACT_INACT_CTL=39,this.regAdrs.TAP_AXES=42,this.regAdrs.THRESH_TAP=29,this.regAdrs.DUR=33,this.regAdrs.LATENT=34,this.regAdrs.WINDOW=35,this.regAdrs.THRESH_FF=40,this.regAdrs.TIME_FF=41,this.regAdrs.INT_MAP=47,this.regAdrs.INT_ENABLE=46,this.regAdrs.DATAX0=50,this.regAdrs.INT_DATA_READY_BIT=7,this.regAdrs.INT_SINGLE_TAP_BIT=6,this.regAdrs.INT_DOUBLE_TAP_BIT=5,this.regAdrs.INT_ACTIVITY_BIT=4,this.regAdrs.INT_INACTIVITY_BIT=3,this.regAdrs.INT_FREE_FALL_BIT=2,this.regAdrs.INT_WATERMARK_BIT=1,this.regAdrs.INT_OVERRUNY_BIT=0,this.constVal={},this.constVal.gainX=.0037639,this.constVal.gainY=.00376009,this.constVal.gainZ=.00349265,this.constVal.INT1_PIN=0,this.constVal.INT2_PIN=1}static info(){return{name:"Grove_3AxisAccelerometer"}}async wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=4e5,this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(100),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,0]),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,16]),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,8]),this.i2c.write(this.address,[this.regAdrs.THRESH_ACT,75]),this.i2c.write(this.address,[this.regAdrs.THRESH_INACT,75]),this.i2c.write(this.address,[this.regAdrs.THRESH_INACT,10]),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,6,1),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,5,1),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,4,1),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,2,1),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,1,1),await this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,0,1),await this.setRegisterBit(this.regAdrs.TAP_AXES,2,0),await this.setRegisterBit(this.regAdrs.TAP_AXES,1,0),await this.etRegisterBit(this.regAdrs.TAP_AXES,0,1),this.i2c.write(this.address,[this.regAdrs.THRESH_TAP,50]),this.i2c.write(this.address,[this.regAdrs.DUR,15]),this.i2c.write(this.address,[this.regAdrs.LATENT,80]),this.i2c.write(this.address,[this.regAdrs.WINDOW,200]),this.i2c.write(this.address,[this.regAdrs.THRESH_FF,7]),this.i2c.write(this.address,[this.regAdrs.TIME_FF,45]),await this.setInterruptMapping(this.regAdrs.INT_SINGLE_TAP_BIT,this.constVal.INT1_PIN),await this.setInterruptMapping(this.regAdrs.INT_DOUBLE_TAP_BIT,this.constVal.INT1_PIN),await this.setInterruptMapping(this.regAdrs.INT_FREE_FALL_BIT,this.constVal.INT1_PIN),await this.setInterruptMapping(this.regAdrs.INT_ACTIVITY_BIT,this.constVal.INT1_PIN),await this.setInterruptMapping(this.regAdrs.INT_INACTIVITY_BIT,this.constVal.INT1_PIN),await this.setInterrupt(this.regAdrs.INT_SINGLE_TAP_BIT,1),await this.setInterrupt(this.regAdrs.INT_DOUBLE_TAP_BIT,1),await this.setInterrupt(this.regAdrs.INT_FREE_FALL_BIT,1),await this.setInterrupt(this.regAdrs.INT_ACTIVITY_BIT,1),await this.setInterrupt(this.regAdrs.INT_INACTIVITY_BIT,1)}async setRegisterBit(e,t,i){this.i2c.write(this.address,[e]);let r=await this.i2c.readWait(this.address,1);i?r|=1<<t:r&=~(1<<t),this.i2c.write(this.address,[r])}async setInterruptMapping(e,t){await this.setRegisterBit(this.regAdrs.INT_MAP,e,t)}async setInterrupt(e,t){await this.setRegisterBit(this.regAdrs.INT_ENABLE,e,t)}signHandling(e){return e>>15&&(e=-(65535-e)),e}async getRawVal(){this.i2c.write(this.address,[this.regAdrs.DATAX0]);let e=await this.i2c.readWait(this.address,6),t=[0,0,0];return t[0]=this.signHandling(e[1]<<8|e[0]),t[1]=this.signHandling(e[3]<<8|e[2]),t[2]=this.signHandling(e[5]<<8|e[4]),t}async getWait(){let e=[0,0,0],t=await this.getRawVal();return e[0]=t[0]*this.constVal.gainX,e[1]=t[1]*this.constVal.gainY,e[2]=t[2]*this.constVal.gainZ,e}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["vcc","gnd"],this.displayIoNames={vcc:"vcc",gnd:"gnd",signal:"signal"},this.interval=5,this.duration=2500}static info(){return{name:"Grove_EarHeartRate"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v")}start(e){this.obniz.logicAnalyzer.start({io:this.params.signal,interval:this.interval,duration:this.duration}),this.obniz.logicAnalyzer.onmeasured=t=>{let i=[];for(let e=0;e<t.length-1;e++)0===t[e]&&1===t[e+1]&&i.push(e);if(i.length>=2){let t=0,r=0;t=(i[1]-i[0])*this.interval/1e3,e(r=60/t)}}}getWait(){return new Promise(e=>{this.start(t=>{e(t)})})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["tx","rx","vcc","gnd"],this.requiredKeys=["tx","rx"],this.ioKeys=this.keys,this.displayName="gps",this.displayIoNames={tx:"tx",rx:"rx"}}static info(){return{name:"Grove_GPS"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:9600}),this.editedData={},this.editedData.enable=!1,this.editedData.GPGSV=new Array(4),this.gpsInfo={},this.gpsInfo._sentenceType={GPGGA:1,GPGSA:2,GPGSV:4,GPRMC:8,GPVTG:16,GPZDA:32},this.gpsInfo.status="V",this.gpsInfo.sentences=new Set,this.gpsInfo.satelliteInfo={satellites:[],inView:0}}readSentence(){let e=[];if(this.uart.isDataExists()){let t=this.uart.received.indexOf(10);if(t>=0)return e=this.uart.received.slice(0,t-1),this.uart.received.splice(0,t+1),this.uart.tryConvertString(e)}return""}getEditedData(){let e,t,i,r=this.readSentence();for(this.editedData.enable=!1,this.editedData.GPGSV=new Array(4);r.length>0;){let s=r.split(",");if(","!=r.slice(-4,-3)){let e=s[s.length-1].slice(0,-3);s.push(s[s.length-1].slice(-3)),s[s.length-2]=e}switch(this.editedData.sentence=s.join(","),s[0]){case"$GPGGA":this.editedData.GPGGA=s;break;case"$GPGLL":this.editedData.GPGLL=s;break;case"$GPGSA":this.editedData.GPGSA=s;break;case"$GPGSV":if((e=Number(s[2]))>this.editedData.GPGSV.length)for(;e>this.editedData.GPGSV.length;)this.editedData.GPGSV.push([]);this.editedData.GPGSV[e-1]=s;break;case"$GPRMC":this.editedData.GPRMC=s;break;case"$GPVTG":this.editedData.GPVTG=s;break;case"$GPZDA":this.editedData.GPZDA=s,t=s[4]+"/"+s[3]+"/"+s[2]+" "+s[1].substring(0,2)+":"+s[1].substring(2,4)+":"+s[1].substring(4,6)+" +00:00",this.editedData.timestamp=new Date(t);break;default:i=s[0].substr(1),this.editedData[i]=s}this.editedData.enable=!0,r=this.readSentence()}return this.editedData}getGpsInfo(e){if(e=e||this.getEditedData(),this.gpsInfo.status="V",e.enable){if(e.GPGGA){const t=e.GPGGA;this.gpsInfo.gpsQuality=parseFloat(t[6]),this.gpsInfo.hdop=parseFloat(t[8]),this.gpsInfo.altitude=parseFloat(t[9]);const i=this.nmea2dd(parseFloat(t[2]));this.gpsInfo.latitude="N"==t[3]?i:-i;const r=this.nmea2dd(parseFloat(t[4]));this.gpsInfo.longitude="E"==t[5]?r:-r,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA)}if(e.GPGSV)for(let t=0;t<e.GPGSV.length;t++)if(e.GPGSV[t]){const i=e.GPGSV[t].map(e=>parseFloat(e)),r=i[1],s=i[2],n=i[3];if(s>r)continue;this.gpsInfo.satelliteInfo.inView=n;let a=4*(s-1);a=a+4>n?n-a:4;for(let e=0;e<a;++e){const t=4*(s-1)+e;this.gpsInfo.satelliteInfo.satellites.length<=t&&this.gpsInfo.satelliteInfo.satellites.push({});const r=4*e;this.gpsInfo.satelliteInfo.satellites[t]={id:i[r+4],elevation:i[r+5],azimuth:i[r+6],snr:i[r+7],inUse:!1}}this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV)}if(e.GPGSA){const t=e.GPGSA;let i=0;this.gpsInfo.fixMode=parseFloat(t[2]),this.gpsInfo.pdop=parseFloat(t[15]),this.gpsInfo.hdop=parseFloat(t[16]),this.gpsInfo.vdop=parseFloat(t[17]);for(let e=0;e<12;++e)for(let r=0;r<this.gpsInfo.satelliteInfo.inView;++r)this.gpsInfo.satelliteInfo.satellites[r]&&t[e+3]==this.gpsInfo.satelliteInfo.satellites[r].id&&(this.gpsInfo.satelliteInfo.satellites[r].inUse=!0,i++);this.gpsInfo.satelliteInfo.inUse=i,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA)}if(e.GPRMC){const t=e.GPRMC;this.gpsInfo.status=t[2];const i=this.nmea2dd(parseFloat(t[3]));this.gpsInfo.latitude="N"==t[4]?i:-i;const r=this.nmea2dd(parseFloat(t[5]));this.gpsInfo.longitude="E"==t[6]?r:-r;const s=1.852;this.gpsInfo.speed=parseFloat(t[7])*s,this.gpsInfo.direction=t[8],this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC)}if(e.GPVTG){const t=e.GPVTG;this.gpsInfo.direction=parseFloat(t[1]),this.gpsInfo.declination=parseFloat(t[3]),this.gpsInfo.speed=parseFloat(t[7]),this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG)}e.GPZDA&&(this.gpsInfo.utc=e.timestamp,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA))}return this.gpsInfo}get latitude(){return this.nmea2dd(this._latitude)}get longitude(){return this.nmea2dd(this._longitude)}_mneaTo(e,t){let i=this.nmea2dd(t);if("string"==typeof e)switch(e.toUpperCase()){case"DMS":i=this.nmea2dms(t);break;case"DM":i=this.nmea2dm(t);break;case"S":i=this.nmea2s(t)}return i}latitudeTo(e){return this._mneaTo(e,this._latitude)}longitudeTo(e){return this._mneaTo(e,this._longitude)}status2string(e){return"A"==(e=e||this.status)?"Active":"V"==e?"Void":e}fixMode2string(e){return 1==(e=e||this.fixMode)?"Fix not available":2==e?"2D":3==e?"3D":e}gpsQuality2string(e){return 0==(e=e||this.gpsQuality)?"Invalid":1==e?"GPS fix":2==e?"DGPS fix":e}nmea2dms(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t));return t+"°"+i+"'"+(60*(100*(e/100-t)-i)).toFixed(1)+'"'}nmea2dm(e){e=parseFloat(e);let t=Math.floor(e/100);return t+"°"+(100*(e/100-t)).toFixed(4)+"'"}nmea2dd(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return parseFloat((t+i+60*(100*(e/100-t)-i)/3600).toFixed(6))}nmea2s(e){e=parseFloat(e);let t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return(t+i+60*(100*(e/100-t)-i)/3600)/(1/60/60)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","mp3_rx","mp3_tx"],this.requiredKeys=["mp3_rx","mp3_tx"],this.ioKeys=this.keys,this.displayName="MP3",this.displayIoNames={mp3_rx:"MP3Rx",mp3_tx:"MP3Tx"}}static info(){return{name:"Grove_MP3"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.my_tx=this.params.mp3_rx,this.my_rx=this.params.mp3_tx,this.uart=this.obniz.getFreeUart()}async initWait(e){this.uart.start({tx:this.my_tx,rx:this.my_rx,baud:9600}),await this.obniz.wait(100),this.uartSend(12,0),await this.obniz.wait(500),this.uartSend(11,0),await this.obniz.wait(100),e?"usb"==e?this.uartSend(9,1):"sd"==e&&this.uartSend(9,2):this.uartSend(9,2),await this.obniz.wait(200)}setVolume(e){e>=0&&e<=31&&this.uartSend(6,e)}volUp(){this.uartSend(4,0)}volDown(){this.uartSend(5,0)}play(e,t){t?this.uart.send([126,255,6,15,0,t,e,239]):this.uartSend(18,e)}stop(){this.uartSend(22,0)}pause(){this.uartSend(14,0)}resume(){this.uartSend(13,0)}next(){this.uartSend(1,0)}prev(){this.uartSend(2,0)}uartSend(e,t){let i=t>>8,r=255&t;return this.uart.send([126,255,6,e,1,i,r,239]),this.uart.readBytes()}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","out1","out2","gnd"],this.required=["out1","out2"],this.Sens=67e-5}static info(){return{name:"ENC03R_Module"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad0=e.getAD(this.params.out1),this.ad1=e.getAD(this.params.out2),this.ad0.start(e=>{this.sens1=(e-1.45)/this.Sens,this.onchange1&&this.onchange1(this.sens1)}),this.ad1.start(e=>{this.sens2=(e-1.35)/this.Sens,this.onchange2&&this.onchange2(this.sens2)})}get1Wait(){return new Promise(async e=>{let t=this.ad0.getWait();this.sens1=(t-1.45)/this.Sens,e(this.sens1)})}get2Wait(){return new Promise(async e=>{let t=this.ad1.getWait();this.sens2=(t-1.35)/this.Sens,e(this.sens2)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["recv","vcc","send","gnd"],this.requiredKeys=["recv","send"]}static info(){return{name:"IRModule"}}wired(e){if(this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),!e.isValidIO(this.params.recv))throw new Error("recv is not valid io");if(!e.isValidIO(this.params.send))throw new Error("send is not valid io");this.sensor=e.wired("IRSensor",{output:this.params.recv}),this.setGetterSetter("sensor","duration"),this.setGetterSetter("sensor","dataInverted"),this.setGetterSetter("sensor","cutTail"),this.setGetterSetter("sensor","output_pullup"),this.setGetterSetter("sensor","ondetect"),this.led=e.wired("InfraredLED",{anode:this.params.send})}send(e){this.led.send(e)}start(e){this.sensor.start(e)}get dataSymbolLength(){return this.sensor.dataSymbolLength}set dataSymbolLength(e){this.sensor.dataSymbolLength=e,this.led.dataSymbolLength=e}setGetterSetter(e,t){Object.defineProperty(this,t,{get(){return this[e][t]},set(i){this[e][t]=i}})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["output","vcc","gnd"],this.requiredKeys=["output"],this.dataSymbolLength=.07,this.duration=500,this.dataInverted=!0,this.triggerSampleCount=16,this.cutTail=!1,this.output_pullup=!0}static info(){return{name:"IRSensor"}}wired(e){if(this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),!e.isValidIO(this.params.output))throw new Error("output is not valid io")}start(e){this.ondetect=e,this.output_pullup&&this.obniz.getIO(this.params.output).pull("5v"),this.obniz.logicAnalyzer.start({io:this.params.output,interval:this.dataSymbolLength,duration:this.duration,triggerValue:!this.dataInverted,triggerValueSamples:this.triggerSampleCount}),this.obniz.logicAnalyzer.onmeasured=e=>{if("function"==typeof this.ondetect){if(this.dataInverted){let t=new Uint8Array(e);for(let e=0;e<t.length;e++)t[e]=t[e]?0:1;e=Array.from(t)}if(this.cutTail)for(let t=e.length-1;t>1&&(0===e[t]&&0===e[t-1]);t--)e.splice(t,1);this.ondetect(e)}}}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["anode","cathode"],this.requiredKeys=["anode"],this.dataSymbolLength=.07}static info(){return{name:"InfraredLED"}}wired(e){if(this.obniz=e,!this.obniz.isValidIO(this.params.anode))throw new Error("anode is not valid io");if(this.params.cathode){if(!this.obniz.isValidIO(this.params.cathode))throw new Error("cathode is not valid io");this.io_cathode=e.getIO(this.params.cathode),this.io_cathode.output(!1)}this.pwm=this.obniz.getFreePwm(),this.pwm.start({io:this.params.anode}),this.pwm.freq(38e3),this.obniz.wait(150)}send(e){e&&e.length>0&&1===e[e.length-1]&&e.push(0),this.pwm.modulate("am",this.dataSymbolLength,e)}}e.exports=r},function(e,t,i){class r{constructor(){this.COMMON_TYPE_ANODE=1,this.COMMON_TYPE_CATHODE=0,this.anode_keys=["anode","anode_common","anodeCommon","vcc"],this.cathode_keys=["cathode","cathode_common","cathodeCommon","gnd"],this.animationName="FullColorLED-"+Math.round(1e3*Math.random()),this.keys=["r","g","b","common","commonType"],this.requiredKeys=["r","g","b","common","commonType"]}static info(){return{name:"FullColorLED"}}wired(e){let t=this.params.r,i=this.params.g,r=this.params.b,s=this.params.common,n=this.params.commonType;this.obniz=e,this.anode_keys.includes(n)?this.commontype=this.COMMON_TYPE_ANODE:this.cathode_keys.includes(n)?this.commontype=this.COMMON_TYPE_CATHODE:this.obniz.error("FullColorLED param need common type [  anode_common or cathode_common ] "),this.common=this.obniz.getIO(s),this.common.output(this.commontype),this.obniz.getIO(t).output(this.commontype),this.obniz.getIO(i).output(this.commontype),this.obniz.getIO(r).output(this.commontype),this.pwmR=this.obniz.getFreePwm(),this.pwmR.start({io:t}),this.pwmR.freq(1e3),this.pwmG=this.obniz.getFreePwm(),this.pwmG.start({io:i}),this.pwmG.freq(1e3),this.pwmB=this.obniz.getFreePwm(),this.pwmB.start({io:r}),this.pwmB.freq(1e3),this.rgb(0,0,0)}rgb(e,t,i){e=Math.min(Math.max(parseInt(e),0),255),t=Math.min(Math.max(parseInt(t),0),255),i=Math.min(Math.max(parseInt(i),0),255),this.commontype===this.COMMON_TYPE_ANODE&&(e=255-e,t=255-t,i=255-i),this.pwmR.duty(e/255*100),this.pwmG.duty(t/255*100),this.pwmB.duty(i/255*100)}hsv(e,t,i){let r,s,n,a=i*t,o=e/60,h=a*(1-Math.abs(o%2-1));0<=o&&o<1&&([r,s,n]=[a,h,0]),1<=o&&o<2&&([r,s,n]=[h,a,0]),2<=o&&o<3&&([r,s,n]=[0,a,h]),3<=o&&o<4&&([r,s,n]=[0,h,a]),4<=o&&o<5&&([r,s,n]=[h,0,a]),5<=o&&o<6&&([r,s,n]=[a,0,h]);let c=i-a;[r,s,n]=[r+c,s+c,n+c],r=Math.floor(255*r),s=Math.floor(255*s),n=Math.floor(255*n),this.rgb(r,s,n)}gradation(e){let t=[],i=Math.round(e/18);for(let e=0;e<18;e++){let e={duration:i,state:function(e){this.hsv(10*e*2,1,1)}.bind(this)};t.push(e)}this.obniz.io.animation(this.animationName,"loop",t)}stopgradation(){this.obniz.io.animation(this.animationName,"pause")}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["anode","cathode"],this.requiredKeys=["anode"]}static info(){return{name:"LED"}}wired(e){function t(t){return t&&"object"==typeof t&&"function"==typeof t.output?t:e.getIO(t)}this.obniz=e,this.io_anode=t(this.params.anode),this.io_anode.output(!1),this.obniz.isValidIO(this.params.cathode)&&(this.io_cathode=t(this.params.cathode),this.io_cathode.output(!1)),this.animationName="Led-"+this.params.anode}on(){this.endBlink(),this.io_anode.output(!0)}off(){this.endBlink(),this.io_anode.output(!1)}output(e){e?this.on():this.off()}endBlink(){this.obniz.io.animation(this.animationName,"pause")}blink(e){e||(e=100);let t=[{duration:e,state:function(e){this.io_anode.output(!0)}.bind(this)},{duration:e,state:function(e){this.io_anode.output(!1)}.bind(this)}];this.obniz.io.animation(this.animationName,"loop",t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2811"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=2e6,this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}static _generateFromByte(e){e=parseInt(e);let t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?224:128,r|=e&128>>i+1?14:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(e);return s=(s=s.concat(r._generateFromByte(t))).concat(r._generateFromByte(i))}static _generateHsvColor(e,t,i){let s,n,a,o=i*t,h=e/60,c=o*(1-Math.abs(h%2-1));0<=h&&h<1&&([s,n,a]=[o,c,0]),1<=h&&h<2&&([s,n,a]=[c,o,0]),2<=h&&h<3&&([s,n,a]=[0,o,c]),3<=h&&h<4&&([s,n,a]=[0,c,o]),4<=h&&h<5&&([s,n,a]=[c,0,o]),5<=h&&h<6&&([s,n,a]=[o,0,c]);let d=i-o;[s,n,a]=[s+d,n+d,a+d],s=Math.floor(255*s),n=Math.floor(255*n),a=Math.floor(255*a);let u=r._generateFromByte(s);return u=(u=u.concat(r._generateFromByte(n))).concat(r._generateFromByte(a))}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2812"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=parseInt(333e4),this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}static _generateFromByte(e){e=parseInt(e);let t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?192:128,r|=e&128>>i+1?12:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(t);return s=(s=s.concat(r._generateFromByte(e))).concat(r._generateFromByte(i))}static _generateHsvColor(e,t,i){let s,n,a,o=i*t,h=e/60,c=o*(1-Math.abs(h%2-1));0<=h&&h<1&&([s,n,a]=[o,c,0]),1<=h&&h<2&&([s,n,a]=[c,o,0]),2<=h&&h<3&&([s,n,a]=[0,o,c]),3<=h&&h<4&&([s,n,a]=[0,c,o]),4<=h&&h<5&&([s,n,a]=[c,0,o]),5<=h&&h<6&&([s,n,a]=[o,0,c]);let d=i-o;return[s,n,a]=[s+d,n+d,a+d],s=Math.floor(255*s),n=Math.floor(255*n),a=Math.floor(255*a),r._generateColor(s,n,a)}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2812B"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=parseInt(333e4),this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}static _generateFromByte(e){e=parseInt(e);let t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?224:128,r|=e&128>>i+1?14:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(t);return s=(s=s.concat(r._generateFromByte(e))).concat(r._generateFromByte(i))}static _generateHsvColor(e,t,i){let s,n,a,o=i*t,h=e/60,c=o*(1-Math.abs(h%2-1));0<=h&&h<1&&([s,n,a]=[o,c,0]),1<=h&&h<2&&([s,n,a]=[c,o,0]),2<=h&&h<3&&([s,n,a]=[0,o,c]),3<=h&&h<4&&([s,n,a]=[0,c,o]),4<=h&&h<5&&([s,n,a]=[c,0,o]),5<=h&&h<6&&([s,n,a]=[o,0,c]);let d=i-o;return[s,n,a]=[s+d,n+d,a+d],s=Math.floor(255*s),n=Math.floor(255*n),a=Math.floor(255*a),r._generateColor(s,n,a)}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","ser","srclk","rclk","oe","srclr","io_num","enabled"],this.requiredKeys=["ser","srclk","rclk"],this.autoFlash=!0}static info(){return{name:"SNx4HC595"}}wired(e){this.obniz=e,this.io_ser=this.obniz.getIO(this.params.ser),this.io_srclk=this.obniz.getIO(this.params.srclk),this.io_rclk=this.obniz.getIO(this.params.rclk),this.io_ser.output(!1),this.io_srclk.output(!1),this.io_rclk.output(!1),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.obniz.isValidIO(this.params.srclr)&&(this.io_srclr=this.obniz.getIO(this.params.srclr),this.io_srclr.output(!0)),this.obniz.isValidIO(this.params.oe)&&(this.io_oe=this.obniz.getIO(this.params.oe),this.io_oe.output(!0)),(this.obniz.isValidIO(this.params.vcc)||this.obniz.isValidIO(this.params.gnd))&&this.obniz.wait(100),"number"!=typeof this.params.io_num&&(this.params.io_num=8),this.ioNum(this.params.io_num),"boolean"!=typeof this.params.enabled&&(this.params.enabled=!0),this.io_oe&&this.params.enabled&&this.io_oe.output(!1)}ioNum(e){class t{constructor(e,t){this.chip=e,this.id=t,this.value=0}output(e){this.chip.output(this.id,e)}}if("number"!=typeof e||this._io_num===e)throw new Error("io num should be a number");this._io_num=e,this.io=[];for(let i=0;i<e;i++)this.io.push(new t(this,i));this.flush()}isValidIO(e){return"number"==typeof e&&e>=0&&e<this._io_num}getIO(e){if(!this.isValidIO(e))throw new Error("io "+e+" is not valid io");return this.io[e]}output(e,t){t=1==t,this.io[e].value=t,this.autoFlash&&this.flush()}onece(e){if("function"!=typeof e)throw new Error("please provide function");const t=this.autoFlash;this.autoFlash=!1,e(),this.flush(),this.autoFlash=t}setEnable(e){if(!this.io_oe&&0==e)throw new Error('pin "oe" is not specified');this.io_oe.output(!e)}flush(){this.io_rclk.output(!1);for(let e=this.io.length-1;e>=0;e--)this.io_ser.output(this.io[e].value),this.io_srclk.output(!0),this.io_srclk.output(!1);this.io_rclk.output(!0)}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=["address"],this.keys=["sda","scl","clock","pull","i2c","address"]}static info(){return{name:"24LC256"}}wired(e){this.params.mode=this.params.mode||"master",this.params.clock=this.params.clock||4e5,this.i2c=e.getI2CWithConfig(this.params)}set(e,t){let i=[];i.push(e>>8&255),i.push(255&e),i.push.apply(i,t),this.i2c.write(80,i),this.obniz.wait(5)}async getWait(e,t){let i=[];return i.push(e>>8&255),i.push(255&e),this.i2c.write(80,i),await this.i2c.readWait(80,t)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","sda","scl","i2c","address","adb_cycle"],this.required=[]}static info(){return{name:"AK8963"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this._address=this.params.address||12,this.i2c=e.getI2CWithConfig(this.params),this.setConfig(this.params.adc_cycle||8)}setConfig(e){switch(e){case 8:this.i2c.write(this._address,[10,18]);break;case 100:this.i2c.write(this._address,[10,22]);break;default:throw new Error("ADC_cycle variable 8,100 setting")}this._adc_cycle=e}async getWait(){this.i2c.write(this._address,[3]);let e=await this.i2c.readWait(this._address,7);return{x:this.char2short(e[0],e[1]),y:this.char2short(e[2],e[3]),z:this.char2short(e[4],e[5])}}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["signal","gnd"],this.requiredKeys=["signal"],this.onChangeForStateWait=function(){}}static info(){return{name:"Button"}}wired(e){this.io_signal=e.getIO(this.params.signal),e.isValidIO(this.params.gnd)&&(this.io_supply=e.getIO(this.params.gnd),this.io_supply.output(!1)),this.io_signal.pull("5v");let t=this;this.io_signal.input((function(e){t.isPressed=!1===e,t.onchange&&t.onchange(!1===e),t.onChangeForStateWait(!1===e)}))}async isPressedWait(){return!1===await this.io_signal.inputWait()}stateWait(e){return new Promise((t,i)=>{this.onChangeForStateWait=i=>{e==i&&(this.onChangeForStateWait=function(){},t())}})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","sda","scl","reset","ts","led1","led2"],this.requiredKeys=["gnd","sda","scl","reset","ts"],this.displayIoNames={sda:"sda",scl:"scl",gnd:"gnd",reset:"reset",ts:"ts"}}static info(){return{name:"FlickHat"}}wired(e){this.obniz=e,this.address=66,this.obniz.isValidIO(this.params.vcc)&&(this.obniz.getIO(this.params.vcc).drive("5v"),this.obniz.getIO(this.params.vcc).output(!0)),this.obniz.getIO(this.params.gnd).output(!1),this.io_reset=this.obniz.getIO(this.params.reset),this.io_reset.drive("3v"),this.io_ts=this.obniz.getIO(this.params.ts),this.io_ts.drive("open-drain"),this.io_ts.pull("3v"),this.params.mode="master",this.params.pull="3v",this.params.clock=1e5,this.i2c=this.obniz.getI2CWithConfig(this.params),this.obniz.isValidIO(this.params.led1)&&(this.led1=this.obniz.wired("LED",{anode:this.params.led1})),this.obniz.isValidIO(this.params.led2)&&(this.led2=this.obniz.wired("LED",{anode:this.params.led2}))}async start(e){this.io_ts.pull("3v"),this.io_reset.output(!1),await this.obniz.wait(50),this.io_reset.output(!0),await this.obniz.wait(50),this.onfwinfo=e,this.fwInfo={fwValid:0,fwInfoReceived:!1},this.rotation=0,this.lastRotation=0,this.readSize=132,await this.polling(),await this.obniz.wait(200),this.i2c.write(this.address,[16,0,0,162,161,0,0,0,31,0,0,0,255,255,255,255]),await this.obniz.wait(100),this.i2c.write(this.address,[16,0,0,162,128,0,0,0,63,0,0,0,63,0,0,0])}_dataArray2string(e){let t="";for(let i of e)t+=String.fromCharCode(i);return t}async polling(e){e=e||3e3;let t=new Date,i=!0;for(;i&&new Date-t<e;)i=await this.io_ts.inputWait();if(!i){this.io_ts.pull("0v");let e=await this.i2c.readWait(this.address,this.readSize),t=e[0],i=e[2],r=e[3];if(255!=t&&t>0){let s,n,a,o,h,c,d;switch((this.debugprint||this.obniz.debugprint)&&console.log("flickHat: "+e.slice(0,t).map(e=>"0x"+e.toString(16))),r){case 145:if(s=e[4]|e[5]<<8,n=e[7],a=e.slice(10,14),o=e.slice(14,18),h=e.slice(18,20),255==a[0]&&255==a[1]&&255==a[2]&&255==a[3])break;if(16&s&&1&n){let t={x:(e[20]|e[21]<<8)/65536,y:(e[22]|e[23]<<8)/65536,z:(e[24]|e[25]<<8)/65536,seq:i};this.xyz=t,"function"==typeof this.onxyz&&this.onxyz(t)}if(2&s&&a[0]>0){this.lastGesture=a[0];const e=[["","",""],["garbage","",""],["flick","west","east"],["flick","east","west"],["flick","south","north"],["flick","north","south"],["circle","clockwise",""],["circle","counter-clockwise",""][""],["wave","y",""],["hold","",""]];for(let t in e)t==a[0]&&"function"==typeof this.ongestureall&&this.ongestureall({action:e[t][0],from:e[t][1],to:e[t][2],raw:a,seq:i}),t==a[0]&&"flick"==e[t][0]&&"function"==typeof this.ongesture&&this.ongesture({action:"gesture",from:e[t][1],to:e[t][2],raw:a,seq:i})}if(4&s&&(0!=o[0]||0!=o[1])&&0==o[3]){let e=o[0]|o[1]<<8;if(65535==e)break;const t=[["touch","south"],["touch","west"],["touch","north"],["touch","east"],["touch","center"],["tap","south"],["tap","west"],["tap","north"],["tap","east"],["tap","center"],["doubletap","south"],["doubletap","west"],["doubletap","north"],["doubletap","east"],["doubletap","center"]];let r=[],s=[],n=[];this.lastTouch=e;let a=1;for(let i in t){let o=t[i];if(e&a)switch(o[0]){case"touch":r.push(o[1]);break;case"tap":s.push(o[1]);break;case"doubletap":n.push(o[1])}a<<=1}r.length>0&&"function"==typeof this.ontouch&&this.ontouch({action:"touch",positions:r,raw:o,seq:i}),s.length>0&&"function"==typeof this.ontap&&this.ontap({action:"tap",positions:s,raw:o,seq:i}),n.length>0&&"function"==typeof this.ondoubletap&&this.ondoubletap({action:"doubletap",positions:n,raw:o,seq:i})}if(8&s&&2&n){let e=(h[0]-this.lastRotation)/32;this.rotation+=360*e,this.rotation%=360,0!=e&&e>-.5&&e<.5&&"function"==typeof this.onairwheel&&this.onairwheel({delta:360*e,rotation:this.rotation,raw:h,seq:i}),this.lastRotation=h[0]}break;case 21:c={msgId:e[4],maxCmdSize:e[5],error:e[6]|e[7]<<8},this.statusInfo=c,(this.debugprint||this.obniz.debugprint)&&console.log(`flickHat: system status: {msgId: ${c.msgId}, maxCmdSize: ${c.maxCmdSize}, error: ${c.error}}`);break;case 131:d={fwValid:170==e[4],hwRev:[e[5],e[6]],paramStartAddr:128*e[7],libLoaderVer:[e[8],e[9]],libLoaderPlatform:e[10],fwStartAddr:128*e[11],fwVersion:this._dataArray2string(e.slice(12,132)).split("\0")[0],fwInfoReceived:!0},this.fwInfo=d,"function"==typeof this.onfwinfo&&this.onfwinfo(d),this.readSize=26;break;default:console.error(`unknown message: 0x${r.toString(16)}, data:${e.slice(0,t).map(e=>"0x"+e.toString(16))}`)}}this.io_ts.pull("3v")}}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"HC-SR505"}}wired(e){this.obniz=e,this.io_signal=e.getIO(this.params.signal),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_signal.input(e=>{this.onchange&&this.onchange(e)})}getWait(){return this.io_signal.inputWait()}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["sw","y","x","vcc","gnd","i2c"],this.requiredKeys=["sw","y","x"],this.pins=this.keys||["sw","y","x","vcc","gnd"],this.pinname={sw:"sw12"},this.shortName="joyS"}static info(){return{name:"JoyStick"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_sig_sw=e.getIO(this.params.sw),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.io_sig_sw.pull("5v");let t=this;this.ad_x.start((function(e){t.positionX=e/5,t.onchangex&&t.onchangex(2*t.positionX-1)})),this.ad_y.start((function(e){t.positionY=e/5,t.onchangey&&t.onchangey(2*t.positionY-1)})),this.io_sig_sw.input((function(e){t.isPressed=!1===e,t.onchangesw&&t.onchangesw(!1===e)}))}async isPressedWait(){return!1===await this.io_sig_sw.inputWait()}async getXWait(){let e=await this.ad_x.getWait();return this.positionX=e/5,2*this.positionX-1}async getYWait(){let e=await this.ad_y.getWait();return this.positionY=e/5,2*this.positionY-1}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["x","y","z","vcc","gnd","enable","self_test"],this.requiredKeys=["x","y","z"]}static info(){return{name:"KXR94-2050"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.ad_z=e.getAD(this.params.z),e.isValidIO(this.params.enable)&&(e.getIO(this.params.enable).drive("5v"),e.getIO(this.params.enable).output(!0),e.display.setPinName(this.params.enable,"KXR94_2050","E")),e.isValidIO(this.params.self_test)&&(e.getIO(this.params.self_test).drive("5v"),e.getIO(this.params.self_test).output(!1),e.display.setPinName(this.params.self_test,"KXR94_2050","T")),this.changeVccVoltage(5),this.ad_x.start(e=>{this._x_val=e,this.onChangeX&&this.onChangeX(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.ad_y.start(e=>{this._y_val=e,this.onChangeY&&this.onChangeY(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.ad_z.start(e=>{this._z_val=e,this.onChangeZ&&this.onChangeZ(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.obniz.isValidIO(this.params.vcc)&&this.obniz.getAD(this.params.vcc).start(e=>{this.changeVccVoltage(e)}),e.display.setPinName(this.params.x,"KXR94_2050","x"),e.display.setPinName(this.params.y,"KXR94_2050","y"),e.display.setPinName(this.params.z,"KXR94_2050","z"),this.obniz.isValidIO(this.params.vcc)&&e.display.setPinName(this.params.vcc,"KXR94_2050","vcc")}changeVccVoltage(e){this.sensitivity=e/5,this.offsetVoltage=e/2}voltage2gravity(e){return(e-this.offsetVoltage)/this.sensitivity}get(){return this._get()}_get(){return{x:this.voltage2gravity(this._x_val),y:this.voltage2gravity(this._y_val),z:this.voltage2gravity(this._z_val)}}async getWait(){return this._x_val=await this.ad_x.getWait(),this._y_val=await this.ad_y.getWait(),this._z_val=await this.ad_z.getWait(),this._get()}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["x","y","z","vcc","gnd"],this.requiredKeys=["x","y","z"]}static info(){return{name:"KXSC7-2050"}}async wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"3v"),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.ad_z=e.getAD(this.params.z),await e.wait(500);let t=e.getAD(this.params.vcc),i=await t.getWait(),r=await this.ad_z.getWait(),s=i/5,n=r-s,a=this;this.ad_x.start((function(e){a.gravity=(e-n)/s,a.onchangex&&a.onchangex(a.gravity)})),this.ad_y.start((function(e){a.gravity=(e-n)/s,a.onchangey&&a.onchangey(a.gravity)})),this.ad_z.start((function(e){a.gravity=(e-n)/s,a.onchangez&&a.onchangez(a.gravity)}))}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","sda","scl","i2c","address","accelerometer_range","gyroscope_range"],this.required=[]}static info(){return{name:"MPU6050"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this._address=this.params.address||104,this.i2c=e.getI2CWithConfig(this.params),this.setConfig(this.params.accelerometer_range||2,this.params.gyroscope_range||250)}setConfig(e,t){switch(e){case 2:this.i2c.write(this._address,[28,0]);break;case 4:this.i2c.write(this._address,[28,8]);break;case 8:this.i2c.write(this._address,[28,16]);break;case 16:this.i2c.write(this._address,[28,24]);break;default:throw new Error("accel_range variable 2,4,8,16 setting")}switch(t){case 250:this.i2c.write(this._address,[27,0]);break;case 500:this.i2c.write(this._address,[27,8]);break;case 1e3:this.i2c.write(this._address,[27,16]);break;case 2e3:this.i2c.write(this._address,[27,24]);break;default:throw new Error("accel_range variable 250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}async getWait(){this.i2c.write(this._address,[59]);let e=await this.i2c.readWait(this._address,14),t=this._accel_range/32768,i=this._gyro_range/32768;return{accelerometer:{x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},temp:this.char2short(e[6],e[7])/333.87+21,gyroscope:{x:this.char2short(e[8],e[9])*i,y:this.char2short(e[10],e[11])*i,z:this.char2short(e[12],e[13])*i}}}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}}e.exports=r},function(e,t,i){const r=i(10);class s extends r{static info(){return{name:"MPU6886"}}constructor(){super(),this.commands={},this.commands.whoami=117,this.commands.accelIntelCtrl=105,this.commands.smplrtDiv=25,this.commands.intPinCfg=55,this.commands.intEnable=56,this.commands.accelXoutH=59,this.commands.accelXoutL=60,this.commands.accelYoutH=61,this.commands.accelYoutL=62,this.commands.accelZoutH=63,this.commands.accelZoutL=64,this.commands.tempOutH=65,this.commands.tempOutL=66,this.commands.gyroXoutH=67,this.commands.gyroXoutL=68,this.commands.gyroYoutH=69,this.commands.gyroYoutL=70,this.commands.gyroZoutH=71,this.commands.gyroZoutL=72,this.commands.userCtrl=106,this.commands.pwrMgmt1=107,this.commands.pwrMgmt2=108,this.commands.config=26,this.commands.gyroConfig=27,this.commands.accelConfig=28,this.commands.accelConfig2=29,this.commands.fifoEn=35}wired(e){super.wired(e),this.init()}i2cInfo(){return{address:104,clock:1e5,voltage:"3v"}}whoamiWait(){return this.readWait(this.commands.whoami,1)[0]}init(){this.write(this.commands.pwrMgmt1,0),this.obniz.wait(10),this.write(this.commands.pwrMgmt1,128),this.obniz.wait(10),this.write(this.commands.pwrMgmt1,1),this.obniz.wait(10),this.setConfig(this.params.accelerometer_range||2,this.params.gyroscope_range||250),this.obniz.wait(1),this.write(this.commands.config,1),this.obniz.wait(1),this.write(this.commands.smplrtDiv,5),this.obniz.wait(1),this.write(this.commands.intEnable,0),this.obniz.wait(1),this.write(this.commands.accelConfig2,0),this.obniz.wait(1),this.write(this.commands.userCtrl,0),this.obniz.wait(1),this.write(this.commands.fifoEn,0),this.obniz.wait(1),this.write(this.commands.intPinCfg,34),this.obniz.wait(1),this.write(this.commands.intEnable,1),this.obniz.wait(1)}setConfig(e,t){switch(e){case 2:this.write(this.commands.accelConfig,0);break;case 4:this.write(this.commands.accelConfig,8);break;case 8:this.write(this.commands.accelConfig,16);break;case 16:this.write(this.commands.accelConfig,24);break;default:throw new Error("accel_range variable 2,4,8,16 setting")}switch(t){case 250:this.write(this.commands.gyroConfig,0);break;case 500:this.write(this.commands.gyroConfig,8);break;case 1e3:this.write(this.commands.gyroConfig,16);break;case 2e3:this.write(this.commands.gyroConfig,24);break;default:throw new Error("accel_range variable 250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}async getAllDataWait(){let e=await this.readWait(this.commands.accelXoutH,14),t=this._accel_range/32768,i=this._gyro_range/32768;return{accelerometer:{x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},temperature:this.char2short(e[6],e[7])/326.8+25,gyroscope:{x:this.char2short(e[8],e[9])*i,y:this.char2short(e[10],e[11])*i,z:this.char2short(e[12],e[13])*i}}}async getTempWait(){return(await this.getAllDataWait()).temperature}async getAccelWait(){return(await this.getAllDataWait()).accelerometer}async getGyroWait(){return(await this.getAllDataWait()).gyroscope}}e.exports=s},function(e,t,i){class r{constructor(e){this.keys=["gnd","vcc","sda","scl","i2c","address"],this.required=[]}static info(){return{name:"MPU9250"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this._address=this.params.address||104,this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.i2c.write(this._address,[107,0]),this.i2c.write(this._address,[55,2]),this.i2c.write(this._address,[26,6]),this.i2c.write(this._address,[29,2]),this.mpu6050=e.wired("MPU6050",{i2c:this.i2c}),this.ak8963=e.wired("AK8963",{i2c:this.i2c})}setConfig(e,t,i){this.mpu6050.setConfig(e,t),this.ak8963.setConfig(i)}async _getAK8963Wait(){return await this.i2c.write(this._address,[2]),1&await this.i2c.readWait(this._address,1)?await this.ak8963.getWait():{}}async getAllWait(){let e=await this.mpu6050.getWait();return e.compass=await this.ak8963.getWait(),e}async getCompassWait(){return await this.ak8963.getWait()}async getAccelerometerWait(){return(await this.mpu6050.getWait()).accelerometer}async getGyroscopeWait(){return(await this.mpu6050.getWait()).gyroscope}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"PaPIRsVZ"}}wired(e){this.obniz=e,this.io_signal=e.getIO(this.params.signal),this.io_signal.pull("0v"),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_signal.input(e=>{this.onchange&&this.onchange(e)})}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["pin0","pin1","pin2"],this.requiredKeys=["pin0","pin1","pin2"],this.vcc_voltage=5}static info(){return{name:"Potentiometer"}}wired(e){this.obniz.setVccGnd(this.params.pin0,this.params.pin2,"5v"),this.ad=e.getAD(this.params.pin1);let t=this;e.getAD(this.params.pin0).start((function(e){t.vcc_voltage=e})),this.ad.start((function(e){t.position=e/t.vcc_voltage,t.onchange&&t.onchange(t.position)}))}}e.exports=r},function(e,t,i){const r=i(10);class s extends r{static info(){return{name:"SH200Q"}}constructor(){super(),this.commands={},this.commands.whoami=48,this.commands.accConfig=14,this.commands.gyroConfig=15,this.commands.gyroDlpf=17,this.commands.fifoConfig=18,this.commands.accRange=22,this.commands.gyroRange=43,this.commands.outputAcc=0,this.commands.outputGyro=6,this.commands.outputTemp=12,this.commands.regSet1=186,this.commands.regSet2=202,this.commands.adcReset=194,this.commands.softReset=127,this.commands.reset=117}wired(e){super.wired(e)}i2cInfo(){return{address:108,clock:1e5,voltage:"3v"}}whoamiWait(){return this.readWait(this.commands.whoami,1)[0]}async initWait(){await this.resetAdcWait(),await this.writeFlagWait(216,7),await this.obniz.wait(1),await this.clearFlagWait(216,7),await this.write(120,97),await this.obniz.wait(1),await this.write(120,0),await this.write(this.commands.accConfig,145),await this.write(this.commands.gyroConfig,19),await this.write(this.commands.gyroDlpf,3),await this.write(this.commands.fifoConfig,0),this.setConfig(8,2e3),await this.write(this.commands.regSet1,192),await this.writeFlagWait(this.commands.regSet2,4),await this.obniz.wait(1),await this.clearFlagWait(this.commands.regSet2,4),await this.obniz.wait(10)}setConfig(e,t){switch(e){case 4:this.write(this.commands.accRange,0);break;case 8:this.write(this.commands.accRange,1);break;case 16:this.write(this.commands.accRange,16);break;default:throw new Error("accel_range variable 4,8,16 setting")}switch(t){case 125:this.write(this.commands.gyroRange,4);break;case 250:this.write(this.commands.gyroRange,3);break;case 500:this.write(this.commands.gyroRange,2);break;case 1e3:this.write(this.commands.gyroRange,1);break;case 2e3:this.write(this.commands.gyroRange,0);break;default:throw new Error("gyroscope_range variable 125,250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}async resetAdcWait(){let e=await this.readWait(this.commands.adcReset,1);e[0]=4|e[0],this.write(this.commands.adcReset,e),await this.obniz.wait(1),e[0]=251&e[0],this.write(this.commands.adcReset,e)}async getAllDataWait(){let e=await this.readWait(this.commands.outputAcc,14),t=this._accel_range/32768,i=this._gyro_range/32768;const r={x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},s={x:this.char2short(e[6],e[7])*i,y:this.char2short(e[8],e[9])*i,z:this.char2short(e[10],e[11])*i};return{accelerometer:r,temperature:this.char2short(e[12],e[13])/333.87+21,gyroscope:s}}async getTempWait(){let e=await this.readWait(this.commands.outputTemp,2);return this.char2short(e[1],e[0])/333.87+21}async getAccelWait(){return(await this.getAllDataWait()).accelerometer}async getGyroWait(){return(await this.getAllDataWait()).gyroscope}}e.exports=s},function(e,t,i){class r{constructor(){this.keys=["forward","back"],this.requiredKeys=["forward","back"]}static info(){return{name:"DCMotor"}}wired(e){this.status={direction:null,power:null},this.pwm1_io_num=this.params.forward,this.pwm2_io_num=this.params.back,this.pwm1=e.getFreePwm(),this.pwm1.start({io:this.pwm1_io_num}),this.pwm1.freq(1e5),this.pwm2=e.getFreePwm(),this.pwm2.start({io:this.pwm2_io_num}),this.pwm2.freq(1e5),this.power(30)}forward(){this.move(!0)}reverse(){this.move(!1)}stop(){null!==this.status.direction&&(this.status.direction=null,this.pwm1.duty(0),this.pwm2.duty(0))}move(e){if(e){if(!0===this.status.direction)return;this.status.direction=!0}else{if(!1===this.status.direction)return;this.status.direction=!1}let t=this.power();this.power(0),this.power(t)}power(e){return void 0===e?this.status.power:(this.status.power=e,null===this.status.direction?(this.pwm1.duty(0),void this.pwm2.duty(0)):void(this.status.direction?(this.pwm1.duty(e),this.pwm2.duty(0)):(this.pwm1.duty(0),this.pwm2.duty(e))))}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","scl","sda","oe","i2c","enabled","address","drive"],this.requiredKeys=[],this.address=64,this._commands={MODE1:0,MODE2:1,SUBADR1:2,SUBADR2:3,SUBADR3:4,PRESCALE:254,LED0_ON_L:6,ALL_LED_ON_L:250,bits:{ALLCALL:1,SLEEP_ENABLE:16,AUTO_INCREMENT_ENABLED:32,RESTART:128,OUTDRV:4,INVRT:16}},this._regs=new Array(1),this.pwmNum=16,this.pwms=[],this._preparePWM(this.pwmNum)}static info(){return{name:"PCA9685"}}wired(e){this.obniz=e,e.isValidIO(this.params.oe)&&(this.io_oe=e.getIO(this.params.oe)),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),"number"==typeof this.params.address&&(this.address=this.params.address),this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params),this.obniz.isValidIO(this.params.srclr)&&(this.io_srclr=this.obniz.getIO(this.params.srclr),this.io_srclr.output(!0)),"boolean"!=typeof this.params.enabled&&(this.params.enabled=!0),this.io_oe&&this.params.enabled&&this.io_oe.output(!1),"open-drain"===this.params.drive&&this.i2c.write(this.address,[this._commands.MODE2,this._commands.bits.OUTDRV]);let t=this._commands.bits.AUTO_INCREMENT_ENABLED;t&=~this._commands.bits.SLEEP_ENABLE,this.i2c.write(this.address,[this._commands.MODE1,t]),this.i2c.write(this.address,[this._commands.MODE1,t|this._commands.bits.RESTART]),this._regs[this._commands.MODE1]=t,e.wait(10)}_preparePWM(e){class t{constructor(e,t){this.chip=e,this.id=t,this.value=0,this.state={}}freq(e){this.chip.freq(e)}pulse(e){this.chip.pulse(this.id,e)}duty(e){this.chip.duty(this.id,e)}}for(let i=0;i<e;i++)this.pwms.push(new t(this,i))}isValidPWM(e){return"number"==typeof e&&e>=0&&e<this.pwmNum}getPWM(e){if(!this.isValidPWM(e))throw new Error("pwm "+e+" is not valid pwm");return this.pwms[e]}freq(e){if("number"!=typeof e)return;if(e<24||1526<e)throw new Error("freq must be within 24-1526 hz");if(this._freq===e)return;let t=25e6;t/=4096,t/=.9*e,t-=1;const i=parseInt(Math.floor(t+.5)),r=this._regs[this._commands.MODE1];this.i2c.write(this.address,[this._commands.MODE1,127&r|this._commands.bits.SLEEP_ENABLE]),this.i2c.write(this.address,[this._commands.PRESCALE,i]),this.i2c.write(this.address,[this._commands.MODE1,r]),this.obniz.wait(5),this._freq=e;for(let e=0;e<this.pwms.length;e++)this.pwms[e].state.freq=this._freq}pulse(e,t){if("number"!=typeof this._freq||this._freq<=0)throw new Error("please provide freq first.");this.duty(e,t/1e3/(1/this._freq)*100)}duty(e,t){if(t*=1,"number"!=typeof this._freq||this._freq<=0)throw new Error("please provide freq first.");if("number"!=typeof t)throw new Error("please provide duty in number");t<0&&(t=0),t>100&&(t=100),this.getPWM(e).state.duty=t,this.writeSingleONOFF(e,0,t/100*4095)}writeSingleONOFF(e,t,i){this.i2c.write(this.address,[this._commands.LED0_ON_L+4*e,255&t,t>>8,255&i,i>>8])}setEnable(e){if(!this.io_oe&&0==e)throw new Error('pin "oe" is not specified');this.io_oe.output(!e)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","vcc","signal","pwm"],this.requiredKeys=[],this.range={min:.5,max:2.4}}static info(){return{name:"ServoMotor"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),e.isValidIO(this.params.vcc)&&(this.io_vcc=e.getIO(this.params.vcc)),this.params.pwm?this.pwm=this.params.pwm:(this.pwm=e.getFreePwm(),this.pwm_io_num=this.params.signal,this.pwm.start({io:this.pwm_io_num})),this.pwm.freq(50)}angle(e){let t=this.range.max,i=this.range.min,r=(t-i)*e/180+i;this.pwm.pulse(r)}on(){this.io_vcc&&this.io_vcc.output(!0)}off(){this.io_vcc&&this.io_vcc.output(!1)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"Solenoid"}}wired(e){this.obniz=e,e.isValidIO(this.params.gnd)&&(this.io_gnd=e.getIO(this.params.gnd),this.io_gnd.output(!1)),this.io_signal=e.getIO(this.params.signal),this.io_signal.output(!1)}on(){this.io_signal.output(!0)}off(){this.io_signal.output(!1)}click(e){this.on(),"number"!=typeof e&&(e=100),this.obniz.wait(e),this.off()}doubleClick(e){"number"!=typeof e&&(e=100),this.click(e),this.obniz.wait(e),this.click(e)}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["a","b","aa","bb","common"],this.requiredKeys=["a","b","aa","bb"],this._stepInstructions={1:[[0,1,1,1],[1,0,1,1],[1,1,0,1],[1,1,1,0]],2:[[0,0,1,1],[1,0,0,1],[1,1,0,0],[0,1,1,0]],"1-2":[[0,1,1,1],[0,0,1,1],[1,0,1,1],[1,0,0,1],[1,1,0,1],[1,1,0,0],[1,1,1,0],[0,1,1,0]]},this.type=void 0,this.currentStep=0,this._stepType="2",this.frequency=100,this.rotationStepCount=100,this.milliMeterStepCount=1}static info(){return{name:"StepperMotor"}}wired(e){this.obniz=e,e.isValidIO(this.params.common)?(this.common=e.getIO(this.params.common),this.common.output(!0),this.type="unipolar"):this.type="bipolar",this.ios=[],this.ios.push(e.getIO(this.params.a)),this.ios.push(e.getIO(this.params.b)),this.ios.push(e.getIO(this.params.aa)),this.ios.push(e.getIO(this.params.bb))}async stepWait(e){if("number"!=typeof e)throw new Error("must provide number");if(0==(e=Math.round(e)))return;const t=Math.abs(e),i=this._getStepInstructions(),r=i.length;let s=[],n=this.currentStep%r;if(n<0&&(n=r- -1*n),e>0)for(let e=0;e<i.length;e++)++n>=r&&(n=0),s.push(i[n]);else for(let e=0;e<i.length;e++)--n<0&&(n=r-1),s.push(i[n]);let a=1e3/this.frequency;(a=parseInt(a))<1&&(a=1);const o=e=>{const t=s[e];for(let e=0;e<this.ios.length;e++)this.ios[e].output(t[e])};let h=[];for(let e=0;e<r;e++)h.push({duration:a,state:o});await this.obniz.io.repeatWait(h,t),this.currentStep+=e}async stepToWait(e){const t=e-this.currentStep;await this.stepWait(t)}async holdWait(){const e=this._getStepInstructions(),t=e.length;let i=this.currentStep%t;i<0&&(i=t- -1*i);for(let t=0;t<this.ios.length;t++)this.ios[t].output(e[i][t]);await this.obniz.pingWait()}async freeWait(){for(let e=0;e<this.ios.length;e++)this.ios[e].output(!0);await this.obniz.pingWait()}stepType(e){if(!this._stepInstructions[e])throw new Error("unknown step type "+e);this._stepType=e}speed(e){this.frequency=e}currentRotation(){return this.currentStep/this.rotationStepCount*360}currentAngle(){let e=parseInt(1e3*this.currentRotation())%36e4/1e3;return e<0&&(e=360-e),e}async rotateWait(e){const t=(e/=360)*this.rotationStepCount;await this.stepWait(t)}async rotateToWait(e){let t=e-this.currentAngle();Math.abs(t)>180&&(t=t>0?t-360:360+t),t=t/360*this.rotationStepCount,await this.stepWait(t)}currentDistance(){return this.currentStep/this.milliMeterStepCount}async moveWait(e){const t=e*this.milliMeterStepCount;await this.stepWait(t)}async moveToWait(e){const t=(e-this.currentDistance())*this.milliMeterStepCount;await this.stepWait(t)}_getStepInstructions(){return this._stepInstructions[this._stepType]}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=[],this.keys=["sda","scl","i2c"]}static info(){return{name:"AXP192"}}wired(e){this.params.mode="master",this.params.clock=4e5,this.i2c=e.getI2CWithConfig(this.params)}set(e,t){this.i2c.write(s,[e,t])}async getWait(e){return this.i2c.write(s,[e]),await this.i2c.readWait(s,1)}async setLDO2Voltage(e){e<1.8&&(e=1.8),e>3.3&&(e=3.3);let t=await this.getWait(o),i=10*(e-1.8);i>15&&(i=15),t=15&t|i<<4,console.log("set voltage to ",t),this.set(o,t)}async setLDO3Voltage(e){e<1.8&&(e=1.8),e>3.3&&(e=3.3);let t=await this.getWait(o),i=10*(e-1.8);i>15&&(i=15),t=240&t|i,this.set(o,t)}set3VLDO2_3(){this.set(o,204)}enableLDO2_3(){this.set(a,77)}async toggleLDO2(e){const t=e?1:0;let i=await this.getWait(a);i=i&_|t<<2,this.set(a,i)}async toggleLDO3(e){const t=e?1:0;let i=await this.getWait(a);i=i&w|t<<3,this.set(a,i)}initM5StickC(){this.i2c.write(s,[n,255]),this.i2c.write(s,[o,204]),this.i2c.write(s,[f,255]),this.i2c.write(s,[c,192]),this.i2c.write(s,[y,128]),this.i2c.write(s,[a,77]),this.i2c.write(s,[u,12]),this.i2c.write(s,[g,2]),this.i2c.write(s,[h,224]),this.i2c.write(s,[l,252]),this.i2c.write(s,[d,162])}async getVbat(){this.i2c.write(s,[p]);let e=await this.readWait(s,1);return this.i2c.write(s,[m]),(e<<4)+await this.readWait(s,1)}}e.exports=r;const s=52,n=16,a=18,o=40,h=48,c=51,d=53,u=54,l=57,p=120,m=121,f=130,g=144,y=184,_=251,w=247},function(e,t,i){class r{constructor(){this.keys=["pin0","pin1"],this.requiredKeys=["pin0","pin1"]}static info(){return{name:"FSR40X"}}wired(e){this.obniz=e,this.io_pwr=e.getIO(this.params.pin0),this.ad=e.getAD(this.params.pin1),this.io_pwr.drive("5v"),this.io_pwr.output(!0);let t=this;this.ad.start((function(e){let i=100*e;t.press=i,t.onchange&&t.onchange(t.press)}))}async getWait(){let e=100*await this.ad.getWait();return this.press=e,this.press}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","output","gnd"],this.requiredKeys=["output"]}static info(){return{name:"SEN0114"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad=e.getAD(this.params.output),this.ad.start(e=>{this.value=e,this.onchange&&this.onchange(this.value)})}async getHumidityWait(){return this.value=await this.ad.getWait(),this.value}}e.exports=r},function(e,t,i){class r{constructor(e){this.keys=["signal","gnd"],this.requiredKeys=["signal"]}static info(){return{name:"Speaker"}}wired(e){this.obniz=e,this.obniz.setVccGnd(null,this.params.gnd,"5v"),this.pwm=e.getFreePwm(),this.pwm.start({io:this.params.signal})}play(e){if("number"!=typeof e)throw new Error("freq must be a number");(e=parseInt(e))>0?(this.pwm.freq(e),this.pwm.pulse(1/e/2*1e3)):this.pwm.pulse(0)}stop(){this.play(0)}}e.exports=r},function(e,t,i){const r=i(4);class s extends r{calc(e){return 100*e}static info(){return{name:"LM35DZ"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return Math.round((e-.424)/.00625*10)/10}static info(){return{name:"LM60"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return Math.round((e-.6)/.01)}static info(){return{name:"LM61"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return(1e3*e-2365)/-13.6+20}static info(){return{name:"LMT87"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return(e-.5)/.01}static info(){return{name:"MCP9700"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return(e-.4)/.0195}static info(){return{name:"MCP9701"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return 30+(1.508-e)/-.08}static info(){return{name:"S8100B"}}}e.exports=s},function(e,t,i){const r=i(4);class s extends r{calc(e){return(e-1.474)/-.0082+30}static info(){return{name:"S8120C"}}}e.exports=s},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","sda","scl","addressMode"],this.requiredKeys=["addressMode"]}static info(){return{name:"ADT7410"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),8===this.params.addressMode?this.address=72:9===this.params.addressMode&&(this.address=73),this.params.clock=4e5,this.params.pull="5v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params)}async getTempWait(){let e=await this.i2c.readWait(this.address,2),t=e[0]<<8;return t|=e[1],4096&(t>>=3)&&(t-=8192),t/16}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","sda","scl","i2c"],this.requiredKeys=[]}static info(){return{name:"AM2320"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.address=92,this.params.pull="5v",this.params.mode="master",this.params.clock=this.params.clock||1e5,this.i2c=e.getI2CWithConfig(this.params)}async getAllWait(){let e=this.i2c.onerror;this.i2c.onerror=()=>{},this.i2c.write(this.address,[0]),this.obniz.wait(2),this.i2c.write(this.address,[3,0,4]),this.obniz.wait(2),this.i2c.write(this.address,[3,0,4]);let t=await this.i2c.readWait(this.address,6);if(this.i2c.onerror=e,3!=t[0]||4!=t[1])return console.log("AM2320: Could not receive data correctly"),{};let i=(256*t[2]+t[3])/10;return{temperature:(256*t[4]+t[5])/10,humidity:i}}async getTempWait(){return(await this.getAllWait()).temperature}async getHumdWait(){return(await this.getAllWait()).humidity}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=[],this.keys=["vcc","gnd","sda","scl","address"],this.ioKeys=["vcc","gnd","sda","scl"],this.commands={},this.commands.mode_normal=[0,0],this.commands.reset_flag=[1,48],this.commands.reset_initial=[1,63],this.commands.frameRate_10fps=[2,0],this.commands.frameRate_1fps=[2,1],this.commands.int_disable=[3,0],this.commands.int_absVal=[3,3],this.commands.int_diff=[3,1],this.commands.stat=[4],this.commands.statClr_ovs=[5,4],this.commands.statClr_int=[5,2],this.commands.average_disable=[7,0],this.commands.average_enable=[7,16]}static info(){return{name:"AMG8833"}}wired(e){if(this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.address=105,105===this.params.address)this.address=105;else if(104===this.params.addressmode)this.address=104;else if(void 0!==this.params.address)throw new Error("address must be 0x68 or 0x69");this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||null,this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(50),e.i2c0.write(this.address,this.commands.mode_normal),e.i2c0.write(this.address,this.commands.reset_flag),e.i2c0.write(this.address,this.commands.frameRate_10fps),e.i2c0.write(this.address,this.commands.int_disable)}async getOnePixWait(e){let t=128,i=129;if(!(e>=0&&e<=63))throw new Error("pixel number must be range of 0 to 63");t=128+2*e,i=129+2*e,this.i2c.write(this.address,[t]);let r=await this.i2c.readWait(this.address,1);this.i2c.write(this.address,[i]);let s=await this.i2c.readWait(this.address,1),n=s<<8|r;return 8&s?-.25*(n=4095-(n-=1)):.25*n}async getAllPixWait(){let e=new Array(64);this.i2c.write(this.address,[128]);const t=await this.i2c.readWait(this.address,128);for(let i=0;i<64;i++){let r=t[2*i+1]<<8|t[2*i],s=0;s=8&t[2*i+1]?-.25*(r=4095-(r-=1)):.25*r,e[i]=s}return e}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=[],this.keys=["vcore","vio","gnd","csb","sdi","sck","sdo","i2c","address"],this.ioKeys=["vcore","vio","gnd","csb","sdi","sdo","sck"],this.configration={sampling:{temp:1,hum:1,pres:1},interval:5,iir_strength:0,mode:3,Modes:{sleep:0,forced:1,normal:3}},this.commands={},this.commands.addresses={config:245,ctrl_meas:244,ctrl_hum:242}}static info(){return{name:"BME280",datasheet:"https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME280_DS001-12.pdf"}}wired(e){if(this.obniz=e,e.isValidIO(this.params.csb)&&(this.io_csb=e.getIO(this.params.csb),this.io_csb.drive("3v"),this.io_csb.output(!0)),this.obniz.setVccGnd(this.params.vio,null,"3v"),this.obniz.setVccGnd(this.params.vcore,null,"3v"),this.obniz.setVccGnd(null,this.params.gnd,"5v"),this.obniz.wait(10),this.address=118,118===this.params.address)this.address=118;else if(119===this.params.address)this.address=119;else if(void 0!==this.params.address)throw new Error("address must be 0x76 or 0x77");e.isValidIO(this.params.sdo)&&(this.io_sdo=e.getIO(this.params.sdo),this.io_sdo.drive("3v"),this.io_sdo.output(118!==this.address)),this.params.sda=this.params.sda||this.params.sdi,this.params.scl=this.params.scl||this.params.sck,this.params.clock=this.params.clock||1e5,this.params.mode="master",this.params.pull="3v",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(10),this.config(),this.obniz.wait(10)}async config(){this.write([this.commands.addresses.config,this.configration.interval<<5|this.configration.iir_strength<<2|0]),this.write([this.commands.addresses.ctrl_hum,this.configration.sampling.hum]),this.write([this.commands.addresses.ctrl_meas,this.configration.sampling.temp<<5|this.configration.sampling.pres<<2|this.configration.mode])}async setIIRStrength(e){this.configration.iir_strength=e,this.config()}async applyCalibration(){this.i2c.write(this.address,[136]);let e=await this.i2c.readWait(this.address,24);this.i2c.write(this.address,[161]);let t=await this.i2c.readWait(this.address,1);e.push(...t),this.i2c.write(this.address,[225]),t=await this.i2c.readWait(this.address,7),e.push(...t),this._calibrated={dig_T1:e[1]<<8|e[0],dig_T2:this._readSigned16(e[3]<<8|e[2]),dig_T3:this._readSigned16(e[5]<<8|e[4]),dig_P1:e[7]<<8|e[6],dig_P2:this._readSigned16(e[9]<<8|e[8]),dig_P3:this._readSigned16(e[11]<<8|e[10]),dig_P4:this._readSigned16(e[13]<<8|e[12]),dig_P5:this._readSigned16(e[15]<<8|e[14]),dig_P6:this._readSigned16(e[17]<<8|e[16]),dig_P7:this._readSigned16(e[19]<<8|e[18]),dig_P8:this._readSigned16(e[21]<<8|e[20]),dig_P9:this._readSigned16(e[23]<<8|e[22]),dig_H1:this._readSigned8(e[24]),dig_H2:this._readSigned16(e[26]<<8|e[25]),dig_H3:this._readSigned8(e[27]),dig_H4:this._readSigned16(e[28]<<4|15&e[29]),dig_H5:this._readSigned16(e[30]<<4|e[29]>>4&15),dig_H6:this._readSigned8(e[31])},this._t_fine=0}_readSigned16(e){return e>=32768&&(e-=65536),e}_readSigned8(e){return e>=128&&(e-=256),e}write(e){this.obniz.i2c0.write(this.address,e)}async getData(){return this.i2c.write(this.address,[247]),await this.i2c.readWait(this.address,8)}async getAllWait(){let e=await this.getData();const t=e[0]<<12|e[1]<<4|e[2]>>4,i=e[3]<<12|e[4]<<4|e[5]>>4,r=e[6]<<8|e[7];let s=this.calibration_T(i)/100,n=this.calibration_P(t)/100;return{temperature:s,humidity:this.calibration_H(r),pressure:n}}calibration_T(e){let t,i,r;return t=((e>>3)-(this._calibrated.dig_T1<<1))*this._calibrated.dig_T2>>11,i=(((e>>4)-this._calibrated.dig_T1)*((e>>4)-this._calibrated.dig_T1)>>12)*this._calibrated.dig_T3>>14,this._t_fine=t+i,r=5*this._t_fine+128>>8}calibration_P(e){let t=this._t_fine/2-64e3,i=t*t*this._calibrated.dig_P6/32768;if(i=(i+=t*this._calibrated.dig_P5*2)/4+65536*this._calibrated.dig_P4,0!==(t=(1+(t=(this._calibrated.dig_P3*t*t/524288+this._calibrated.dig_P2*t)/524288)/32768)*this._calibrated.dig_P1)){let r=1048576-e;return r=6250*(r-i/4096)/t,r+=((t=this._calibrated.dig_P9*r*r/2147483648)+(i=r*this._calibrated.dig_P8/32768)+this._calibrated.dig_P7)/16}return 0}calibration_H(e){let t=this._t_fine-76800;return t=(e-(64*this._calibrated.dig_H4+this._calibrated.dig_H5/16384*t))*(this._calibrated.dig_H2/65536*(1+this._calibrated.dig_H6/67108864*t*(1+this._calibrated.dig_H3/67108864*t))),t*=1-this._calibrated.dig_H1*t/524288}async getTempWait(){return(await this.getAllWait()).temperature}async getHumdWait(){return(await this.getAllWait()).humidity}async getPressureWait(){return(await this.getAllWait()).pressure}async getAltitudeWait(){const e=await this.getPressureWait();return this.calcAltitude(e)}calcAltitude(e,t=1013.25){return 145366.45*(1-Math.pow(e/t,1/5.2553))*.3048}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=[],this.keys=["vcc","gnd","sda","scl","clock"],this.address=10,this.ioKeys=["vcc","gnd","sda","scl"],this.commands={},this.commands.read_data=[76]}static info(){return{name:"D6T44L"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=this.params.clock||1e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||null,this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(50)}async getOnePixWait(e){return(await this.getAllPixWait())[e]}async getAllPixWait(){this.i2c.write(this.address,[76]);let e=await this.i2c.readWait(this.address,35),t=[];for(let i=0;i<16;i++)t[i]=parseFloat((.1*(e[2*i+2]+(e[2*i+3]<<8))).toFixed(1));return t}}e.exports=r},function(e,t,i){const r=i(10);class s extends r{static info(){return{name:"DHT12"}}i2cInfo(){return{address:92,clock:1e5,voltage:"3v"}}async getAllDataWait(){const e=await this.readWait(0,5),t=e[0]+.1*e[1];let i=e[2]+.1*(127&e[3]);return 128&e[3]&&(i*=-1),e[0]+e[1]+e[2]+e[3]!==e[4]?null:{humidity:t,temperature:i}}async getTempWait(){return(await this.getAllDataWait()).temperature}async getHumdWait(){return(await this.getAllDataWait()).humidity}}e.exports=s},function(e,t,i){class r{constructor(){this.requiredKeys=["vcc","gnd","adr0","adr1","adr_select"],this.keys=["sda","scl","adr0","adr1","adr_select","i2c"]}static info(){return{name:"S5851A"}}wired(e){switch(this.io_adr0=e.getIO(this.params.adr0),this.io_adr1=e.getIO(this.params.adr1),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.adr_select){case 8:this.io_adr0.output(!1),this.io_adr1.output(!1),this.address=72;break;case 9:this.io_adr0.pull(null),this.io_adr1.output(!1),this.address=73;break;case"A":this.io_adr0.output(!0),this.io_adr1.output(!1),this.address=74;break;case"B":this.io_adr0.output(!1),this.io_adr1.output(!0),this.address=75;break;case"C":this.io_adr0.pull(null),this.io_adr1.output(!0),this.address=76;break;case"D":this.io_adr0.output(!0),this.io_adr1.output(!0),this.address=77;break;case"E":this.io_adr0.output(!1),this.io_adr1.pull(null),this.address=78;break;case"F":this.io_adr0.output(!0),this.io_adr1.pull(null),this.address=79;break;default:this.io_adr0.output(!1),this.io_adr1.output(!1),this.address=72}console.log("i2c address="+this.address),this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params)}async getTempWait(){let e=await this.i2c0.readWait(this.address,2),t=e[0].toString(2)+("00000000"+e[1].toString(2)).slice(-8);return parseInt(t,2)/65535*175-45}async getHumdWait(){this.i2c.write(this.address,[32,36]),this.i2c.write(this.address,[224,0]);let e=await this.i2c.readWait(this.address,4),t=e[2].toString(2)+("00000000"+e[3].toString(2)).slice(-8);return parseInt(t,2)/65535*100}}e.exports=r},function(e,t,i){class r{constructor(){this.requiredKeys=["adr","addressmode"],this.keys=["vcc","sda","scl","gnd","adr","addressmode","i2c","pull"],this.ioKeys=["vcc","sda","scl","gnd","adr"],this.commands={},this.commands.softReset=[48,162],this.commands.highRepeatStreach=[44,6],this.commands.middleRepeatStreach=[44,13],this.commands.lowRepeatStreach=[44,16],this.commands.highRepeat=[36,0],this.commands.mediumRepeat=[36,11],this.commands.lowRepeat=[36,22],this.waitTime={},this.waitTime.wakeup=1,this.waitTime.softReset=1,this.waitTime.lowRepeat=4,this.waitTime.mediumRepeat=6,this.waitTime.highRepeat=15,this.commands.readStatus=[243,45]}static info(){return{name:"SHT31"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_adr=e.getIO(this.params.adr),4===this.params.addressmode?(this.io_adr.output(!1),this.address=68):5===this.params.addressmode&&(this.io_adr.pull(null),this.address=69),this.params.clock=this.params.clock||1e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params),e.i2c0.write(this.address,this.commands.softReset)}async getData(){return this.i2c.write(this.address,this.commands.highRepeat),await this.obniz.wait(this.waitTime.highRepeat),await this.i2c.readWait(this.address,6)}async getTempWait(){return(await this.getAllWait()).temperature}async getHumdWait(){return(await this.getAllWait()).humidity}async getAllWait(){let e=await this.getData();return{temperature:(256*e[0]+e[1])/65535*175-45,humidity:(256*e[3]+e[4])/65535*100}}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["vcc","gnd","frequency","din","dout","clk","spi"],this.requiredKeys=[]}static info(){return{name:"ADT7310"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode=this.params.mode||"master",this.params.frequency=this.params.frequency||5e5,this.params.mosi=this.params.din,this.params.miso=this.params.dout,this.spi=this.obniz.getSpiWithConfig(this.params)}async getTempWait(){await this.spi.writeWait([84]),await this.obniz.wait(200);let e=await this.spi.writeWait([0,0]),t=e[0]<<8;return t|=e[1],4096&(t>>=3)&&(t-=8192),t/16}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["tx","rx","gnd"],this.requiredKeys=["tx","rx"]}static info(){return{name:"RN42"}}wired(e){e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:115200,drive:"3v"});let t=this;this.uart.onreceive=(e,i)=>{i.indexOf("CONNECT")>=0?console.log("connected"):i.indexOf("DISCONNECT")>=0&&console.log("disconnected"),"function"==typeof t.onreceive&&t.onreceive(e,i)}}send(e){this.uart.send(e)}sendCommand(e){this.uart.send(e+"\n"),this.obniz.wait(100)}enterCommandMode(){this.send("$$$"),this.obniz.wait(100)}config(e){this.enterCommandMode(),"object"==typeof e&&(this.sendCommand(""),e.master_slave&&this.config_masterslave(e.master_slave),e.auth&&this.config_auth(e.auth),e.hid_flag&&this.config_HIDflag(e.hid_flag),e.profile&&this.config_profile(e.profile),e.power&&this.config_power(e.power),e.display_name&&this.config_displayName(e.display_name),this.config_reboot())}config_reboot(){this.sendCommand("R,1")}config_masterslave(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){let i=["slave","master","trigger","auto-connect-master","auto-connect-dtr","auto-connect-any","pairing"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("SM,"+t)}config_displayName(e){this.sendCommand("SN,"+e)}config_HIDflag(e){this.sendCommand("SH,"+e)}config_profile(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){let i=["SPP","DUN-DCE","DUN-DTE","MDM-SPP","SPP-DUN-DCE","APL","HID"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("S~,"+t)}config_revert_localecho(){this.sendCommand("+")}config_auth(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){let i=["open","ssp-keyboard","just-work","pincode"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("SA,"+t)}config_power(e){let t="0010";16>e&&e>=12?t="000C":12>e&&e>=8?t="0008":8>e&&e>=4?t="0004":4>e&&e>=0?t="0000":0>e&&e>=-4?t="FFFC":-4>e&&e>=-8?t="FFF8":-8>e&&(t="FFF4"),this.sendCommand("SY,"+t)}config_get_setting(){this.sendCommand("D")}config_get_extendSetting(){this.sendCommand("E")}}e.exports=r},function(e,t,i){class r{constructor(){this.keys=["tx","rx","gnd"],this.requiredKeys=["tx","rx"],this.displayIoNames={tx:"<tx",rx:">rx"}}static info(){return{name:"XBee"}}wired(e){this.uart=e.getFreeUart(),this.currentCommand=null,this.commands=[],this.isAtMode=!1,this.onFinishAtModeCallback=null,"number"==typeof this.params.gnd&&e.getIO(this.params.gnd).output(!1),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:9600,drive:"3v"}),this.uart.onreceive=function(e,t){this.isAtMode?this.onAtResultsRecieve(e,t):"function"==typeof this.onreceive&&this.onreceive(e,t)}.bind(this)}send(e){!1===this.isAtMode?this.uart.send(e):this.obniz.error("XBee is AT Command mode now. Wait for finish config.")}onAtResultsRecieve(e,t){if(!this.isAtMode)return;let i=function(){this.currentCommand=null,this.sendCommand()}.bind(this);if("OK\r"===t){if("ATCN"===this.currentCommand)return this.isAtMode=!1,this.currentCommand=null,void("function"==typeof this.onFinishAtModeCallback&&(this.onFinishAtModeCallback(),this.onFinishAtModeCallback=null));i()}else"ERROR\r"===t?this.obniz.error("XBee config error : "+this.currentCommand):(console.log("XBEE : no catch message",e),i())}addCommand(e,t){let i=e+(t?" "+t:"");this.commands.push(i),!0===this.isAtMode&&null===this.currentCommand&&this.sendCommand()}sendCommand(){!0===this.isAtMode&&null===this.currentCommand&&this.commands.length>0&&(this.currentCommand="AT"+this.commands.shift(),this.uart.send(this.currentCommand+"\r"))}enterAtMode(){if(null!==this.currentCommand)return;this.isAtMode=!0,this.obniz.wait(1e3);this.currentCommand="+++",this.uart.send(this.currentCommand),this.obniz.wait(1e3)}exitAtMode(){this.addCommand("CN")}async configWait(e){if(this.isAtMode)throw new Error("Xbee : duplicate config setting");return new Promise(function(t,i){let r={destination_address_high:"DH",destination_address_low:"DL",source_address:"MY"},s=["destination_address"];this.enterAtMode();for(let t in e)if(2===t.length)this.addCommand(t,e[t]);else if(r[t])this.addCommand(r[t],e[t]);else if(s.includes(t)){let i=e[t].slice(0,-8);i||(i="0");let s=e[t].slice(-8);this.addCommand(r[t+"_high"],i),this.addCommand(r[t+"_low"],s)}this.exitAtMode(),this.onFinishAtModeCallback=function(){t()}}.bind(this))}}e.exports=r}]);